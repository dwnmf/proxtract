# Extracted from: /home/k1/extractor-1
# Max file size: 500KB
# Mode: compact
============================================================
# Gitignore: on

--- LICENSE ---
MIT License

Copyright (c) 2024 Proxtract Team

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.


--- MANIFEST.in ---
include LICENSE


--- README.md ---
# Proxtract

Proxtract is a Rich + prompt_toolkit powered CLI that extracts readable project files into a single bundle that is easy to share with large language models.

## Features
- Instant console REPL with history + Tab completion via `prompt_toolkit`
- Rich panels, tables, and progress bars for clear status updates
- Shared configuration state between the REPL and the traditional `extract` subcommand
- Optional persistence to `settings.toml` for quick reloads across sessions

## Installation

```bash
pip install proxtract
```

Install with the optional ASCII art banner extras by adding `banner`:

```bash
pip install proxtract[banner]
```

## Usage

Launching `proxtract` or `prx` without arguments opens the interactive REPL:

```bash
proxtract
```

At the prompt type `help` (or press `Tab`) to see the available commands:

| Command | Description |
| --- | --- |
| `extract [SOURCE] [OUTPUT]` | Run an extraction. Paths fallback to the current config and are prompted for when missing. |
| `set <key> <value>` | Update configuration. Keys: `source_path`, `output_path`, `max_size_kb`, `compact_mode`, `skip_empty`, `use_gitignore`, `force_include`, `include_patterns`, `exclude_patterns`, `count_tokens`, `tokenizer_model`, `copy_clipboard`. |
| `show` / `config` | Render the current settings table. |
| `save` | Persist settings to `~/.config/proxtract/settings.toml`. |
| `help` | Show the command list. |
| `exit` / `quit` | Leave the REPL. |

The REPL provides:
- Tab completion for commands, setting keys, boolean values, and filesystem paths.
- Arrow-key command history (stored under `~/.config/proxtract/history` when possible).
- Rich progress bars during extraction plus a summary table on completion.

### Scripted CLI

Run a one-off extraction directly from the shell with the short form:

```bash
prx e path/to/project -o bundle.txt
```

### Shell Tab Completion

Shell tab-completion for commands, options, and path arguments is available via
`argcomplete`. After installing Proxtract, enable completion (bash/zsh/fish) with:

```bash
register-python-argcomplete proxtract prx >> ~/.bashrc  # adapt for your shell
```

Restart your shell (or source the file) and enjoy tab-completion for both `proxtract`
and `prx`.

## Verification

After installing, you can confirm the basics operate with the bundled smoke test:

```bash
python scripts/smoke_test.py
```

The script ensures the CLI help works and performs a one-file extraction using the public API.

## Development
- Python 3.9+
- Dependencies managed via `pyproject.toml`

Run the interactive REPL locally without installing by executing `python -m proxtract` from the project root. The banner gracefully falls back to ASCII art if the optional `art` dependency is unavailable.

For editable development installs, use:

```bash
pip install -e .[dev,banner]
```

## Publishing to PyPI

1. Ensure `dist/` is clean: `rm -rf dist/ build/`
2. Build the distribution artifacts: `python -m build`
3. Inspect the generated wheels and sdist under `dist/`
4. Run a sanity check: `twine check dist/*`
5. Upload to PyPI (or TestPyPI) with `twine upload dist/*`


--- coverage.xml ---
<?xml version="1.0" ?>
<coverage version="7.11.0" timestamp="1762546589647" lines-valid="929" lines-covered="762" line-rate="0.8202" branches-covered="0" branches-valid="0" branch-rate="0" complexity="0">
	<!-- Generated by coverage.py: https://coverage.readthedocs.io/en/7.11.0 -->
	<!-- Based on https://raw.githubusercontent.com/cobertura/web/master/htdocs/xml/coverage-04.dtd -->
	<sources>
		<source>/home/k1/extractor-1/src/proxtract</source>
	</sources>
	<packages>
		<package name="." line-rate="0.8202" branch-rate="0" complexity="0">
			<classes>
				<class name="__init__.py" filename="__init__.py" complexity="0" line-rate="1" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="7" hits="1"/>
						<line number="8" hits="1"/>
						<line number="12" hits="1"/>
					</lines>
				</class>
				<class name="__main__.py" filename="__main__.py" complexity="0" line-rate="0" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="0"/>
					</lines>
				</class>
				<class name="config.py" filename="config.py" complexity="0" line-rate="0.9794" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="6" hits="1"/>
						<line number="8" hits="1"/>
						<line number="9" hits="1"/>
						<line number="11" hits="1"/>
						<line number="12" hits="1"/>
						<line number="19" hits="1"/>
						<line number="20" hits="1"/>
						<line number="25" hits="1"/>
						<line number="26" hits="1"/>
						<line number="29" hits="1"/>
						<line number="30" hits="1"/>
						<line number="31" hits="1"/>
						<line number="32" hits="1"/>
						<line number="33" hits="1"/>
						<line number="34" hits="1"/>
						<line number="35" hits="1"/>
						<line number="36" hits="1"/>
						<line number="39" hits="1"/>
						<line number="40" hits="1"/>
						<line number="41" hits="1"/>
						<line number="44" hits="1"/>
						<line number="45" hits="1"/>
						<line number="46" hits="1"/>
						<line number="47" hits="1"/>
						<line number="48" hits="1"/>
						<line number="50" hits="1"/>
						<line number="51" hits="1"/>
						<line number="53" hits="1"/>
						<line number="54" hits="1"/>
						<line number="56" hits="1"/>
						<line number="57" hits="1"/>
						<line number="58" hits="1"/>
						<line number="59" hits="1"/>
						<line number="60" hits="1"/>
						<line number="62" hits="1"/>
						<line number="63" hits="1"/>
						<line number="64" hits="1"/>
						<line number="66" hits="1"/>
						<line number="67" hits="1"/>
						<line number="68" hits="1"/>
						<line number="71" hits="1"/>
						<line number="72" hits="1"/>
						<line number="73" hits="1"/>
						<line number="74" hits="1"/>
						<line number="75" hits="1"/>
						<line number="77" hits="1"/>
						<line number="78" hits="1"/>
						<line number="79" hits="1"/>
						<line number="80" hits="1"/>
						<line number="81" hits="1"/>
						<line number="83" hits="1"/>
						<line number="84" hits="1"/>
						<line number="85" hits="1"/>
						<line number="86" hits="1"/>
						<line number="87" hits="1"/>
						<line number="89" hits="1"/>
						<line number="90" hits="1"/>
						<line number="93" hits="1"/>
						<line number="96" hits="1"/>
						<line number="99" hits="1"/>
						<line number="100" hits="1"/>
						<line number="101" hits="1"/>
						<line number="103" hits="1"/>
						<line number="104" hits="1"/>
						<line number="106" hits="1"/>
						<line number="121" hits="1"/>
						<line number="122" hits="1"/>
						<line number="123" hits="1"/>
						<line number="124" hits="1"/>
						<line number="126" hits="1"/>
						<line number="127" hits="1"/>
						<line number="128" hits="1"/>
						<line number="131" hits="1"/>
						<line number="132" hits="1"/>
						<line number="133" hits="1"/>
						<line number="134" hits="1"/>
						<line number="135" hits="1"/>
						<line number="136" hits="0"/>
						<line number="138" hits="0"/>
						<line number="141" hits="1"/>
						<line number="142" hits="1"/>
						<line number="144" hits="1"/>
						<line number="145" hits="1"/>
						<line number="146" hits="1"/>
						<line number="147" hits="1"/>
						<line number="148" hits="1"/>
						<line number="149" hits="1"/>
						<line number="150" hits="1"/>
						<line number="151" hits="1"/>
						<line number="153" hits="1"/>
						<line number="154" hits="1"/>
						<line number="156" hits="1"/>
						<line number="157" hits="1"/>
						<line number="158" hits="1"/>
						<line number="161" hits="1"/>
					</lines>
				</class>
				<class name="core.py" filename="core.py" complexity="0" line-rate="0.8294" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="6" hits="1"/>
						<line number="7" hits="1"/>
						<line number="8" hits="1"/>
						<line number="9" hits="1"/>
						<line number="10" hits="1"/>
						<line number="11" hits="1"/>
						<line number="13" hits="1"/>
						<line number="14" hits="1"/>
						<line number="18" hits="1"/>
						<line number="19" hits="1"/>
						<line number="31" hits="1"/>
						<line number="32" hits="1"/>
						<line number="35" hits="1"/>
						<line number="36" hits="1"/>
						<line number="37" hits="1"/>
						<line number="38" hits="1"/>
						<line number="39" hits="1"/>
						<line number="40" hits="1"/>
						<line number="41" hits="1"/>
						<line number="42" hits="1"/>
						<line number="44" hits="1"/>
						<line number="45" hits="1"/>
						<line number="48" hits="1"/>
						<line number="50" hits="1"/>
						<line number="51" hits="1"/>
						<line number="54" hits="1"/>
						<line number="55" hits="1"/>
						<line number="67" hits="1"/>
						<line number="68" hits="1"/>
						<line number="69" hits="1"/>
						<line number="70" hits="1"/>
						<line number="71" hits="1"/>
						<line number="72" hits="1"/>
						<line number="74" hits="1"/>
						<line number="77" hits="1"/>
						<line number="87" hits="1"/>
						<line number="88" hits="1"/>
						<line number="89" hits="1"/>
						<line number="90" hits="1"/>
						<line number="91" hits="1"/>
						<line number="94" hits="1"/>
						<line number="98" hits="1"/>
						<line number="101" hits="1"/>
						<line number="118" hits="1"/>
						<line number="119" hits="1"/>
						<line number="120" hits="1"/>
						<line number="121" hits="1"/>
						<line number="122" hits="1"/>
						<line number="123" hits="1"/>
						<line number="124" hits="1"/>
						<line number="125" hits="1"/>
						<line number="126" hits="1"/>
						<line number="129" hits="1"/>
						<line number="141" hits="1"/>
						<line number="147" hits="1"/>
						<line number="152" hits="1"/>
						<line number="153" hits="1"/>
						<line number="155" hits="1"/>
						<line number="156" hits="1"/>
						<line number="159" hits="1"/>
						<line number="162" hits="1"/>
						<line number="163" hits="1"/>
						<line number="165" hits="1"/>
						<line number="166" hits="1"/>
						<line number="168" hits="1"/>
						<line number="169" hits="1"/>
						<line number="170" hits="1"/>
						<line number="172" hits="1"/>
						<line number="173" hits="1"/>
						<line number="174" hits="1"/>
						<line number="175" hits="1"/>
						<line number="176" hits="1"/>
						<line number="177" hits="1"/>
						<line number="179" hits="1"/>
						<line number="180" hits="1"/>
						<line number="181" hits="1"/>
						<line number="183" hits="1"/>
						<line number="184" hits="1"/>
						<line number="186" hits="1"/>
						<line number="191" hits="1"/>
						<line number="193" hits="1"/>
						<line number="194" hits="1"/>
						<line number="196" hits="1"/>
						<line number="197" hits="1"/>
						<line number="198" hits="1"/>
						<line number="200" hits="1"/>
						<line number="201" hits="1"/>
						<line number="204" hits="1"/>
						<line number="205" hits="1"/>
						<line number="206" hits="0"/>
						<line number="208" hits="1"/>
						<line number="209" hits="1"/>
						<line number="210" hits="1"/>
						<line number="212" hits="1"/>
						<line number="213" hits="1"/>
						<line number="214" hits="0"/>
						<line number="215" hits="0"/>
						<line number="217" hits="1"/>
						<line number="218" hits="1"/>
						<line number="220" hits="1"/>
						<line number="221" hits="1"/>
						<line number="223" hits="1"/>
						<line number="225" hits="1"/>
						<line number="226" hits="1"/>
						<line number="229" hits="1"/>
						<line number="230" hits="1"/>
						<line number="231" hits="0"/>
						<line number="232" hits="0"/>
						<line number="234" hits="1"/>
						<line number="235" hits="1"/>
						<line number="238" hits="1"/>
						<line number="240" hits="1"/>
						<line number="241" hits="1"/>
						<line number="242" hits="1"/>
						<line number="243" hits="0"/>
						<line number="244" hits="0"/>
						<line number="247" hits="1"/>
						<line number="278" hits="1"/>
						<line number="279" hits="1"/>
						<line number="280" hits="1"/>
						<line number="284" hits="1"/>
						<line number="286" hits="1"/>
						<line number="287" hits="1"/>
						<line number="288" hits="1"/>
						<line number="291" hits="1"/>
						<line number="292" hits="1"/>
						<line number="293" hits="1"/>
						<line number="294" hits="1"/>
						<line number="297" hits="1"/>
						<line number="298" hits="1"/>
						<line number="299" hits="1"/>
						<line number="300" hits="1"/>
						<line number="301" hits="1"/>
						<line number="302" hits="1"/>
						<line number="303" hits="1"/>
						<line number="305" hits="1"/>
						<line number="307" hits="1"/>
						<line number="308" hits="1"/>
						<line number="309" hits="1"/>
						<line number="310" hits="1"/>
						<line number="311" hits="1"/>
						<line number="312" hits="1"/>
						<line number="313" hits="1"/>
						<line number="314" hits="1"/>
						<line number="315" hits="1"/>
						<line number="316" hits="0"/>
						<line number="318" hits="1"/>
						<line number="319" hits="1"/>
						<line number="321" hits="1"/>
						<line number="322" hits="0"/>
						<line number="323" hits="0"/>
						<line number="325" hits="1"/>
						<line number="348" hits="1"/>
						<line number="349" hits="1"/>
						<line number="350" hits="1"/>
						<line number="352" hits="1"/>
						<line number="353" hits="1"/>
						<line number="355" hits="1"/>
						<line number="356" hits="1"/>
						<line number="357" hits="1"/>
						<line number="358" hits="1"/>
						<line number="359" hits="1"/>
						<line number="360" hits="0"/>
						<line number="362" hits="1"/>
						<line number="363" hits="1"/>
						<line number="364" hits="1"/>
						<line number="365" hits="1"/>
						<line number="366" hits="1"/>
						<line number="367" hits="1"/>
						<line number="371" hits="1"/>
						<line number="372" hits="1"/>
						<line number="373" hits="1"/>
						<line number="374" hits="1"/>
						<line number="375" hits="1"/>
						<line number="376" hits="0"/>
						<line number="378" hits="1"/>
						<line number="379" hits="1"/>
						<line number="380" hits="1"/>
						<line number="382" hits="1"/>
						<line number="383" hits="1"/>
						<line number="385" hits="1"/>
						<line number="386" hits="1"/>
						<line number="394" hits="1"/>
						<line number="395" hits="1"/>
						<line number="396" hits="1"/>
						<line number="397" hits="1"/>
						<line number="398" hits="1"/>
						<line number="399" hits="1"/>
						<line number="400" hits="1"/>
						<line number="401" hits="1"/>
						<line number="402" hits="1"/>
						<line number="403" hits="1"/>
						<line number="404" hits="1"/>
						<line number="405" hits="1"/>
						<line number="407" hits="1"/>
						<line number="408" hits="1"/>
						<line number="409" hits="1"/>
						<line number="410" hits="1"/>
						<line number="411" hits="0"/>
						<line number="412" hits="0"/>
						<line number="414" hits="0"/>
						<line number="415" hits="0"/>
						<line number="416" hits="0"/>
						<line number="417" hits="0"/>
						<line number="418" hits="0"/>
						<line number="419" hits="0"/>
						<line number="420" hits="0"/>
						<line number="425" hits="1"/>
						<line number="426" hits="1"/>
						<line number="427" hits="1"/>
						<line number="428" hits="1"/>
						<line number="429" hits="1"/>
						<line number="430" hits="0"/>
						<line number="431" hits="0"/>
						<line number="433" hits="1"/>
						<line number="434" hits="1"/>
						<line number="435" hits="1"/>
						<line number="437" hits="1"/>
						<line number="438" hits="1"/>
						<line number="440" hits="1"/>
						<line number="441" hits="1"/>
						<line number="442" hits="1"/>
						<line number="443" hits="0"/>
						<line number="444" hits="0"/>
						<line number="446" hits="1"/>
						<line number="447" hits="1"/>
						<line number="448" hits="1"/>
						<line number="450" hits="1"/>
						<line number="451" hits="1"/>
						<line number="452" hits="0"/>
						<line number="453" hits="0"/>
						<line number="454" hits="0"/>
						<line number="455" hits="0"/>
						<line number="456" hits="0"/>
						<line number="458" hits="1"/>
						<line number="459" hits="1"/>
						<line number="460" hits="1"/>
						<line number="461" hits="1"/>
						<line number="462" hits="1"/>
						<line number="464" hits="1"/>
						<line number="465" hits="1"/>
						<line number="466" hits="1"/>
						<line number="468" hits="1"/>
						<line number="470" hits="1"/>
						<line number="472" hits="1"/>
						<line number="473" hits="1"/>
						<line number="475" hits="1"/>
						<line number="476" hits="1"/>
						<line number="478" hits="1"/>
						<line number="479" hits="0"/>
						<line number="480" hits="0"/>
						<line number="484" hits="1"/>
						<line number="486" hits="1"/>
						<line number="487" hits="1"/>
						<line number="488" hits="1"/>
						<line number="489" hits="1"/>
						<line number="490" hits="0"/>
						<line number="491" hits="1"/>
						<line number="492" hits="1"/>
						<line number="494" hits="1"/>
						<line number="495" hits="0"/>
						<line number="497" hits="1"/>
						<line number="499" hits="1"/>
						<line number="500" hits="0"/>
						<line number="501" hits="0"/>
						<line number="502" hits="0"/>
						<line number="503" hits="0"/>
						<line number="504" hits="0"/>
						<line number="505" hits="0"/>
						<line number="506" hits="1"/>
						<line number="507" hits="0"/>
						<line number="508" hits="0"/>
						<line number="509" hits="0"/>
						<line number="510" hits="0"/>
						<line number="511" hits="0"/>
						<line number="512" hits="0"/>
						<line number="513" hits="1"/>
						<line number="514" hits="1"/>
						<line number="515" hits="1"/>
						<line number="516" hits="1"/>
						<line number="517" hits="0"/>
						<line number="518" hits="0"/>
						<line number="519" hits="1"/>
						<line number="521" hits="1"/>
						<line number="522" hits="1"/>
						<line number="524" hits="1"/>
						<line number="533" hits="1"/>
						<line number="534" hits="0"/>
						<line number="535" hits="0"/>
						<line number="537" hits="1"/>
						<line number="540" hits="1"/>
					</lines>
				</class>
				<class name="interactive.py" filename="interactive.py" complexity="0" line-rate="0.729" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="6" hits="1"/>
						<line number="7" hits="1"/>
						<line number="8" hits="1"/>
						<line number="67" hits="1"/>
						<line number="68" hits="1"/>
						<line number="69" hits="1"/>
						<line number="70" hits="1"/>
						<line number="71" hits="1"/>
						<line number="73" hits="1"/>
						<line number="74" hits="1"/>
						<line number="75" hits="1"/>
						<line number="76" hits="1"/>
						<line number="78" hits="1"/>
						<line number="79" hits="1"/>
						<line number="93" hits="1"/>
						<line number="101" hits="1"/>
						<line number="102" hits="1"/>
						<line number="105" hits="1"/>
						<line number="106" hits="0"/>
						<line number="109" hits="1"/>
						<line number="110" hits="1"/>
						<line number="111" hits="1"/>
						<line number="112" hits="1"/>
						<line number="113" hits="1"/>
						<line number="114" hits="1"/>
						<line number="115" hits="0"/>
						<line number="117" hits="0"/>
						<line number="118" hits="1"/>
						<line number="119" hits="1"/>
						<line number="120" hits="1"/>
						<line number="123" hits="1"/>
						<line number="126" hits="1"/>
						<line number="127" hits="1"/>
						<line number="128" hits="1"/>
						<line number="129" hits="1"/>
						<line number="130" hits="1"/>
						<line number="131" hits="1"/>
						<line number="133" hits="1"/>
						<line number="136" hits="1"/>
						<line number="137" hits="1"/>
						<line number="138" hits="1"/>
						<line number="139" hits="1"/>
						<line number="140" hits="1"/>
						<line number="141" hits="1"/>
						<line number="142" hits="1"/>
						<line number="143" hits="1"/>
						<line number="144" hits="1"/>
						<line number="145" hits="1"/>
						<line number="146" hits="1"/>
						<line number="147" hits="1"/>
						<line number="149" hits="1"/>
						<line number="150" hits="0"/>
						<line number="151" hits="0"/>
						<line number="152" hits="0"/>
						<line number="153" hits="0"/>
						<line number="160" hits="1"/>
						<line number="161" hits="1"/>
						<line number="162" hits="1"/>
						<line number="163" hits="1"/>
						<line number="164" hits="1"/>
						<line number="165" hits="1"/>
						<line number="166" hits="1"/>
						<line number="168" hits="1"/>
						<line number="169" hits="1"/>
						<line number="171" hits="1"/>
						<line number="173" hits="1"/>
						<line number="174" hits="1"/>
						<line number="175" hits="1"/>
						<line number="176" hits="1"/>
						<line number="177" hits="1"/>
						<line number="179" hits="1"/>
						<line number="180" hits="0"/>
						<line number="182" hits="1"/>
						<line number="183" hits="1"/>
						<line number="184" hits="0"/>
						<line number="185" hits="0"/>
						<line number="186" hits="1"/>
						<line number="187" hits="1"/>
						<line number="188" hits="1"/>
						<line number="190" hits="1"/>
						<line number="191" hits="1"/>
						<line number="192" hits="1"/>
						<line number="193" hits="1"/>
						<line number="194" hits="0"/>
						<line number="195" hits="0"/>
						<line number="196" hits="0"/>
						<line number="197" hits="0"/>
						<line number="198" hits="0"/>
						<line number="199" hits="0"/>
						<line number="201" hits="0"/>
						<line number="202" hits="0"/>
						<line number="203" hits="0"/>
						<line number="204" hits="0"/>
						<line number="205" hits="0"/>
						<line number="206" hits="0"/>
						<line number="207" hits="0"/>
						<line number="210" hits="1"/>
						<line number="213" hits="1"/>
						<line number="215" hits="1"/>
						<line number="216" hits="1"/>
						<line number="217" hits="1"/>
						<line number="218" hits="1"/>
						<line number="219" hits="1"/>
						<line number="220" hits="1"/>
						<line number="222" hits="1"/>
						<line number="223" hits="0"/>
						<line number="224" hits="0"/>
						<line number="225" hits="0"/>
						<line number="226" hits="0"/>
						<line number="227" hits="0"/>
						<line number="228" hits="0"/>
						<line number="229" hits="0"/>
						<line number="230" hits="0"/>
						<line number="231" hits="0"/>
						<line number="232" hits="0"/>
						<line number="233" hits="0"/>
						<line number="234" hits="0"/>
						<line number="235" hits="0"/>
						<line number="236" hits="0"/>
						<line number="237" hits="0"/>
						<line number="238" hits="0"/>
						<line number="239" hits="0"/>
						<line number="241" hits="1"/>
						<line number="242" hits="1"/>
						<line number="243" hits="1"/>
						<line number="244" hits="0"/>
						<line number="245" hits="1"/>
						<line number="246" hits="1"/>
						<line number="248" hits="1"/>
						<line number="249" hits="0"/>
						<line number="250" hits="0"/>
						<line number="251" hits="1"/>
						<line number="252" hits="1"/>
						<line number="253" hits="1"/>
						<line number="254" hits="1"/>
						<line number="255" hits="1"/>
						<line number="256" hits="1"/>
						<line number="257" hits="1"/>
						<line number="258" hits="1"/>
						<line number="259" hits="1"/>
						<line number="260" hits="1"/>
						<line number="261" hits="1"/>
						<line number="262" hits="1"/>
						<line number="263" hits="1"/>
						<line number="264" hits="1"/>
						<line number="265" hits="1"/>
						<line number="267" hits="1"/>
						<line number="268" hits="1"/>
						<line number="270" hits="1"/>
						<line number="271" hits="0"/>
						<line number="272" hits="0"/>
						<line number="273" hits="0"/>
						<line number="274" hits="0"/>
						<line number="275" hits="0"/>
						<line number="277" hits="1"/>
						<line number="278" hits="0"/>
						<line number="279" hits="0"/>
						<line number="280" hits="0"/>
						<line number="281" hits="0"/>
						<line number="285" hits="0"/>
						<line number="286" hits="0"/>
						<line number="287" hits="0"/>
						<line number="288" hits="0"/>
						<line number="289" hits="0"/>
						<line number="290" hits="0"/>
						<line number="292" hits="0"/>
						<line number="297" hits="0"/>
						<line number="299" hits="1"/>
						<line number="300" hits="1"/>
						<line number="301" hits="1"/>
						<line number="302" hits="1"/>
						<line number="303" hits="1"/>
						<line number="304" hits="1"/>
						<line number="305" hits="1"/>
						<line number="306" hits="1"/>
						<line number="307" hits="1"/>
						<line number="308" hits="1"/>
						<line number="309" hits="1"/>
						<line number="311" hits="1"/>
						<line number="312" hits="1"/>
						<line number="313" hits="1"/>
						<line number="314" hits="1"/>
						<line number="315" hits="1"/>
						<line number="316" hits="1"/>
						<line number="317" hits="1"/>
						<line number="319" hits="1"/>
						<line number="320" hits="1"/>
						<line number="321" hits="1"/>
						<line number="322" hits="1"/>
						<line number="323" hits="1"/>
						<line number="324" hits="1"/>
						<line number="325" hits="1"/>
						<line number="326" hits="1"/>
						<line number="327" hits="1"/>
						<line number="328" hits="1"/>
						<line number="329" hits="1"/>
						<line number="330" hits="1"/>
						<line number="331" hits="1"/>
						<line number="332" hits="1"/>
						<line number="334" hits="1"/>
						<line number="335" hits="1"/>
						<line number="336" hits="0"/>
						<line number="337" hits="0"/>
						<line number="338" hits="1"/>
						<line number="339" hits="1"/>
						<line number="340" hits="1"/>
						<line number="341" hits="1"/>
						<line number="342" hits="1"/>
						<line number="343" hits="1"/>
						<line number="344" hits="1"/>
						<line number="345" hits="1"/>
						<line number="346" hits="1"/>
						<line number="347" hits="1"/>
						<line number="348" hits="1"/>
						<line number="349" hits="1"/>
						<line number="351" hits="1"/>
						<line number="352" hits="1"/>
						<line number="353" hits="1"/>
						<line number="354" hits="1"/>
						<line number="355" hits="1"/>
						<line number="356" hits="1"/>
						<line number="357" hits="1"/>
						<line number="359" hits="1"/>
						<line number="360" hits="1"/>
						<line number="361" hits="1"/>
						<line number="362" hits="0"/>
						<line number="363" hits="1"/>
						<line number="365" hits="1"/>
						<line number="366" hits="0"/>
						<line number="367" hits="0"/>
						<line number="369" hits="1"/>
						<line number="370" hits="0"/>
						<line number="371" hits="0"/>
						<line number="372" hits="0"/>
						<line number="373" hits="0"/>
						<line number="375" hits="1"/>
						<line number="376" hits="1"/>
						<line number="378" hits="1"/>
						<line number="379" hits="0"/>
						<line number="381" hits="1"/>
						<line number="382" hits="0"/>
						<line number="384" hits="1"/>
						<line number="385" hits="0"/>
						<line number="387" hits="1"/>
						<line number="388" hits="0"/>
						<line number="390" hits="1"/>
						<line number="391" hits="0"/>
						<line number="393" hits="1"/>
						<line number="394" hits="0"/>
						<line number="396" hits="1"/>
						<line number="397" hits="0"/>
						<line number="399" hits="1"/>
						<line number="400" hits="0"/>
						<line number="402" hits="1"/>
						<line number="403" hits="0"/>
						<line number="404" hits="0"/>
						<line number="405" hits="0"/>
						<line number="407" hits="1"/>
						<line number="408" hits="1"/>
						<line number="409" hits="1"/>
						<line number="410" hits="1"/>
						<line number="411" hits="0"/>
						<line number="412" hits="1"/>
						<line number="413" hits="0"/>
						<line number="415" hits="1"/>
						<line number="416" hits="1"/>
						<line number="418" hits="1"/>
						<line number="419" hits="1"/>
						<line number="420" hits="1"/>
						<line number="422" hits="1"/>
						<line number="423" hits="1"/>
						<line number="429" hits="1"/>
						<line number="430" hits="1"/>
						<line number="432" hits="1"/>
						<line number="433" hits="1"/>
						<line number="434" hits="1"/>
						<line number="435" hits="1"/>
						<line number="436" hits="1"/>
						<line number="438" hits="1"/>
						<line number="439" hits="1"/>
						<line number="440" hits="0"/>
						<line number="441" hits="0"/>
						<line number="442" hits="0"/>
						<line number="447" hits="1"/>
						<line number="448" hits="1"/>
						<line number="449" hits="1"/>
						<line number="450" hits="0"/>
						<line number="452" hits="1"/>
						<line number="453" hits="1"/>
						<line number="454" hits="1"/>
						<line number="455" hits="1"/>
						<line number="456" hits="1"/>
						<line number="457" hits="1"/>
						<line number="458" hits="1"/>
						<line number="459" hits="1"/>
						<line number="460" hits="1"/>
						<line number="461" hits="1"/>
						<line number="462" hits="1"/>
						<line number="463" hits="1"/>
						<line number="464" hits="1"/>
						<line number="465" hits="1"/>
						<line number="466" hits="1"/>
						<line number="467" hits="1"/>
						<line number="468" hits="1"/>
						<line number="469" hits="1"/>
						<line number="470" hits="1"/>
						<line number="472" hits="1"/>
						<line number="473" hits="1"/>
						<line number="474" hits="1"/>
						<line number="476" hits="1"/>
						<line number="477" hits="1"/>
						<line number="478" hits="1"/>
						<line number="482" hits="1"/>
						<line number="483" hits="1"/>
						<line number="484" hits="1"/>
						<line number="488" hits="1"/>
						<line number="491" hits="1"/>
						<line number="494" hits="0"/>
						<line number="497" hits="1"/>
					</lines>
				</class>
				<class name="main.py" filename="main.py" complexity="0" line-rate="0.8727" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="6" hits="1"/>
						<line number="7" hits="1"/>
						<line number="8" hits="1"/>
						<line number="10" hits="1"/>
						<line number="12" hits="1"/>
						<line number="13" hits="1"/>
						<line number="14" hits="1"/>
						<line number="16" hits="1"/>
						<line number="17" hits="1"/>
						<line number="18" hits="1"/>
						<line number="23" hits="1"/>
						<line number="24" hits="1"/>
						<line number="29" hits="1"/>
						<line number="30" hits="1"/>
						<line number="32" hits="1"/>
						<line number="33" hits="1"/>
						<line number="34" hits="1"/>
						<line number="35" hits="1"/>
						<line number="36" hits="1"/>
						<line number="37" hits="1"/>
						<line number="38" hits="1"/>
						<line number="39" hits="0"/>
						<line number="40" hits="1"/>
						<line number="41" hits="0"/>
						<line number="42" hits="1"/>
						<line number="43" hits="1"/>
						<line number="44" hits="1"/>
						<line number="45" hits="1"/>
						<line number="46" hits="1"/>
						<line number="47" hits="0"/>
						<line number="48" hits="1"/>
						<line number="49" hits="1"/>
						<line number="50" hits="1"/>
						<line number="51" hits="1"/>
						<line number="52" hits="1"/>
						<line number="53" hits="1"/>
						<line number="54" hits="1"/>
						<line number="55" hits="0"/>
						<line number="56" hits="1"/>
						<line number="57" hits="1"/>
						<line number="58" hits="1"/>
						<line number="59" hits="0"/>
						<line number="60" hits="1"/>
						<line number="61" hits="0"/>
						<line number="63" hits="1"/>
						<line number="64" hits="1"/>
						<line number="65" hits="1"/>
						<line number="67" hits="1"/>
						<line number="68" hits="1"/>
						<line number="69" hits="1"/>
						<line number="70" hits="1"/>
						<line number="71" hits="1"/>
						<line number="72" hits="1"/>
						<line number="74" hits="1"/>
						<line number="79" hits="1"/>
						<line number="80" hits="1"/>
						<line number="81" hits="1"/>
						<line number="82" hits="1"/>
						<line number="84" hits="1"/>
						<line number="85" hits="1"/>
						<line number="86" hits="1"/>
						<line number="88" hits="0"/>
						<line number="89" hits="0"/>
						<line number="90" hits="0"/>
						<line number="91" hits="0"/>
						<line number="94" hits="1"/>
						<line number="95" hits="1"/>
						<line number="97" hits="1"/>
						<line number="98" hits="0"/>
						<line number="99" hits="0"/>
						<line number="100" hits="0"/>
						<line number="104" hits="1"/>
						<line number="107" hits="1"/>
						<line number="108" hits="1"/>
						<line number="109" hits="1"/>
						<line number="110" hits="1"/>
						<line number="112" hits="1"/>
						<line number="113" hits="1"/>
						<line number="114" hits="1"/>
						<line number="115" hits="1"/>
						<line number="116" hits="1"/>
						<line number="117" hits="1"/>
						<line number="118" hits="1"/>
						<line number="119" hits="1"/>
						<line number="120" hits="1"/>
						<line number="121" hits="1"/>
						<line number="122" hits="1"/>
						<line number="123" hits="1"/>
						<line number="124" hits="1"/>
						<line number="125" hits="1"/>
						<line number="126" hits="1"/>
						<line number="127" hits="1"/>
						<line number="128" hits="1"/>
						<line number="129" hits="1"/>
						<line number="135" hits="1"/>
						<line number="141" hits="1"/>
						<line number="142" hits="1"/>
						<line number="143" hits="1"/>
						<line number="144" hits="1"/>
						<line number="146" hits="1"/>
						<line number="166" hits="1"/>
						<line number="168" hits="1"/>
						<line number="169" hits="1"/>
						<line number="170" hits="1"/>
						<line number="172" hits="1"/>
						<line number="174" hits="1"/>
						<line number="175" hits="1"/>
						<line number="177" hits="0"/>
					</lines>
				</class>
				<class name="state.py" filename="state.py" complexity="0" line-rate="0.8571" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="6" hits="1"/>
						<line number="7" hits="1"/>
						<line number="9" hits="1"/>
						<line number="12" hits="1"/>
						<line number="13" hits="1"/>
						<line number="16" hits="1"/>
						<line number="17" hits="1"/>
						<line number="18" hits="1"/>
						<line number="19" hits="1"/>
						<line number="20" hits="1"/>
						<line number="21" hits="1"/>
						<line number="22" hits="1"/>
						<line number="23" hits="1"/>
						<line number="24" hits="1"/>
						<line number="26" hits="1"/>
						<line number="27" hits="1"/>
						<line number="28" hits="1"/>
						<line number="29" hits="1"/>
						<line number="30" hits="1"/>
						<line number="31" hits="1"/>
						<line number="32" hits="1"/>
						<line number="34" hits="1"/>
						<line number="37" hits="0"/>
						<line number="52" hits="1"/>
						<line number="53" hits="1"/>
						<line number="55" hits="1"/>
						<line number="56" hits="1"/>
						<line number="58" hits="1"/>
						<line number="64" hits="0"/>
						<line number="65" hits="0"/>
						<line number="66" hits="0"/>
						<line number="67" hits="0"/>
						<line number="70" hits="1"/>
					</lines>
				</class>
				<class name="utils.py" filename="utils.py" complexity="0" line-rate="0.8806" branch-rate="0">
					<methods/>
					<lines>
						<line number="3" hits="1"/>
						<line number="5" hits="1"/>
						<line number="6" hits="1"/>
						<line number="7" hits="1"/>
						<line number="9" hits="1"/>
						<line number="11" hits="1"/>
						<line number="12" hits="1"/>
						<line number="14" hits="1"/>
						<line number="15" hits="1"/>
						<line number="18" hits="1"/>
						<line number="29" hits="1"/>
						<line number="30" hits="1"/>
						<line number="32" hits="1"/>
						<line number="33" hits="1"/>
						<line number="34" hits="1"/>
						<line number="35" hits="1"/>
						<line number="36" hits="1"/>
						<line number="37" hits="1"/>
						<line number="39" hits="1"/>
						<line number="40" hits="1"/>
						<line number="41" hits="1"/>
						<line number="42" hits="1"/>
						<line number="43" hits="1"/>
						<line number="44" hits="1"/>
						<line number="46" hits="1"/>
						<line number="49" hits="1"/>
						<line number="52" hits="1"/>
						<line number="53" hits="1"/>
						<line number="54" hits="1"/>
						<line number="55" hits="1"/>
						<line number="56" hits="1"/>
						<line number="57" hits="1"/>
						<line number="58" hits="1"/>
						<line number="59" hits="1"/>
						<line number="60" hits="0"/>
						<line number="61" hits="0"/>
						<line number="62" hits="0"/>
						<line number="65" hits="1"/>
						<line number="68" hits="1"/>
						<line number="69" hits="1"/>
						<line number="71" hits="1"/>
						<line number="72" hits="0"/>
						<line number="74" hits="1"/>
						<line number="75" hits="1"/>
						<line number="77" hits="1"/>
						<line number="78" hits="1"/>
						<line number="79" hits="1"/>
						<line number="80" hits="1"/>
						<line number="81" hits="0"/>
						<line number="82" hits="0"/>
						<line number="84" hits="1"/>
						<line number="85" hits="1"/>
						<line number="87" hits="1"/>
						<line number="88" hits="1"/>
						<line number="89" hits="0"/>
						<line number="91" hits="1"/>
						<line number="92" hits="0"/>
						<line number="99" hits="1"/>
						<line number="102" hits="1"/>
						<line number="105" hits="1"/>
						<line number="106" hits="1"/>
						<line number="107" hits="1"/>
						<line number="108" hits="1"/>
						<line number="109" hits="1"/>
						<line number="110" hits="1"/>
						<line number="111" hits="1"/>
						<line number="114" hits="1"/>
					</lines>
				</class>
			</classes>
		</package>
	</packages>
</coverage>


--- htmlcov/class_index.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage report</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="indexfile">
<header>
    <div class="content">
        <h1>Coverage report:
            <span class="pc_cov">82%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>f</kbd>
                        <kbd>n</kbd>
                        <kbd>s</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        <kbd>c</kbd>
                        &nbsp; change column sorting
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <form id="filter_container">
            <input id="filter" type="text" value="" placeholder="filter...">
            <div>
                <input id="hide100" type="checkbox" >
                <label for="hide100">hide covered</label>
            </div>
        </form>
        <h2>
                <a class="button" href="index.html">Files</a>
                <a class="button" href="function_index.html">Functions</a>
                <a class="button current">Classes</a>
        </h2>
        <p class="text">
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
</header>
<main id="index">
    <table class="index" data-sortable>
        <thead>
            <tr class="tablehead" title="Click to sort">
                <th id="file" class="name left" aria-sort="none" data-shortcut="f">File<span class="arrows"></span></th>
                <th id="region" class="name left" aria-sort="none" data-default-sort-order="ascending" data-shortcut="n">class<span class="arrows"></span></th>
                <th id="statements" aria-sort="none" data-default-sort-order="descending" data-shortcut="s">statements<span class="arrows"></span></th>
                <th id="missing" aria-sort="none" data-default-sort-order="descending" data-shortcut="m">missing<span class="arrows"></span></th>
                <th id="excluded" aria-sort="none" data-default-sort-order="descending" data-shortcut="x">excluded<span class="arrows"></span></th>
                <th id="coverage" class="right" aria-sort="none" data-shortcut="c">coverage<span class="arrows"></span></th>
            </tr>
        </thead>
        <tbody>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87___init___py.html">src/proxtract/__init__.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87___init___py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>5</td>
                <td>0</td>
                <td>2</td>
                <td class="right" data-ratio="5 5">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87___main___py.html">src/proxtract/__main__.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87___main___py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>1</td>
                <td>1</td>
                <td>2</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>97</td>
                <td>2</td>
                <td>7</td>
                <td class="right" data-ratio="95 97">98%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t24">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t24"><data value='ProgressCallback'>ProgressCallback</data></a></td>
                <td>0</td>
                <td>0</td>
                <td>1</td>
                <td class="right" data-ratio="0 0">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t32">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t32"><data value='ExtractionStats'>ExtractionStats</data></a></td>
                <td>15</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="15 15">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t94">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t94"><data value='ExtractionError'>ExtractionError</data></a></td>
                <td>0</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="0 0">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t98">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t98"><data value='FileExtractor'>FileExtractor</data></a></td>
                <td>236</td>
                <td>50</td>
                <td>7</td>
                <td class="right" data-ratio="186 236">79%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>42</td>
                <td>0</td>
                <td>8</td>
                <td class="right" data-ratio="42 42">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t123">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t123"><data value='ProxtractCompleter'>ProxtractCompleter</data></a></td>
                <td>61</td>
                <td>20</td>
                <td>0</td>
                <td class="right" data-ratio="41 61">67%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t210">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t210"><data value='InteractiveShell'>InteractiveShell</data></a></td>
                <td>191</td>
                <td>63</td>
                <td>8</td>
                <td class="right" data-ratio="128 191">67%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>69</td>
                <td>4</td>
                <td>48</td>
                <td class="right" data-ratio="65 69">94%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html">src/proxtract/main.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>110</td>
                <td>14</td>
                <td>28</td>
                <td class="right" data-ratio="96 110">87%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t13">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t13"><data value='AppState'>AppState</data></a></td>
                <td>7</td>
                <td>5</td>
                <td>0</td>
                <td class="right" data-ratio="2 7">29%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>28</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="28 28">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html">src/proxtract/utils.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html"><data value=''><span class='no-noun'>(no class)</span></data></a></td>
                <td>67</td>
                <td>8</td>
                <td>0</td>
                <td class="right" data-ratio="59 67">88%</td>
            </tr>
        </tbody>
        <tfoot>
            <tr class="total">
                <td class="name left">Total</td>
                <td class="name left">&nbsp;</td>
                <td>929</td>
                <td>167</td>
                <td>111</td>
                <td class="right" data-ratio="762 929">82%</td>
            </tr>
        </tfoot>
    </table>
    <p id="no_rows">
        No items found using the specified filter.
    </p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
    <aside class="hidden">
        <a id="prevFileLink" class="nav" href=""></a>
        <a id="nextFileLink" class="nav" href=""></a>
        <button type="button" class="button_prev_file" data-shortcut="["></button>
        <button type="button" class="button_next_file" data-shortcut="]"></button>
        <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
    </aside>
</footer>
</body>
</html>


--- htmlcov/coverage_html_cb_6fb7b396.js ---
// Licensed under the Apache License: http://www.apache.org/licenses/LICENSE-2.0
// For details: https://github.com/nedbat/coveragepy/blob/master/NOTICE.txt

// Coverage.py HTML report browser code.
/*jslint browser: true, sloppy: true, vars: true, plusplus: true, maxerr: 50, indent: 4 */
/*global coverage: true, document, window, $ */

coverage = {};

// General helpers
function debounce(callback, wait) {
    let timeoutId = null;
    return function(...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            callback.apply(this, args);
        }, wait);
    };
};

function checkVisible(element) {
    const rect = element.getBoundingClientRect();
    const viewBottom = Math.max(document.documentElement.clientHeight, window.innerHeight);
    const viewTop = 30;
    return !(rect.bottom < viewTop || rect.top >= viewBottom);
}

function on_click(sel, fn) {
    const elt = document.querySelector(sel);
    if (elt) {
        elt.addEventListener("click", fn);
    }
}

// Helpers for table sorting
function getCellValue(row, column = 0) {
    const cell = row.cells[column]  // nosemgrep: eslint.detect-object-injection
    if (cell.childElementCount == 1) {
        var child = cell.firstElementChild;
        if (child.tagName === "A") {
            child = child.firstElementChild;
        }
        if (child instanceof HTMLDataElement && child.value) {
            return child.value;
        }
    }
    return cell.innerText || cell.textContent;
}

function rowComparator(rowA, rowB, column = 0) {
    let valueA = getCellValue(rowA, column);
    let valueB = getCellValue(rowB, column);
    if (!isNaN(valueA) && !isNaN(valueB)) {
        return valueA - valueB;
    }
    return valueA.localeCompare(valueB, undefined, {numeric: true});
}

function sortColumn(th) {
    // Get the current sorting direction of the selected header,
    // clear state on other headers and then set the new sorting direction.
    const currentSortOrder = th.getAttribute("aria-sort");
    [...th.parentElement.cells].forEach(header => header.setAttribute("aria-sort", "none"));
    var direction;
    if (currentSortOrder === "none") {
        direction = th.dataset.defaultSortOrder || "ascending";
    }
    else if (currentSortOrder === "ascending") {
        direction = "descending";
    }
    else {
        direction = "ascending";
    }
    th.setAttribute("aria-sort", direction);

    const column = [...th.parentElement.cells].indexOf(th)

    // Sort all rows and afterwards append them in order to move them in the DOM.
    Array.from(th.closest("table").querySelectorAll("tbody tr"))
        .sort((rowA, rowB) => rowComparator(rowA, rowB, column) * (direction === "ascending" ? 1 : -1))
        .forEach(tr => tr.parentElement.appendChild(tr));

    // Save the sort order for next time.
    if (th.id !== "region") {
        let th_id = "file";  // Sort by file if we don't have a column id
        let current_direction = direction;
        const stored_list = localStorage.getItem(coverage.INDEX_SORT_STORAGE);
        if (stored_list) {
            ({th_id, direction} = JSON.parse(stored_list))
        }
        localStorage.setItem(coverage.INDEX_SORT_STORAGE, JSON.stringify({
            "th_id": th.id,
            "direction": current_direction
        }));
        if (th.id !== th_id || document.getElementById("region")) {
            // Sort column has changed, unset sorting by function or class.
            localStorage.setItem(coverage.SORTED_BY_REGION, JSON.stringify({
                "by_region": false,
                "region_direction": current_direction
            }));
        }
    }
    else {
        // Sort column has changed to by function or class, remember that.
        localStorage.setItem(coverage.SORTED_BY_REGION, JSON.stringify({
            "by_region": true,
            "region_direction": direction
        }));
    }
}

// Find all the elements with data-shortcut attribute, and use them to assign a shortcut key.
coverage.assign_shortkeys = function () {
    document.querySelectorAll("[data-shortcut]").forEach(element => {
        document.addEventListener("keypress", event => {
            if (event.target.tagName.toLowerCase() === "input") {
                return; // ignore keypress from search filter
            }
            if (event.key === element.dataset.shortcut) {
                element.click();
            }
        });
    });
};

// Create the events for the filter box.
coverage.wire_up_filter = function () {
    // Populate the filter and hide100 inputs if there are saved values for them.
    const saved_filter_value = localStorage.getItem(coverage.FILTER_STORAGE);
    if (saved_filter_value) {
        document.getElementById("filter").value = saved_filter_value;
    }
    const saved_hide100_value = localStorage.getItem(coverage.HIDE100_STORAGE);
    if (saved_hide100_value) {
        document.getElementById("hide100").checked = JSON.parse(saved_hide100_value);
    }

    // Cache elements.
    const table = document.querySelector("table.index");
    const table_body_rows = table.querySelectorAll("tbody tr");
    const no_rows = document.getElementById("no_rows");

    // Observe filter keyevents.
    const filter_handler = (event => {
        // Keep running total of each metric, first index contains number of shown rows
        const totals = new Array(table.rows[0].cells.length).fill(0);
        // Accumulate the percentage as fraction
        totals[totals.length - 1] = { "numer": 0, "denom": 0 };  // nosemgrep: eslint.detect-object-injection

        var text = document.getElementById("filter").value;
        // Store filter value
        localStorage.setItem(coverage.FILTER_STORAGE, text);
        const casefold = (text === text.toLowerCase());
        const hide100 = document.getElementById("hide100").checked;
        // Store hide value.
        localStorage.setItem(coverage.HIDE100_STORAGE, JSON.stringify(hide100));

        // Hide / show elements.
        table_body_rows.forEach(row => {
            var show = false;
            // Check the text filter.
            for (let column = 0; column < totals.length; column++) {
                cell = row.cells[column];
                if (cell.classList.contains("name")) {
                    var celltext = cell.textContent;
                    if (casefold) {
                        celltext = celltext.toLowerCase();
                    }
                    if (celltext.includes(text)) {
                        show = true;
                    }
                }
            }

            // Check the "hide covered" filter.
            if (show && hide100) {
                const [numer, denom] = row.cells[row.cells.length - 1].dataset.ratio.split(" ");
                show = (numer !== denom);
            }

            if (!show) {
                // hide
                row.classList.add("hidden");
                return;
            }

            // show
            row.classList.remove("hidden");
            totals[0]++;

            for (let column = 0; column < totals.length; column++) {
                // Accumulate dynamic totals
                cell = row.cells[column]  // nosemgrep: eslint.detect-object-injection
                if (cell.classList.contains("name")) {
                    continue;
                }
                if (column === totals.length - 1) {
                    // Last column contains percentage
                    const [numer, denom] = cell.dataset.ratio.split(" ");
                    totals[column]["numer"] += parseInt(numer, 10);  // nosemgrep: eslint.detect-object-injection
                    totals[column]["denom"] += parseInt(denom, 10);  // nosemgrep: eslint.detect-object-injection
                }
                else {
                    totals[column] += parseInt(cell.textContent, 10);  // nosemgrep: eslint.detect-object-injection
                }
            }
        });

        // Show placeholder if no rows will be displayed.
        if (!totals[0]) {
            // Show placeholder, hide table.
            no_rows.style.display = "block";
            table.style.display = "none";
            return;
        }

        // Hide placeholder, show table.
        no_rows.style.display = null;
        table.style.display = null;

        const footer = table.tFoot.rows[0];
        // Calculate new dynamic sum values based on visible rows.
        for (let column = 0; column < totals.length; column++) {
            // Get footer cell element.
            const cell = footer.cells[column];  // nosemgrep: eslint.detect-object-injection
            if (cell.classList.contains("name")) {
                continue;
            }

            // Set value into dynamic footer cell element.
            if (column === totals.length - 1) {
                // Percentage column uses the numerator and denominator,
                // and adapts to the number of decimal places.
                const match = /\.([0-9]+)/.exec(cell.textContent);
                const places = match ? match[1].length : 0;
                const { numer, denom } = totals[column];  // nosemgrep: eslint.detect-object-injection
                cell.dataset.ratio = `${numer} ${denom}`;
                // Check denom to prevent NaN if filtered files contain no statements
                cell.textContent = denom
                    ? `${(numer * 100 / denom).toFixed(places)}%`
                    : `${(100).toFixed(places)}%`;
            }
            else {
                cell.textContent = totals[column];  // nosemgrep: eslint.detect-object-injection
            }
        }
    });

    document.getElementById("filter").addEventListener("input", debounce(filter_handler));
    document.getElementById("hide100").addEventListener("input", debounce(filter_handler));

    // Trigger change event on setup, to force filter on page refresh
    // (filter value may still be present).
    document.getElementById("filter").dispatchEvent(new Event("input"));
    document.getElementById("hide100").dispatchEvent(new Event("input"));
};
coverage.FILTER_STORAGE = "COVERAGE_FILTER_VALUE";
coverage.HIDE100_STORAGE = "COVERAGE_HIDE100_VALUE";

// Set up the click-to-sort columns.
coverage.wire_up_sorting = function () {
    document.querySelectorAll("[data-sortable] th[aria-sort]").forEach(
        th => th.addEventListener("click", e => sortColumn(e.target))
    );

    // Look for a localStorage item containing previous sort settings:
    let th_id = "file", direction = "ascending";
    const stored_list = localStorage.getItem(coverage.INDEX_SORT_STORAGE);
    if (stored_list) {
        ({th_id, direction} = JSON.parse(stored_list));
    }
    let by_region = false, region_direction = "ascending";
    const sorted_by_region = localStorage.getItem(coverage.SORTED_BY_REGION);
    if (sorted_by_region) {
        ({
            by_region,
            region_direction
        } = JSON.parse(sorted_by_region));
    }

    const region_id = "region";
    if (by_region && document.getElementById(region_id)) {
        direction = region_direction;
    }
    // If we are in a page that has a column with id of "region", sort on
    // it if the last sort was by function or class.
    let th;
    if (document.getElementById(region_id)) {
        th = document.getElementById(by_region ? region_id : th_id);
    }
    else {
        th = document.getElementById(th_id);
    }
    th.setAttribute("aria-sort", direction === "ascending" ? "descending" : "ascending");
    th.click()
};

coverage.INDEX_SORT_STORAGE = "COVERAGE_INDEX_SORT_2";
coverage.SORTED_BY_REGION = "COVERAGE_SORT_REGION";

// Loaded on index.html
coverage.index_ready = function () {
    coverage.assign_shortkeys();
    coverage.wire_up_filter();
    coverage.wire_up_sorting();

    on_click(".button_prev_file", coverage.to_prev_file);
    on_click(".button_next_file", coverage.to_next_file);

    on_click(".button_show_hide_help", coverage.show_hide_help);
};

// -- pyfile stuff --

coverage.LINE_FILTERS_STORAGE = "COVERAGE_LINE_FILTERS";

coverage.pyfile_ready = function () {
    // If we're directed to a particular line number, highlight the line.
    var frag = location.hash;
    if (frag.length > 2 && frag[1] === "t") {
        document.querySelector(frag).closest(".n").classList.add("highlight");
        coverage.set_sel(parseInt(frag.substr(2), 10));
    }
    else {
        coverage.set_sel(0);
    }

    on_click(".button_toggle_run", coverage.toggle_lines);
    on_click(".button_toggle_mis", coverage.toggle_lines);
    on_click(".button_toggle_exc", coverage.toggle_lines);
    on_click(".button_toggle_par", coverage.toggle_lines);

    on_click(".button_next_chunk", coverage.to_next_chunk_nicely);
    on_click(".button_prev_chunk", coverage.to_prev_chunk_nicely);
    on_click(".button_top_of_page", coverage.to_top);
    on_click(".button_first_chunk", coverage.to_first_chunk);

    on_click(".button_prev_file", coverage.to_prev_file);
    on_click(".button_next_file", coverage.to_next_file);
    on_click(".button_to_index", coverage.to_index);

    on_click(".button_show_hide_help", coverage.show_hide_help);

    coverage.filters = undefined;
    try {
        coverage.filters = localStorage.getItem(coverage.LINE_FILTERS_STORAGE);
    } catch(err) {}

    if (coverage.filters) {
        coverage.filters = JSON.parse(coverage.filters);
    }
    else {
        coverage.filters = {run: false, exc: true, mis: true, par: true};
    }

    for (cls in coverage.filters) {
        coverage.set_line_visibilty(cls, coverage.filters[cls]);  // nosemgrep: eslint.detect-object-injection
    }

    coverage.assign_shortkeys();
    coverage.init_scroll_markers();
    coverage.wire_up_sticky_header();

    document.querySelectorAll("[id^=ctxs]").forEach(
        cbox => cbox.addEventListener("click", coverage.expand_contexts)
    );

    // Rebuild scroll markers when the window height changes.
    window.addEventListener("resize", coverage.build_scroll_markers);
};

coverage.toggle_lines = function (event) {
    const btn = event.target.closest("button");
    const category = btn.value
    const show = !btn.classList.contains("show_" + category);
    coverage.set_line_visibilty(category, show);
    coverage.build_scroll_markers();
    coverage.filters[category] = show;
    try {
        localStorage.setItem(coverage.LINE_FILTERS_STORAGE, JSON.stringify(coverage.filters));
    } catch(err) {}
};

coverage.set_line_visibilty = function (category, should_show) {
    const cls = "show_" + category;
    const btn = document.querySelector(".button_toggle_" + category);
    if (btn) {
        if (should_show) {
            document.querySelectorAll("#source ." + category).forEach(e => e.classList.add(cls));
            btn.classList.add(cls);
        }
        else {
            document.querySelectorAll("#source ." + category).forEach(e => e.classList.remove(cls));
            btn.classList.remove(cls);
        }
    }
};

// Return the nth line div.
coverage.line_elt = function (n) {
    return document.getElementById("t" + n)?.closest("p");
};

// Set the selection.  b and e are line numbers.
coverage.set_sel = function (b, e) {
    // The first line selected.
    coverage.sel_begin = b;
    // The next line not selected.
    coverage.sel_end = (e === undefined) ? b+1 : e;
};

coverage.to_top = function () {
    coverage.set_sel(0, 1);
    coverage.scroll_window(0);
};

coverage.to_first_chunk = function () {
    coverage.set_sel(0, 1);
    coverage.to_next_chunk();
};

coverage.to_prev_file = function () {
    window.location = document.getElementById("prevFileLink").href;
}

coverage.to_next_file = function () {
    window.location = document.getElementById("nextFileLink").href;
}

coverage.to_index = function () {
    location.href = document.getElementById("indexLink").href;
}

coverage.show_hide_help = function () {
    const helpCheck = document.getElementById("help_panel_state")
    helpCheck.checked = !helpCheck.checked;
}

// Return a string indicating what kind of chunk this line belongs to,
// or null if not a chunk.
coverage.chunk_indicator = function (line_elt) {
    const classes = line_elt?.className;
    if (!classes) {
        return null;
    }
    const match = classes.match(/\bshow_\w+\b/);
    if (!match) {
        return null;
    }
    return match[0];
};

coverage.to_next_chunk = function () {
    const c = coverage;

    // Find the start of the next colored chunk.
    var probe = c.sel_end;
    var chunk_indicator, probe_line;
    while (true) {
        probe_line = c.line_elt(probe);
        if (!probe_line) {
            return;
        }
        chunk_indicator = c.chunk_indicator(probe_line);
        if (chunk_indicator) {
            break;
        }
        probe++;
    }

    // There's a next chunk, `probe` points to it.
    var begin = probe;

    // Find the end of this chunk.
    var next_indicator = chunk_indicator;
    while (next_indicator === chunk_indicator) {
        probe++;
        probe_line = c.line_elt(probe);
        next_indicator = c.chunk_indicator(probe_line);
    }
    c.set_sel(begin, probe);
    c.show_selection();
};

coverage.to_prev_chunk = function () {
    const c = coverage;

    // Find the end of the prev colored chunk.
    var probe = c.sel_begin-1;
    var probe_line = c.line_elt(probe);
    if (!probe_line) {
        return;
    }
    var chunk_indicator = c.chunk_indicator(probe_line);
    while (probe > 1 && !chunk_indicator) {
        probe--;
        probe_line = c.line_elt(probe);
        if (!probe_line) {
            return;
        }
        chunk_indicator = c.chunk_indicator(probe_line);
    }

    // There's a prev chunk, `probe` points to its last line.
    var end = probe+1;

    // Find the beginning of this chunk.
    var prev_indicator = chunk_indicator;
    while (prev_indicator === chunk_indicator) {
        probe--;
        if (probe <= 0) {
            return;
        }
        probe_line = c.line_elt(probe);
        prev_indicator = c.chunk_indicator(probe_line);
    }
    c.set_sel(probe+1, end);
    c.show_selection();
};

// Returns 0, 1, or 2: how many of the two ends of the selection are on
// the screen right now?
coverage.selection_ends_on_screen = function () {
    if (coverage.sel_begin === 0) {
        return 0;
    }

    const begin = coverage.line_elt(coverage.sel_begin);
    const end = coverage.line_elt(coverage.sel_end-1);

    return (
        (checkVisible(begin) ? 1 : 0)
        + (checkVisible(end) ? 1 : 0)
    );
};

coverage.to_next_chunk_nicely = function () {
    if (coverage.selection_ends_on_screen() === 0) {
        // The selection is entirely off the screen:
        // Set the top line on the screen as selection.

        // This will select the top-left of the viewport
        // As this is most likely the span with the line number we take the parent
        const line = document.elementFromPoint(0, 0).parentElement;
        if (line.parentElement !== document.getElementById("source")) {
            // The element is not a source line but the header or similar
            coverage.select_line_or_chunk(1);
        }
        else {
            // We extract the line number from the id
            coverage.select_line_or_chunk(parseInt(line.id.substring(1), 10));
        }
    }
    coverage.to_next_chunk();
};

coverage.to_prev_chunk_nicely = function () {
    if (coverage.selection_ends_on_screen() === 0) {
        // The selection is entirely off the screen:
        // Set the lowest line on the screen as selection.

        // This will select the bottom-left of the viewport
        // As this is most likely the span with the line number we take the parent
        const line = document.elementFromPoint(document.documentElement.clientHeight-1, 0).parentElement;
        if (line.parentElement !== document.getElementById("source")) {
            // The element is not a source line but the header or similar
            coverage.select_line_or_chunk(coverage.lines_len);
        }
        else {
            // We extract the line number from the id
            coverage.select_line_or_chunk(parseInt(line.id.substring(1), 10));
        }
    }
    coverage.to_prev_chunk();
};

// Select line number lineno, or if it is in a colored chunk, select the
// entire chunk
coverage.select_line_or_chunk = function (lineno) {
    var c = coverage;
    var probe_line = c.line_elt(lineno);
    if (!probe_line) {
        return;
    }
    var the_indicator = c.chunk_indicator(probe_line);
    if (the_indicator) {
        // The line is in a highlighted chunk.
        // Search backward for the first line.
        var probe = lineno;
        var indicator = the_indicator;
        while (probe > 0 && indicator === the_indicator) {
            probe--;
            probe_line = c.line_elt(probe);
            if (!probe_line) {
                break;
            }
            indicator = c.chunk_indicator(probe_line);
        }
        var begin = probe + 1;

        // Search forward for the last line.
        probe = lineno;
        indicator = the_indicator;
        while (indicator === the_indicator) {
            probe++;
            probe_line = c.line_elt(probe);
            indicator = c.chunk_indicator(probe_line);
        }

        coverage.set_sel(begin, probe);
    }
    else {
        coverage.set_sel(lineno);
    }
};

coverage.show_selection = function () {
    // Highlight the lines in the chunk
    document.querySelectorAll("#source .highlight").forEach(e => e.classList.remove("highlight"));
    for (let probe = coverage.sel_begin; probe < coverage.sel_end; probe++) {
        coverage.line_elt(probe).querySelector(".n").classList.add("highlight");
    }

    coverage.scroll_to_selection();
};

coverage.scroll_to_selection = function () {
    // Scroll the page if the chunk isn't fully visible.
    if (coverage.selection_ends_on_screen() < 2) {
        const element = coverage.line_elt(coverage.sel_begin);
        coverage.scroll_window(element.offsetTop - 60);
    }
};

coverage.scroll_window = function (to_pos) {
    window.scroll({top: to_pos, behavior: "smooth"});
};

coverage.init_scroll_markers = function () {
    // Init some variables
    coverage.lines_len = document.querySelectorAll("#source > p").length;

    // Build html
    coverage.build_scroll_markers();
};

coverage.build_scroll_markers = function () {
    const temp_scroll_marker = document.getElementById("scroll_marker")
    if (temp_scroll_marker) temp_scroll_marker.remove();
    // Don't build markers if the window has no scroll bar.
    if (document.body.scrollHeight <= window.innerHeight) {
        return;
    }

    const marker_scale = window.innerHeight / document.body.scrollHeight;
    const line_height = Math.min(Math.max(3, window.innerHeight / coverage.lines_len), 10);

    let previous_line = -99, last_mark, last_top;

    const scroll_marker = document.createElement("div");
    scroll_marker.id = "scroll_marker";
    document.getElementById("source").querySelectorAll(
        "p.show_run, p.show_mis, p.show_exc, p.show_exc, p.show_par"
    ).forEach(element => {
        const line_top = Math.floor(element.offsetTop * marker_scale);
        const line_number = parseInt(element.querySelector(".n a").id.substr(1));

        if (line_number === previous_line + 1) {
            // If this solid missed block just make previous mark higher.
            last_mark.style.height = `${line_top + line_height - last_top}px`;
        }
        else {
            // Add colored line in scroll_marker block.
            last_mark = document.createElement("div");
            last_mark.id = `m${line_number}`;
            last_mark.classList.add("marker");
            last_mark.style.height = `${line_height}px`;
            last_mark.style.top = `${line_top}px`;
            scroll_marker.append(last_mark);
            last_top = line_top;
        }

        previous_line = line_number;
    });

    // Append last to prevent layout calculation
    document.body.append(scroll_marker);
};

coverage.wire_up_sticky_header = function () {
    const header = document.querySelector("header");
    const header_bottom = (
        header.querySelector(".content h2").getBoundingClientRect().top -
        header.getBoundingClientRect().top
    );

    function updateHeader() {
        if (window.scrollY > header_bottom) {
            header.classList.add("sticky");
        }
        else {
            header.classList.remove("sticky");
        }
    }

    window.addEventListener("scroll", updateHeader);
    updateHeader();
};

coverage.expand_contexts = function (e) {
    var ctxs = e.target.parentNode.querySelector(".ctxs");

    if (!ctxs.classList.contains("expanded")) {
        var ctxs_text = ctxs.textContent;
        var width = Number(ctxs_text[0]);
        ctxs.textContent = "";
        for (var i = 1; i < ctxs_text.length; i += width) {
            key = ctxs_text.substring(i, i + width).trim();
            ctxs.appendChild(document.createTextNode(contexts[key]));
            ctxs.appendChild(document.createElement("br"));
        }
        ctxs.classList.add("expanded");
    }
};

document.addEventListener("DOMContentLoaded", () => {
    if (document.body.classList.contains("indexfile")) {
        coverage.index_ready();
    }
    else {
        coverage.pyfile_ready();
    }
});


--- htmlcov/function_index.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage report</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="indexfile">
<header>
    <div class="content">
        <h1>Coverage report:
            <span class="pc_cov">82%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>f</kbd>
                        <kbd>n</kbd>
                        <kbd>s</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        <kbd>c</kbd>
                        &nbsp; change column sorting
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <form id="filter_container">
            <input id="filter" type="text" value="" placeholder="filter...">
            <div>
                <input id="hide100" type="checkbox" >
                <label for="hide100">hide covered</label>
            </div>
        </form>
        <h2>
                <a class="button" href="index.html">Files</a>
                <a class="button current">Functions</a>
                <a class="button" href="class_index.html">Classes</a>
        </h2>
        <p class="text">
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
</header>
<main id="index">
    <table class="index" data-sortable>
        <thead>
            <tr class="tablehead" title="Click to sort">
                <th id="file" class="name left" aria-sort="none" data-shortcut="f">File<span class="arrows"></span></th>
                <th id="region" class="name left" aria-sort="none" data-default-sort-order="ascending" data-shortcut="n">function<span class="arrows"></span></th>
                <th id="statements" aria-sort="none" data-default-sort-order="descending" data-shortcut="s">statements<span class="arrows"></span></th>
                <th id="missing" aria-sort="none" data-default-sort-order="descending" data-shortcut="m">missing<span class="arrows"></span></th>
                <th id="excluded" aria-sort="none" data-default-sort-order="descending" data-shortcut="x">excluded<span class="arrows"></span></th>
                <th id="coverage" class="right" aria-sort="none" data-shortcut="c">coverage<span class="arrows"></span></th>
            </tr>
        </thead>
        <tbody>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87___init___py.html">src/proxtract/__init__.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87___init___py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>5</td>
                <td>0</td>
                <td>2</td>
                <td class="right" data-ratio="5 5">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87___main___py.html">src/proxtract/__main__.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87___main___py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>1</td>
                <td>1</td>
                <td>2</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t25">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t25"><data value='config_path'>_config_path</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t29">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t29"><data value='load_config'>load_config</data></a></td>
                <td>7</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="7 7">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t39">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t39"><data value='apply_config'>apply_config</data></a></td>
                <td>37</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="37 37">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t44">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t44"><data value='safe_int'>apply_config.safe_int</data></a></td>
                <td>4</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="4 4">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t99">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t99"><data value='save_config'>save_config</data></a></td>
                <td>30</td>
                <td>2</td>
                <td>0</td>
                <td class="right" data-ratio="28 30">93%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t121">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t121"><data value='serialize_optional_iterable'>save_config._serialize_optional_iterable</data></a></td>
                <td>3</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="3 3">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t141">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html#t141"><data value='escape'>save_config._escape</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html">src/proxtract/config.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>14</td>
                <td>0</td>
                <td>7</td>
                <td class="right" data-ratio="14 14">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t27">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t27"><data value='call__'>ProgressCallback.__call__</data></a></td>
                <td>0</td>
                <td>0</td>
                <td>1</td>
                <td class="right" data-ratio="0 0">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t45">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t45"><data value='processed_files'>ExtractionStats.processed_files</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t51">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t51"><data value='skipped'>ExtractionStats.skipped</data></a></td>
                <td>8</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="8 8">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t74">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t74"><data value='as_dict'>ExtractionStats.as_dict</data></a></td>
                <td>6</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="6 6">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t101">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t101"><data value='init__'>FileExtractor.__init__</data></a></td>
                <td>19</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="19 19">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t152">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t152"><data value='coerce_set'>FileExtractor.__init__._coerce_set</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t155">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t155"><data value='coerce_extensions'>FileExtractor.__init__._coerce_extensions</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t168">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t168"><data value='rel'>FileExtractor._rel</data></a></td>
                <td>2</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="2 2">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t173">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t173"><data value='match_any'>FileExtractor._match_any</data></a></td>
                <td>4</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="4 4">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t179">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t179"><data value='should_skip'>FileExtractor._should_skip</data></a></td>
                <td>28</td>
                <td>3</td>
                <td>0</td>
                <td class="right" data-ratio="25 28">89%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t226">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t226"><data value='is_text_file'>FileExtractor._is_text_file</data></a></td>
                <td>32</td>
                <td>4</td>
                <td>0</td>
                <td class="right" data-ratio="28 32">88%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t308">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t308"><data value='read_file_content'>FileExtractor._read_file_content</data></a></td>
                <td>8</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="7 8">88%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t318">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t318"><data value='format_compact'>FileExtractor._format_compact</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t321">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t321"><data value='format_standard'>FileExtractor._format_standard</data></a></td>
                <td>2</td>
                <td>2</td>
                <td>0</td>
                <td class="right" data-ratio="0 2">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t325">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t325"><data value='extract'>FileExtractor.extract</data></a></td>
                <td>132</td>
                <td>38</td>
                <td>7</td>
                <td class="right" data-ratio="94 132">71%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t425">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html#t425"><data value='report'>FileExtractor.extract.report</data></a></td>
                <td>6</td>
                <td>2</td>
                <td>0</td>
                <td class="right" data-ratio="4 6">67%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html">src/proxtract/core.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>42</td>
                <td>0</td>
                <td>8</td>
                <td class="right" data-ratio="42 42">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t105">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t105"><data value='history_path'>_history_path</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t109">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t109"><data value='tokenize'>_tokenize</data></a></td>
                <td>10</td>
                <td>2</td>
                <td>0</td>
                <td class="right" data-ratio="8 10">80%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t126">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t126"><data value='init__'>ProxtractCompleter.__init__</data></a></td>
                <td>5</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="5 5">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t133">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t133"><data value='complete_from_word_completer'>ProxtractCompleter._complete_from_word_completer</data></a></td>
                <td>12</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="12 12">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t149">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t149"><data value='complete_path'>ProxtractCompleter._complete_path</data></a></td>
                <td>4</td>
                <td>4</td>
                <td>0</td>
                <td class="right" data-ratio="0 4">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t160">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t160"><data value='get_completions'>ProxtractCompleter.get_completions</data></a></td>
                <td>40</td>
                <td>16</td>
                <td>0</td>
                <td class="right" data-ratio="24 40">60%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t215">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t215"><data value='init__'>InteractiveShell.__init__</data></a></td>
                <td>5</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="5 5">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t222">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t222"><data value='run'>InteractiveShell.run</data></a></td>
                <td>17</td>
                <td>17</td>
                <td>0</td>
                <td class="right" data-ratio="0 17">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t241">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t241"><data value='handle_command'>InteractiveShell.handle_command</data></a></td>
                <td>25</td>
                <td>3</td>
                <td>0</td>
                <td class="right" data-ratio="22 25">88%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t270">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t270"><data value='render_banner'>InteractiveShell._render_banner</data></a></td>
                <td>5</td>
                <td>5</td>
                <td>0</td>
                <td class="right" data-ratio="0 5">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t277">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t277"><data value='ensure_session'>InteractiveShell._ensure_session</data></a></td>
                <td>12</td>
                <td>12</td>
                <td>0</td>
                <td class="right" data-ratio="0 12">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t299">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t299"><data value='show_help'>InteractiveShell._show_help</data></a></td>
                <td>10</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="10 10">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t311">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t311"><data value='show_config'>InteractiveShell._show_config</data></a></td>
                <td>6</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="6 6">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t319">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t319"><data value='iter_config'>InteractiveShell._iter_config</data></a></td>
                <td>13</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="13 13">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t334">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t334"><data value='set_value'>InteractiveShell._set_value</data></a></td>
                <td>15</td>
                <td>2</td>
                <td>0</td>
                <td class="right" data-ratio="13 15">87%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t351">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t351"><data value='parse_bool'>InteractiveShell._parse_bool</data></a></td>
                <td>6</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="6 6">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t359">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t359"><data value='set_source_path'>InteractiveShell._set_source_path</data></a></td>
                <td>4</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="3 4">75%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t365">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t365"><data value='set_output_path'>InteractiveShell._set_output_path</data></a></td>
                <td>2</td>
                <td>2</td>
                <td>0</td>
                <td class="right" data-ratio="0 2">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t369">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t369"><data value='set_max_size_kb'>InteractiveShell._set_max_size_kb</data></a></td>
                <td>4</td>
                <td>4</td>
                <td>0</td>
                <td class="right" data-ratio="0 4">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t375">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t375"><data value='set_compact_mode'>InteractiveShell._set_compact_mode</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t378">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t378"><data value='set_skip_empty'>InteractiveShell._set_skip_empty</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t381">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t381"><data value='set_use_gitignore'>InteractiveShell._set_use_gitignore</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t384">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t384"><data value='set_force_include'>InteractiveShell._set_force_include</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t387">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t387"><data value='set_include_patterns'>InteractiveShell._set_include_patterns</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t390">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t390"><data value='set_exclude_patterns'>InteractiveShell._set_exclude_patterns</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t393">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t393"><data value='set_count_tokens'>InteractiveShell._set_count_tokens</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t396">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t396"><data value='set_tokenizer_model'>InteractiveShell._set_tokenizer_model</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t399">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t399"><data value='set_copy_clipboard'>InteractiveShell._set_copy_clipboard</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t402">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t402"><data value='parse_patterns'>InteractiveShell._parse_patterns</data></a></td>
                <td>3</td>
                <td>3</td>
                <td>0</td>
                <td class="right" data-ratio="0 3">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t407">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t407"><data value='run_extract'>InteractiveShell._run_extract</data></a></td>
                <td>25</td>
                <td>6</td>
                <td>3</td>
                <td class="right" data-ratio="19 25">76%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t432">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t432"><data value='callback'>InteractiveShell._run_extract._callback</data></a></td>
                <td>4</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="4 4">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t452">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t452"><data value='build_summary_panel'>InteractiveShell._build_summary_panel</data></a></td>
                <td>18</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="18 18">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t472">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t472"><data value='try_copy'>InteractiveShell._try_copy</data></a></td>
                <td>5</td>
                <td>0</td>
                <td>2</td>
                <td class="right" data-ratio="5 5">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t482">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t482"><data value='save_config_command'>InteractiveShell._save_config_command</data></a></td>
                <td>3</td>
                <td>0</td>
                <td>3</td>
                <td class="right" data-ratio="3 3">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t491">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html#t491"><data value='run_interactive'>run_interactive</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html">src/proxtract/interactive.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>57</td>
                <td>0</td>
                <td>48</td>
                <td class="right" data-ratio="57 57">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html#t29">src/proxtract/main.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html#t29"><data value='run_cli_extract'>_run_cli_extract</data></a></td>
                <td>59</td>
                <td>13</td>
                <td>4</td>
                <td class="right" data-ratio="46 59">78%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html#t107">src/proxtract/main.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html#t107"><data value='main'>main</data></a></td>
                <td>35</td>
                <td>1</td>
                <td>15</td>
                <td class="right" data-ratio="34 35">97%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html">src/proxtract/main.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>16</td>
                <td>0</td>
                <td>9</td>
                <td class="right" data-ratio="16 16">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t34">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t34"><data value='create_extractor'>AppState.create_extractor</data></a></td>
                <td>1</td>
                <td>1</td>
                <td>0</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t52">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t52"><data value='set_output_path'>AppState.set_output_path</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t55">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t55"><data value='set_source_root'>AppState.set_source_root</data></a></td>
                <td>1</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="1 1">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t58">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html#t58"><data value='set_patterns'>AppState.set_patterns</data></a></td>
                <td>4</td>
                <td>4</td>
                <td>0</td>
                <td class="right" data-ratio="0 4">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html">src/proxtract/state.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>28</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="28 28">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t18">src/proxtract/utils.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t18"><data value='normalize_bool'>normalize_bool</data></a></td>
                <td>15</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="15 15">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t49">src/proxtract/utils.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t49"><data value='env_flag'>_env_flag</data></a></td>
                <td>11</td>
                <td>3</td>
                <td>0</td>
                <td class="right" data-ratio="8 11">73%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t65">src/proxtract/utils.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t65"><data value='supports_color'>supports_color</data></a></td>
                <td>20</td>
                <td>5</td>
                <td>0</td>
                <td class="right" data-ratio="15 20">75%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t102">src/proxtract/utils.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html#t102"><data value='create_console'>create_console</data></a></td>
                <td>7</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="7 7">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html">src/proxtract/utils.py</a></td>
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html"><data value=''><span class='no-noun'>(no function)</span></data></a></td>
                <td>14</td>
                <td>0</td>
                <td>0</td>
                <td class="right" data-ratio="14 14">100%</td>
            </tr>
        </tbody>
        <tfoot>
            <tr class="total">
                <td class="name left">Total</td>
                <td class="name left">&nbsp;</td>
                <td>929</td>
                <td>167</td>
                <td>111</td>
                <td class="right" data-ratio="762 929">82%</td>
            </tr>
        </tfoot>
    </table>
    <p id="no_rows">
        No items found using the specified filter.
    </p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
    <aside class="hidden">
        <a id="prevFileLink" class="nav" href=""></a>
        <a id="nextFileLink" class="nav" href=""></a>
        <button type="button" class="button_prev_file" data-shortcut="["></button>
        <button type="button" class="button_next_file" data-shortcut="]"></button>
        <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
    </aside>
</footer>
</body>
</html>


--- htmlcov/index.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage report</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="indexfile">
<header>
    <div class="content">
        <h1>Coverage report:
            <span class="pc_cov">82%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>f</kbd>
                        <kbd>s</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        <kbd>c</kbd>
                        &nbsp; change column sorting
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <form id="filter_container">
            <input id="filter" type="text" value="" placeholder="filter...">
            <div>
                <input id="hide100" type="checkbox" >
                <label for="hide100">hide covered</label>
            </div>
        </form>
        <h2>
                <a class="button current">Files</a>
                <a class="button" href="function_index.html">Functions</a>
                <a class="button" href="class_index.html">Classes</a>
        </h2>
        <p class="text">
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
</header>
<main id="index">
    <table class="index" data-sortable>
        <thead>
            <tr class="tablehead" title="Click to sort">
                <th id="file" class="name left" aria-sort="none" data-shortcut="f">File<span class="arrows"></span></th>
                <th id="statements" aria-sort="none" data-default-sort-order="descending" data-shortcut="s">statements<span class="arrows"></span></th>
                <th id="missing" aria-sort="none" data-default-sort-order="descending" data-shortcut="m">missing<span class="arrows"></span></th>
                <th id="excluded" aria-sort="none" data-default-sort-order="descending" data-shortcut="x">excluded<span class="arrows"></span></th>
                <th id="coverage" class="right" aria-sort="none" data-shortcut="c">coverage<span class="arrows"></span></th>
            </tr>
        </thead>
        <tbody>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87___init___py.html">src/proxtract/__init__.py</a></td>
                <td>5</td>
                <td>0</td>
                <td>2</td>
                <td class="right" data-ratio="5 5">100%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87___main___py.html">src/proxtract/__main__.py</a></td>
                <td>1</td>
                <td>1</td>
                <td>2</td>
                <td class="right" data-ratio="0 1">0%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_config_py.html">src/proxtract/config.py</a></td>
                <td>97</td>
                <td>2</td>
                <td>7</td>
                <td class="right" data-ratio="95 97">98%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_core_py.html">src/proxtract/core.py</a></td>
                <td>293</td>
                <td>50</td>
                <td>16</td>
                <td class="right" data-ratio="243 293">83%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_interactive_py.html">src/proxtract/interactive.py</a></td>
                <td>321</td>
                <td>87</td>
                <td>56</td>
                <td class="right" data-ratio="234 321">73%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_main_py.html">src/proxtract/main.py</a></td>
                <td>110</td>
                <td>14</td>
                <td>28</td>
                <td class="right" data-ratio="96 110">87%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_state_py.html">src/proxtract/state.py</a></td>
                <td>35</td>
                <td>5</td>
                <td>0</td>
                <td class="right" data-ratio="30 35">86%</td>
            </tr>
            <tr class="region">
                <td class="name left"><a href="z_89a6376cf0395b87_utils_py.html">src/proxtract/utils.py</a></td>
                <td>67</td>
                <td>8</td>
                <td>0</td>
                <td class="right" data-ratio="59 67">88%</td>
            </tr>
        </tbody>
        <tfoot>
            <tr class="total">
                <td class="name left">Total</td>
                <td>929</td>
                <td>167</td>
                <td>111</td>
                <td class="right" data-ratio="762 929">82%</td>
            </tr>
        </tfoot>
    </table>
    <p id="no_rows">
        No items found using the specified filter.
    </p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
    <aside class="hidden">
        <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87_utils_py.html"></a>
        <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87___init___py.html"></a>
        <button type="button" class="button_prev_file" data-shortcut="["></button>
        <button type="button" class="button_next_file" data-shortcut="]"></button>
        <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
    </aside>
</footer>
</body>
</html>


--- htmlcov/status.json ---
{"note":"This file is an internal implementation detail to speed up HTML report generation. Its format can change at any time. You might be looking for the JSON report: https://coverage.rtfd.io/cmd.html#cmd-json","format":5,"version":"7.11.0","globals":"58f3a109cdd72be838211e5c68ad81be","files":{"z_89a6376cf0395b87___init___py":{"hash":"f47f59bc51641216295761c3da6d6f85","index":{"url":"z_89a6376cf0395b87___init___py.html","file":"src/proxtract/__init__.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":5,"n_excluded":2,"n_missing":0,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87___main___py":{"hash":"04f0aaeff0f0cf828fad7ac8d45209fb","index":{"url":"z_89a6376cf0395b87___main___py.html","file":"src/proxtract/__main__.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":1,"n_excluded":2,"n_missing":1,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87_config_py":{"hash":"4eae89fbd11db8105d8cec783bb7bfef","index":{"url":"z_89a6376cf0395b87_config_py.html","file":"src/proxtract/config.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":97,"n_excluded":7,"n_missing":2,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87_core_py":{"hash":"923396bc035fe8c51a9c66b4f3f281d4","index":{"url":"z_89a6376cf0395b87_core_py.html","file":"src/proxtract/core.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":293,"n_excluded":16,"n_missing":50,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87_interactive_py":{"hash":"08f8acc80d9dd3cf553b98e44b803c0f","index":{"url":"z_89a6376cf0395b87_interactive_py.html","file":"src/proxtract/interactive.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":321,"n_excluded":56,"n_missing":87,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87_main_py":{"hash":"e0c8760f77eacea624ebbb45e330dcdc","index":{"url":"z_89a6376cf0395b87_main_py.html","file":"src/proxtract/main.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":110,"n_excluded":28,"n_missing":14,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87_state_py":{"hash":"d8015c37e15cc133a43ccf2cab02b3ff","index":{"url":"z_89a6376cf0395b87_state_py.html","file":"src/proxtract/state.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":35,"n_excluded":0,"n_missing":5,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}},"z_89a6376cf0395b87_utils_py":{"hash":"e68fd9321e4809ca0b14071587869dba","index":{"url":"z_89a6376cf0395b87_utils_py.html","file":"src/proxtract/utils.py","description":"","nums":{"precision":0,"n_files":1,"n_statements":67,"n_excluded":0,"n_missing":8,"n_branches":0,"n_partial_branches":0,"n_missing_branches":0}}}}}

--- htmlcov/style_cb_6b508a39.css ---
@charset "UTF-8";
/* Licensed under the Apache License: http://www.apache.org/licenses/LICENSE-2.0 */
/* For details: https://github.com/nedbat/coveragepy/blob/master/NOTICE.txt */
/* Don't edit this .css file. Edit the .scss file instead! */
html, body, h1, h2, h3, p, table, td, th { margin: 0; padding: 0; border: 0; font-weight: inherit; font-style: inherit; font-size: 100%; font-family: inherit; vertical-align: baseline; }

body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; font-size: 1em; background: #fff; color: #000; }

@media (prefers-color-scheme: dark) { body { background: #1e1e1e; } }

@media (prefers-color-scheme: dark) { body { color: #eee; } }

html > body { font-size: 16px; }

a:active, a:focus { outline: 2px dashed #007acc; }

p { font-size: .875em; line-height: 1.4em; }

table { border-collapse: collapse; }

td { vertical-align: top; }

table tr.hidden { display: none !important; }

p#no_rows { display: none; font-size: 1.15em; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; }

a.nav { text-decoration: none; color: inherit; }

a.nav:hover { text-decoration: underline; color: inherit; }

.hidden { display: none; }

header { background: #f8f8f8; width: 100%; z-index: 2; border-bottom: 1px solid #ccc; }

@media (prefers-color-scheme: dark) { header { background: black; } }

@media (prefers-color-scheme: dark) { header { border-color: #333; } }

header .content { padding: 1rem 3.5rem; }

header h2 { margin-top: .5em; font-size: 1em; }

header h2 a.button { font-family: inherit; font-size: inherit; border: 1px solid; border-radius: .2em; background: #eee; color: inherit; text-decoration: none; padding: .1em .5em; margin: 1px calc(.1em + 1px); cursor: pointer; border-color: #ccc; }

@media (prefers-color-scheme: dark) { header h2 a.button { background: #333; } }

@media (prefers-color-scheme: dark) { header h2 a.button { border-color: #444; } }

header h2 a.button.current { border: 2px solid; background: #fff; border-color: #999; cursor: default; }

@media (prefers-color-scheme: dark) { header h2 a.button.current { background: #1e1e1e; } }

@media (prefers-color-scheme: dark) { header h2 a.button.current { border-color: #777; } }

header p.text { margin: .5em 0 -.5em; color: #666; font-style: italic; }

@media (prefers-color-scheme: dark) { header p.text { color: #aaa; } }

header.sticky { position: fixed; left: 0; right: 0; height: 2.5em; }

header.sticky .text { display: none; }

header.sticky h1, header.sticky h2 { font-size: 1em; margin-top: 0; display: inline-block; }

header.sticky .content { padding: 0.5rem 3.5rem; }

header.sticky .content p { font-size: 1em; }

header.sticky ~ #source { padding-top: 6.5em; }

main { position: relative; z-index: 1; }

footer { margin: 1rem 3.5rem; }

footer .content { padding: 0; color: #666; font-style: italic; }

@media (prefers-color-scheme: dark) { footer .content { color: #aaa; } }

#index { margin: 1rem 0 0 3.5rem; }

h1 { font-size: 1.25em; display: inline-block; }

#filter_container { float: right; margin: 0 2em 0 0; line-height: 1.66em; }

#filter_container #filter { width: 10em; padding: 0.2em 0.5em; border: 2px solid #ccc; background: #fff; color: #000; }

@media (prefers-color-scheme: dark) { #filter_container #filter { border-color: #444; } }

@media (prefers-color-scheme: dark) { #filter_container #filter { background: #1e1e1e; } }

@media (prefers-color-scheme: dark) { #filter_container #filter { color: #eee; } }

#filter_container #filter:focus { border-color: #007acc; }

#filter_container :disabled ~ label { color: #ccc; }

@media (prefers-color-scheme: dark) { #filter_container :disabled ~ label { color: #444; } }

#filter_container label { font-size: .875em; color: #666; }

@media (prefers-color-scheme: dark) { #filter_container label { color: #aaa; } }

header button { font-family: inherit; font-size: inherit; border: 1px solid; border-radius: .2em; background: #eee; color: inherit; text-decoration: none; padding: .1em .5em; margin: 1px calc(.1em + 1px); cursor: pointer; border-color: #ccc; }

@media (prefers-color-scheme: dark) { header button { background: #333; } }

@media (prefers-color-scheme: dark) { header button { border-color: #444; } }

header button:active, header button:focus { outline: 2px dashed #007acc; }

header button.run { background: #eeffee; }

@media (prefers-color-scheme: dark) { header button.run { background: #373d29; } }

header button.run.show_run { background: #dfd; border: 2px solid #00dd00; margin: 0 .1em; }

@media (prefers-color-scheme: dark) { header button.run.show_run { background: #373d29; } }

header button.mis { background: #ffeeee; }

@media (prefers-color-scheme: dark) { header button.mis { background: #4b1818; } }

header button.mis.show_mis { background: #fdd; border: 2px solid #ff0000; margin: 0 .1em; }

@media (prefers-color-scheme: dark) { header button.mis.show_mis { background: #4b1818; } }

header button.exc { background: #f7f7f7; }

@media (prefers-color-scheme: dark) { header button.exc { background: #333; } }

header button.exc.show_exc { background: #eee; border: 2px solid #808080; margin: 0 .1em; }

@media (prefers-color-scheme: dark) { header button.exc.show_exc { background: #333; } }

header button.par { background: #ffffd5; }

@media (prefers-color-scheme: dark) { header button.par { background: #650; } }

header button.par.show_par { background: #ffa; border: 2px solid #bbbb00; margin: 0 .1em; }

@media (prefers-color-scheme: dark) { header button.par.show_par { background: #650; } }

#help_panel, #source p .annotate.long { display: none; position: absolute; z-index: 999; background: #ffffcc; border: 1px solid #888; border-radius: .2em; color: #333; padding: .25em .5em; }

#source p .annotate.long { white-space: normal; float: right; top: 1.75em; right: 1em; height: auto; }

#help_panel_wrapper { float: right; position: relative; }

#keyboard_icon { margin: 5px; }

#help_panel_state { display: none; }

#help_panel { top: 25px; right: 0; padding: .75em; border: 1px solid #883; color: #333; }

#help_panel .keyhelp p { margin-top: .75em; }

#help_panel .legend { font-style: italic; margin-bottom: 1em; }

.indexfile #help_panel { width: 25em; }

.pyfile #help_panel { width: 18em; }

#help_panel_state:checked ~ #help_panel { display: block; }

kbd { border: 1px solid black; border-color: #888 #333 #333 #888; padding: .1em .35em; font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-weight: bold; background: #eee; border-radius: 3px; }

#source { padding: 1em 0 1em 3.5rem; font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace; }

#source p { position: relative; white-space: pre; }

#source p * { box-sizing: border-box; }

#source p .n { float: left; text-align: right; width: 3.5rem; box-sizing: border-box; margin-left: -3.5rem; padding-right: 1em; color: #999; user-select: none; }

@media (prefers-color-scheme: dark) { #source p .n { color: #777; } }

#source p .n.highlight { background: #ffdd00; }

#source p .n a { scroll-margin-top: 6em; text-decoration: none; color: #999; }

@media (prefers-color-scheme: dark) { #source p .n a { color: #777; } }

#source p .n a:hover { text-decoration: underline; color: #999; }

@media (prefers-color-scheme: dark) { #source p .n a:hover { color: #777; } }

#source p .t { display: inline-block; width: 100%; box-sizing: border-box; margin-left: -.5em; padding-left: 0.3em; border-left: 0.2em solid #fff; }

@media (prefers-color-scheme: dark) { #source p .t { border-color: #1e1e1e; } }

#source p .t:hover { background: #f2f2f2; }

@media (prefers-color-scheme: dark) { #source p .t:hover { background: #282828; } }

#source p .t:hover ~ .r .annotate.long { display: block; }

#source p .t .com { color: #008000; font-style: italic; line-height: 1px; }

@media (prefers-color-scheme: dark) { #source p .t .com { color: #6a9955; } }

#source p .t .key { font-weight: bold; line-height: 1px; }

#source p .t .str, #source p .t .fst { color: #0451a5; }

@media (prefers-color-scheme: dark) { #source p .t .str, #source p .t .fst { color: #9cdcfe; } }

#source p.mis .t { border-left: 0.2em solid #ff0000; }

#source p.mis.show_mis .t { background: #fdd; }

@media (prefers-color-scheme: dark) { #source p.mis.show_mis .t { background: #4b1818; } }

#source p.mis.show_mis .t:hover { background: #f2d2d2; }

@media (prefers-color-scheme: dark) { #source p.mis.show_mis .t:hover { background: #532323; } }

#source p.mis.mis2 .t { border-left: 0.2em dotted #ff0000; }

#source p.mis.mis2.show_mis .t { background: #ffeeee; }

@media (prefers-color-scheme: dark) { #source p.mis.mis2.show_mis .t { background: #351b1b; } }

#source p.mis.mis2.show_mis .t:hover { background: #f2d2d2; }

@media (prefers-color-scheme: dark) { #source p.mis.mis2.show_mis .t:hover { background: #532323; } }

#source p.run .t { border-left: 0.2em solid #00dd00; }

#source p.run.show_run .t { background: #dfd; }

@media (prefers-color-scheme: dark) { #source p.run.show_run .t { background: #373d29; } }

#source p.run.show_run .t:hover { background: #d2f2d2; }

@media (prefers-color-scheme: dark) { #source p.run.show_run .t:hover { background: #404633; } }

#source p.run.run2 .t { border-left: 0.2em dotted #00dd00; }

#source p.run.run2.show_run .t { background: #eeffee; }

@media (prefers-color-scheme: dark) { #source p.run.run2.show_run .t { background: #2b2e24; } }

#source p.run.run2.show_run .t:hover { background: #d2f2d2; }

@media (prefers-color-scheme: dark) { #source p.run.run2.show_run .t:hover { background: #404633; } }

#source p.exc .t { border-left: 0.2em solid #808080; }

#source p.exc.show_exc .t { background: #eee; }

@media (prefers-color-scheme: dark) { #source p.exc.show_exc .t { background: #333; } }

#source p.exc.show_exc .t:hover { background: #e2e2e2; }

@media (prefers-color-scheme: dark) { #source p.exc.show_exc .t:hover { background: #3c3c3c; } }

#source p.exc.exc2 .t { border-left: 0.2em dotted #808080; }

#source p.exc.exc2.show_exc .t { background: #f7f7f7; }

@media (prefers-color-scheme: dark) { #source p.exc.exc2.show_exc .t { background: #292929; } }

#source p.exc.exc2.show_exc .t:hover { background: #e2e2e2; }

@media (prefers-color-scheme: dark) { #source p.exc.exc2.show_exc .t:hover { background: #3c3c3c; } }

#source p.par .t { border-left: 0.2em solid #bbbb00; }

#source p.par.show_par .t { background: #ffa; }

@media (prefers-color-scheme: dark) { #source p.par.show_par .t { background: #650; } }

#source p.par.show_par .t:hover { background: #f2f2a2; }

@media (prefers-color-scheme: dark) { #source p.par.show_par .t:hover { background: #6d5d0c; } }

#source p.par.par2 .t { border-left: 0.2em dotted #bbbb00; }

#source p.par.par2.show_par .t { background: #ffffd5; }

@media (prefers-color-scheme: dark) { #source p.par.par2.show_par .t { background: #423a0f; } }

#source p.par.par2.show_par .t:hover { background: #f2f2a2; }

@media (prefers-color-scheme: dark) { #source p.par.par2.show_par .t:hover { background: #6d5d0c; } }

#source p .r { position: absolute; top: 0; right: 2.5em; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; }

#source p .annotate { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; color: #666; padding-right: .5em; }

@media (prefers-color-scheme: dark) { #source p .annotate { color: #ddd; } }

#source p .annotate.short:hover ~ .long { display: block; }

#source p .annotate.long { width: 30em; right: 2.5em; }

#source p input { display: none; }

#source p input ~ .r label.ctx { cursor: pointer; border-radius: .25em; }

#source p input ~ .r label.ctx::before { content: " "; }

#source p input ~ .r label.ctx:hover { background: #e8f4ff; color: #666; }

@media (prefers-color-scheme: dark) { #source p input ~ .r label.ctx:hover { background: #0f3a42; } }

@media (prefers-color-scheme: dark) { #source p input ~ .r label.ctx:hover { color: #aaa; } }

#source p input:checked ~ .r label.ctx { background: #d0e8ff; color: #666; border-radius: .75em .75em 0 0; padding: 0 .5em; margin: -.25em 0; }

@media (prefers-color-scheme: dark) { #source p input:checked ~ .r label.ctx { background: #056; } }

@media (prefers-color-scheme: dark) { #source p input:checked ~ .r label.ctx { color: #aaa; } }

#source p input:checked ~ .r label.ctx::before { content: " "; }

#source p input:checked ~ .ctxs { padding: .25em .5em; overflow-y: scroll; max-height: 10.5em; }

#source p label.ctx { color: #999; display: inline-block; padding: 0 .5em; font-size: .8333em; }

@media (prefers-color-scheme: dark) { #source p label.ctx { color: #777; } }

#source p .ctxs { display: block; max-height: 0; overflow-y: hidden; transition: all .2s; padding: 0 .5em; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; white-space: nowrap; background: #d0e8ff; border-radius: .25em; margin-right: 1.75em; text-align: right; }

@media (prefers-color-scheme: dark) { #source p .ctxs { background: #056; } }

#index { font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.875em; }

#index table.index { margin-left: -.5em; }

#index td, #index th { text-align: right; padding: .25em .5em; border-bottom: 1px solid #eee; }

@media (prefers-color-scheme: dark) { #index td, #index th { border-color: #333; } }

#index td.name, #index th.name { text-align: left; width: auto; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; min-width: 15em; }

#index th { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; font-style: italic; color: #333; cursor: pointer; }

@media (prefers-color-scheme: dark) { #index th { color: #ddd; } }

#index th:hover { background: #eee; }

@media (prefers-color-scheme: dark) { #index th:hover { background: #333; } }

#index th .arrows { color: #666; font-size: 85%; font-family: sans-serif; font-style: normal; pointer-events: none; }

#index th[aria-sort="ascending"], #index th[aria-sort="descending"] { white-space: nowrap; background: #eee; padding-left: .5em; }

@media (prefers-color-scheme: dark) { #index th[aria-sort="ascending"], #index th[aria-sort="descending"] { background: #333; } }

#index th[aria-sort="ascending"] .arrows::after { content: " "; }

#index th[aria-sort="descending"] .arrows::after { content: " "; }

#index td.name { font-size: 1.15em; }

#index td.name a { text-decoration: none; color: inherit; }

#index td.name .no-noun { font-style: italic; }

#index tr.total td, #index tr.total_dynamic td { font-weight: bold; border-top: 1px solid #ccc; border-bottom: none; }

#index tr.region:hover { background: #eee; }

@media (prefers-color-scheme: dark) { #index tr.region:hover { background: #333; } }

#index tr.region:hover td.name { text-decoration: underline; color: inherit; }

#scroll_marker { position: fixed; z-index: 3; right: 0; top: 0; width: 16px; height: 100%; background: #fff; border-left: 1px solid #eee; will-change: transform; }

@media (prefers-color-scheme: dark) { #scroll_marker { background: #1e1e1e; } }

@media (prefers-color-scheme: dark) { #scroll_marker { border-color: #333; } }

#scroll_marker .marker { background: #ccc; position: absolute; min-height: 3px; width: 100%; }

@media (prefers-color-scheme: dark) { #scroll_marker .marker { background: #444; } }


--- htmlcov/z_89a6376cf0395b87___init___py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/__init__.py: 100%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/__init__.py</b>:
            <span class="pc_cov">100%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">5 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">5<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">0<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">2<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="index.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87___main___py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 22:59 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Proxtract package exposing the interactive extractor CLI."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">importlib</span> <span class="key">import</span> <span class="nam">metadata</span> <span class="key">as</span> <span class="nam">_metadata</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">core</span> <span class="key">import</span> <span class="nam">ExtractionError</span><span class="op">,</span> <span class="nam">ExtractionStats</span><span class="op">,</span> <span class="nam">FileExtractor</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t">    <span class="nam">__version__</span> <span class="op">=</span> <span class="nam">_metadata</span><span class="op">.</span><span class="nam">version</span><span class="op">(</span><span class="str">"proxtract"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t"><span class="key">except</span> <span class="nam">_metadata</span><span class="op">.</span><span class="nam">PackageNotFoundError</span><span class="op">:</span>  <span class="com"># pragma: no cover - local editable install</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t">    <span class="nam">__version__</span> <span class="op">=</span> <span class="str">"0.1.0"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t"><span class="nam">__all__</span> <span class="op">=</span> <span class="op">[</span><span class="str">"FileExtractor"</span><span class="op">,</span> <span class="str">"ExtractionError"</span><span class="op">,</span> <span class="str">"ExtractionStats"</span><span class="op">,</span> <span class="str">"__version__"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87___main___py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 22:59 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87___main___py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/__main__.py: 0%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/__main__.py</b>:
            <span class="pc_cov">0%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">1 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">0<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">1<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">2<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87___init___py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87_config_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 22:59 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Module entrypoint for ``python -m proxtract``."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">main</span> <span class="key">import</span> <span class="nam">main</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">"__main__"</span><span class="op">:</span>  <span class="com"># pragma: no cover</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t">    <span class="nam">main</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87___init___py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87_config_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 22:59 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87_config_py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/config.py: 98%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/config.py</b>:
            <span class="pc_cov">98%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">97 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">95<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">2<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">7<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87___main___py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87_core_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:06 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Configuration persistence helpers for Proxtract."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">annotations</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">from</span> <span class="nam">pathlib</span> <span class="key">import</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">from</span> <span class="nam">typing</span> <span class="key">import</span> <span class="nam">Any</span><span class="op">,</span> <span class="nam">Dict</span><span class="op">,</span> <span class="nam">Iterable</span><span class="op">,</span> <span class="nam">Optional</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">state</span> <span class="key">import</span> <span class="nam">AppState</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">utils</span> <span class="key">import</span> <span class="nam">normalize_bool</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># Python 3.11+</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t">    <span class="key">import</span> <span class="nam">tomllib</span> <span class="key">as</span> <span class="nam">_tomllib</span>  <span class="com"># type: ignore[assignment]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - fallback to tomli if available</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t">    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t">        <span class="key">import</span> <span class="nam">tomli</span> <span class="key">as</span> <span class="nam">_tomllib</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t">    <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - optional dependency missing</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">        <span class="nam">_tomllib</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># TOML writing library</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t">    <span class="key">import</span> <span class="nam">tomli_w</span> <span class="key">as</span> <span class="nam">_tomli_w</span>  <span class="com"># type: ignore[assignment]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - optional dependency missing</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t">    <span class="nam">_tomli_w</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t"><span class="key">def</span> <span class="nam">_config_path</span><span class="op">(</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Path</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t">    <span class="key">return</span> <span class="nam">Path</span><span class="op">(</span><span class="str">"~/.config/proxtract/settings.toml"</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t"><span class="key">def</span> <span class="nam">load_config</span><span class="op">(</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Dict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">Any</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t">    <span class="nam">path</span> <span class="op">=</span> <span class="nam">_config_path</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="op">)</span> <span class="key">or</span> <span class="nam">_tomllib</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t">        <span class="key">return</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t">    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">        <span class="key">return</span> <span class="nam">_tomllib</span><span class="op">.</span><span class="nam">loads</span><span class="op">(</span><span class="nam">path</span><span class="op">.</span><span class="nam">read_text</span><span class="op">(</span><span class="nam">encoding</span><span class="op">=</span><span class="str">"utf-8"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t">    <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t">        <span class="key">return</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t"><span class="key">def</span> <span class="nam">apply_config</span><span class="op">(</span><span class="nam">state</span><span class="op">:</span> <span class="nam">AppState</span><span class="op">,</span> <span class="nam">data</span><span class="op">:</span> <span class="nam">Dict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">Any</span><span class="op">]</span><span class="op">)</span> <span class="op">-></span> <span class="nam">AppState</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">data</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t">        <span class="key">return</span> <span class="nam">state</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t">    <span class="com"># Helper function to safely convert to int</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t">    <span class="key">def</span> <span class="nam">safe_int</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="nam">default</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t">            <span class="key">return</span> <span class="nam">int</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t">        <span class="key">except</span> <span class="op">(</span><span class="nam">ValueError</span><span class="op">,</span> <span class="nam">TypeError</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t">            <span class="key">return</span> <span class="nam">default</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t">    <span class="nam">source_root</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"source_root"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">source_root</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">source_root</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">source_root</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t">    <span class="nam">output_path</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"output_path"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">output_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">output_path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">output_path</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span> <span class="op">=</span> <span class="nam">safe_int</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"max_size_kb"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="op">=</span> <span class="nam">normalize_bool</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"compact_mode"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="op">=</span> <span class="nam">normalize_bool</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"skip_empty"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span> <span class="op">=</span> <span class="nam">normalize_bool</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"use_gitignore"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span> <span class="op">=</span> <span class="nam">normalize_bool</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"force_include"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">    <span class="nam">include</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"include_patterns"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t">    <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">include</span><span class="op">,</span> <span class="nam">list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">include_patterns</span> <span class="op">=</span> <span class="op">[</span><span class="nam">str</span><span class="op">(</span><span class="nam">item</span><span class="op">)</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">include</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">    <span class="nam">exclude</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"exclude_patterns"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t">    <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">exclude</span><span class="op">,</span> <span class="nam">list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">exclude_patterns</span> <span class="op">=</span> <span class="op">[</span><span class="nam">str</span><span class="op">(</span><span class="nam">item</span><span class="op">)</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">exclude</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t">    <span class="com"># Filter configuration - allow overriding hardcoded filters</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t71" href="#t71">71</a></span><span class="t">    <span class="nam">skip_extensions</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"skip_extensions"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">skip_extensions</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t72" href="#t72">72</a></span><span class="t">    <span class="key">if</span> <span class="nam">skip_extensions</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t73" href="#t73">73</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_extensions</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t74" href="#t74">74</a></span><span class="t">    <span class="key">elif</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">skip_extensions</span><span class="op">,</span> <span class="nam">list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t75" href="#t75">75</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_extensions</span> <span class="op">=</span> <span class="op">{</span><span class="nam">str</span><span class="op">(</span><span class="nam">item</span><span class="op">)</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">skip_extensions</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t76" href="#t76">76</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t77" href="#t77">77</a></span><span class="t">    <span class="nam">skip_patterns</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"skip_patterns"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">skip_patterns</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t78" href="#t78">78</a></span><span class="t">    <span class="key">if</span> <span class="nam">skip_patterns</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t79" href="#t79">79</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_patterns</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t80" href="#t80">80</a></span><span class="t">    <span class="key">elif</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">skip_patterns</span><span class="op">,</span> <span class="nam">list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t81" href="#t81">81</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_patterns</span> <span class="op">=</span> <span class="op">{</span><span class="nam">str</span><span class="op">(</span><span class="nam">item</span><span class="op">)</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">skip_patterns</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t82" href="#t82">82</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t83" href="#t83">83</a></span><span class="t">    <span class="nam">skip_files</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"skip_files"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">skip_files</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t84" href="#t84">84</a></span><span class="t">    <span class="key">if</span> <span class="nam">skip_files</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t85" href="#t85">85</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_files</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t86" href="#t86">86</a></span><span class="t">    <span class="key">elif</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">skip_files</span><span class="op">,</span> <span class="nam">list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t87" href="#t87">87</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_files</span> <span class="op">=</span> <span class="op">{</span><span class="nam">str</span><span class="op">(</span><span class="nam">item</span><span class="op">)</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">skip_files</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t88" href="#t88">88</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t89" href="#t89">89</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span> <span class="op">=</span> <span class="nam">str</span><span class="op">(</span><span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"tokenizer_model"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t90" href="#t90">90</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span> <span class="op">=</span> <span class="nam">normalize_bool</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t91" href="#t91">91</a></span><span class="t">        <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"enable_token_count"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t92" href="#t92">92</a></span><span class="t">    <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t93" href="#t93">93</a></span><span class="t">    <span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span> <span class="op">=</span> <span class="nam">normalize_bool</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t94" href="#t94">94</a></span><span class="t">        <span class="nam">data</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"copy_to_clipboard"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span><span class="op">)</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t95" href="#t95">95</a></span><span class="t">    <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t96" href="#t96">96</a></span><span class="t">    <span class="key">return</span> <span class="nam">state</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t97" href="#t97">97</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t98" href="#t98">98</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t99" href="#t99">99</a></span><span class="t"><span class="key">def</span> <span class="nam">save_config</span><span class="op">(</span><span class="nam">state</span><span class="op">:</span> <span class="nam">AppState</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t100" href="#t100">100</a></span><span class="t">    <span class="nam">path</span> <span class="op">=</span> <span class="nam">_config_path</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t101" href="#t101">101</a></span><span class="t">    <span class="nam">path</span><span class="op">.</span><span class="nam">parent</span><span class="op">.</span><span class="nam">mkdir</span><span class="op">(</span><span class="nam">parents</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">exist_ok</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t102" href="#t102">102</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t103" href="#t103">103</a></span><span class="t">    <span class="nam">source_root</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">state</span><span class="op">,</span> <span class="str">"source_root"</span><span class="op">,</span> <span class="nam">Path</span><span class="op">.</span><span class="nam">cwd</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t104" href="#t104">104</a></span><span class="t">    <span class="nam">output_path</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">state</span><span class="op">,</span> <span class="str">"output_path"</span><span class="op">,</span> <span class="nam">Path</span><span class="op">(</span><span class="str">"extracted.txt"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t105" href="#t105">105</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t106" href="#t106">106</a></span><span class="t">    <span class="nam">data</span><span class="op">:</span> <span class="nam">Dict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">Any</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t107" href="#t107">107</a></span><span class="t">        <span class="str">"source_root"</span><span class="op">:</span> <span class="nam">str</span><span class="op">(</span><span class="nam">Path</span><span class="op">(</span><span class="nam">source_root</span><span class="op">)</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t108" href="#t108">108</a></span><span class="t">        <span class="str">"output_path"</span><span class="op">:</span> <span class="nam">str</span><span class="op">(</span><span class="nam">Path</span><span class="op">(</span><span class="nam">output_path</span><span class="op">)</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t109" href="#t109">109</a></span><span class="t">        <span class="str">"max_size_kb"</span><span class="op">:</span> <span class="nam">int</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t110" href="#t110">110</a></span><span class="t">        <span class="str">"compact_mode"</span><span class="op">:</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t111" href="#t111">111</a></span><span class="t">        <span class="str">"skip_empty"</span><span class="op">:</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t112" href="#t112">112</a></span><span class="t">        <span class="str">"use_gitignore"</span><span class="op">:</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t113" href="#t113">113</a></span><span class="t">        <span class="str">"force_include"</span><span class="op">:</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t114" href="#t114">114</a></span><span class="t">        <span class="str">"include_patterns"</span><span class="op">:</span> <span class="nam">list</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t115" href="#t115">115</a></span><span class="t">        <span class="str">"exclude_patterns"</span><span class="op">:</span> <span class="nam">list</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">exclude_patterns</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t116" href="#t116">116</a></span><span class="t">        <span class="str">"tokenizer_model"</span><span class="op">:</span> <span class="nam">str</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t117" href="#t117">117</a></span><span class="t">        <span class="str">"enable_token_count"</span><span class="op">:</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t118" href="#t118">118</a></span><span class="t">        <span class="str">"copy_to_clipboard"</span><span class="op">:</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t119" href="#t119">119</a></span><span class="t">    <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t120" href="#t120">120</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t121" href="#t121">121</a></span><span class="t">    <span class="key">def</span> <span class="nam">_serialize_optional_iterable</span><span class="op">(</span><span class="nam">key</span><span class="op">:</span> <span class="nam">str</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t122" href="#t122">122</a></span><span class="t">        <span class="key">if</span> <span class="nam">value</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t123" href="#t123">123</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t124" href="#t124">124</a></span><span class="t">        <span class="nam">data</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span> <span class="op">=</span> <span class="nam">list</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t125" href="#t125">125</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t126" href="#t126">126</a></span><span class="t">    <span class="nam">_serialize_optional_iterable</span><span class="op">(</span><span class="str">"skip_extensions"</span><span class="op">,</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">state</span><span class="op">,</span> <span class="str">"skip_extensions"</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t127" href="#t127">127</a></span><span class="t">    <span class="nam">_serialize_optional_iterable</span><span class="op">(</span><span class="str">"skip_patterns"</span><span class="op">,</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">state</span><span class="op">,</span> <span class="str">"skip_patterns"</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t128" href="#t128">128</a></span><span class="t">    <span class="nam">_serialize_optional_iterable</span><span class="op">(</span><span class="str">"skip_files"</span><span class="op">,</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">state</span><span class="op">,</span> <span class="str">"skip_files"</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t129" href="#t129">129</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t130" href="#t130">130</a></span><span class="t">    <span class="com"># Use proper TOML library if available, otherwise fall back to manual construction</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t131" href="#t131">131</a></span><span class="t">    <span class="key">if</span> <span class="nam">_tomli_w</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t132" href="#t132">132</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t133" href="#t133">133</a></span><span class="t">            <span class="key">with</span> <span class="nam">path</span><span class="op">.</span><span class="nam">open</span><span class="op">(</span><span class="str">"wb"</span><span class="op">)</span> <span class="key">as</span> <span class="nam">handle</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t134" href="#t134">134</a></span><span class="t">                <span class="nam">_tomli_w</span><span class="op">.</span><span class="nam">dump</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">handle</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t135" href="#t135">135</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t136" href="#t136">136</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t137" href="#t137">137</a></span><span class="t">            <span class="com"># Fall back to manual construction if TOML serialization fails</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t138" href="#t138">138</a></span><span class="t">            <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t139" href="#t139">139</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t140" href="#t140">140</a></span><span class="t">    <span class="com"># Fallback to manual construction if TOML library is not available or fails</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t141" href="#t141">141</a></span><span class="t">    <span class="key">def</span> <span class="nam">_escape</span><span class="op">(</span><span class="nam">item</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t142" href="#t142">142</a></span><span class="t">        <span class="key">return</span> <span class="nam">item</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">"\\"</span><span class="op">,</span> <span class="str">"\\\\"</span><span class="op">)</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">'"'</span><span class="op">,</span> <span class="str">'\\"'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t143" href="#t143">143</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t144" href="#t144">144</a></span><span class="t">    <span class="nam">lines</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t145" href="#t145">145</a></span><span class="t">    <span class="key">for</span> <span class="nam">key</span><span class="op">,</span> <span class="nam">value</span> <span class="key">in</span> <span class="nam">data</span><span class="op">.</span><span class="nam">items</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t146" href="#t146">146</a></span><span class="t">        <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="nam">bool</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t147" href="#t147">147</a></span><span class="t">            <span class="nam">rendered</span> <span class="op">=</span> <span class="str">"true"</span> <span class="key">if</span> <span class="nam">value</span> <span class="key">else</span> <span class="str">"false"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t148" href="#t148">148</a></span><span class="t">        <span class="key">elif</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="nam">int</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t149" href="#t149">149</a></span><span class="t">            <span class="nam">rendered</span> <span class="op">=</span> <span class="nam">str</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t150" href="#t150">150</a></span><span class="t">        <span class="key">elif</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="op">(</span><span class="nam">list</span><span class="op">,</span> <span class="nam">set</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t151" href="#t151">151</a></span><span class="t">            <span class="nam">rendered</span> <span class="op">=</span> <span class="str">"["</span> <span class="op">+</span> <span class="str">", "</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="fst">f'</span><span class="fst">"</span><span class="op">{</span><span class="nam">_escape</span><span class="op">(</span><span class="nam">entry</span><span class="op">)</span><span class="op">}</span><span class="fst">"</span><span class="fst">'</span> <span class="key">for</span> <span class="nam">entry</span> <span class="key">in</span> <span class="nam">value</span><span class="op">)</span> <span class="op">+</span> <span class="str">"]"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t152" href="#t152">152</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t153" href="#t153">153</a></span><span class="t">            <span class="nam">rendered</span> <span class="op">=</span> <span class="fst">f'</span><span class="fst">"</span><span class="op">{</span><span class="nam">_escape</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="fst">"</span><span class="fst">'</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t154" href="#t154">154</a></span><span class="t">        <span class="nam">lines</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="fst">f"</span><span class="op">{</span><span class="nam">key</span><span class="op">}</span><span class="fst"> = </span><span class="op">{</span><span class="nam">rendered</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t155" href="#t155">155</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t156" href="#t156">156</a></span><span class="t">    <span class="key">with</span> <span class="nam">path</span><span class="op">.</span><span class="nam">open</span><span class="op">(</span><span class="str">"w"</span><span class="op">,</span> <span class="nam">encoding</span><span class="op">=</span><span class="str">"utf-8"</span><span class="op">)</span> <span class="key">as</span> <span class="nam">handle</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t157" href="#t157">157</a></span><span class="t">        <span class="nam">handle</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">"\n"</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">lines</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t158" href="#t158">158</a></span><span class="t">        <span class="nam">handle</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">"\n"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t159" href="#t159">159</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t160" href="#t160">160</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t161" href="#t161">161</a></span><span class="t"><span class="nam">__all__</span> <span class="op">=</span> <span class="op">[</span><span class="str">"load_config"</span><span class="op">,</span> <span class="str">"apply_config"</span><span class="op">,</span> <span class="str">"save_config"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87___main___py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87_core_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:06 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87_core_py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/core.py: 83%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/core.py</b>:
            <span class="pc_cov">83%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">293 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">243<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">50<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">16<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87_config_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87_interactive_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:06 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Core extraction logic for the Proxtract CLI."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">annotations</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">from</span> <span class="nam">collections</span> <span class="key">import</span> <span class="nam">defaultdict</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">from</span> <span class="nam">dataclasses</span> <span class="key">import</span> <span class="nam">dataclass</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="key">from</span> <span class="nam">pathlib</span> <span class="key">import</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t"><span class="key">from</span> <span class="nam">typing</span> <span class="key">import</span> <span class="nam">Callable</span><span class="op">,</span> <span class="nam">DefaultDict</span><span class="op">,</span> <span class="nam">Dict</span><span class="op">,</span> <span class="nam">Iterable</span><span class="op">,</span> <span class="nam">Optional</span><span class="op">,</span> <span class="nam">Protocol</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t"><span class="key">import</span> <span class="nam">fnmatch</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t"><span class="key">import</span> <span class="nam">os</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t"><span class="key">import</span> <span class="nam">tempfile</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># Optional dependency for .gitignore support</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t">    <span class="key">import</span> <span class="nam">pathspec</span> <span class="key">as</span> <span class="nam">_pathspec</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - dependency optional</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t">    <span class="nam">_pathspec</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># Optional dependency for token counting</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t">    <span class="key">import</span> <span class="nam">tiktoken</span> <span class="key">as</span> <span class="nam">_tiktoken</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - dependency optional</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t">    <span class="nam">_tiktoken</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t"><span class="key">class</span> <span class="nam">ProgressCallback</span><span class="op">(</span><span class="nam">Protocol</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t">    <span class="str">"""Callable invoked to report extraction progress."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t">    <span class="key">def</span> <span class="nam">__call__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="op">,</span> <span class="nam">advance</span><span class="op">:</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">description</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>  <span class="com"># pragma: no cover - Protocol definition</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t">        <span class="op">...</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t"><span class="op">@</span><span class="nam">dataclass</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t"><span class="key">class</span> <span class="nam">ExtractionStats</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t">    <span class="str">"""Structured information returned after a successful extraction."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t">    <span class="nam">root</span><span class="op">:</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t">    <span class="nam">output</span><span class="op">:</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t">    <span class="nam">processed_paths</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t">    <span class="nam">total_bytes</span><span class="op">:</span> <span class="nam">int</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t">    <span class="nam">skipped_paths</span><span class="op">:</span> <span class="nam">Dict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t">    <span class="nam">errors</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t">    <span class="nam">token_count</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">int</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t">    <span class="nam">token_model</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t">    <span class="key">def</span> <span class="nam">processed_files</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">int</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t">        <span class="str">"""Backward compatible count of processed files."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t">        <span class="key">return</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">processed_paths</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t">    <span class="key">def</span> <span class="nam">skipped</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Dict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">int</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t">        <span class="str">"""Backward compatible summary of skipped files by reason."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t">        <span class="nam">counts</span><span class="op">:</span> <span class="nam">DefaultDict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">int</span><span class="op">]</span> <span class="op">=</span> <span class="nam">defaultdict</span><span class="op">(</span><span class="nam">int</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">        <span class="nam">canonical_reasons</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t">            <span class="str">"excluded_ext"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">            <span class="str">"empty"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t">            <span class="str">"too_large"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t">            <span class="str">"binary"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">            <span class="str">"excluded_name"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t">            <span class="str">"excluded_path"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">            <span class="str">"excluded_pattern"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t">            <span class="str">"gitignore"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">            <span class="str">"not_included"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t">            <span class="str">"other"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t">        <span class="key">for</span> <span class="nam">reason</span><span class="op">,</span> <span class="nam">paths</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skipped_paths</span><span class="op">.</span><span class="nam">items</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t">            <span class="nam">key</span> <span class="op">=</span> <span class="nam">reason</span> <span class="key">if</span> <span class="nam">reason</span> <span class="key">in</span> <span class="nam">canonical_reasons</span> <span class="key">else</span> <span class="str">"other"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t">            <span class="nam">count</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">paths</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t">            <span class="key">if</span> <span class="nam">count</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t71" href="#t71">71</a></span><span class="t">                <span class="nam">counts</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span> <span class="op">=</span> <span class="nam">counts</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">key</span><span class="op">,</span> <span class="num">0</span><span class="op">)</span> <span class="op">+</span> <span class="nam">count</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t72" href="#t72">72</a></span><span class="t">        <span class="key">return</span> <span class="nam">counts</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t73" href="#t73">73</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t74" href="#t74">74</a></span><span class="t">    <span class="key">def</span> <span class="nam">as_dict</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Dict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">object</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t75" href="#t75">75</a></span><span class="t">        <span class="str">"""Return stats in plain dict form for serialization/logging."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t76" href="#t76">76</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t77" href="#t77">77</a></span><span class="t">        <span class="nam">result</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t78" href="#t78">78</a></span><span class="t">            <span class="str">"root"</span><span class="op">:</span> <span class="nam">str</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">root</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t79" href="#t79">79</a></span><span class="t">            <span class="str">"output"</span><span class="op">:</span> <span class="nam">str</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">output</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t80" href="#t80">80</a></span><span class="t">            <span class="str">"processed_paths"</span><span class="op">:</span> <span class="nam">list</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">processed_paths</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t81" href="#t81">81</a></span><span class="t">            <span class="str">"processed_files"</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">processed_files</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t82" href="#t82">82</a></span><span class="t">            <span class="str">"total_bytes"</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">total_bytes</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t83" href="#t83">83</a></span><span class="t">            <span class="str">"skipped_paths"</span><span class="op">:</span> <span class="op">{</span><span class="nam">reason</span><span class="op">:</span> <span class="nam">list</span><span class="op">(</span><span class="nam">paths</span><span class="op">)</span> <span class="key">for</span> <span class="nam">reason</span><span class="op">,</span> <span class="nam">paths</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skipped_paths</span><span class="op">.</span><span class="nam">items</span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t84" href="#t84">84</a></span><span class="t">            <span class="str">"skipped"</span><span class="op">:</span> <span class="nam">dict</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">skipped</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t85" href="#t85">85</a></span><span class="t">            <span class="str">"errors"</span><span class="op">:</span> <span class="nam">list</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">errors</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t86" href="#t86">86</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t87" href="#t87">87</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">token_count</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t88" href="#t88">88</a></span><span class="t">            <span class="nam">result</span><span class="op">[</span><span class="str">"token_count"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">token_count</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t89" href="#t89">89</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">token_model</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t90" href="#t90">90</a></span><span class="t">            <span class="nam">result</span><span class="op">[</span><span class="str">"token_model"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">token_model</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t91" href="#t91">91</a></span><span class="t">        <span class="key">return</span> <span class="nam">result</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t92" href="#t92">92</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t93" href="#t93">93</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t94" href="#t94">94</a></span><span class="t"><span class="key">class</span> <span class="nam">ExtractionError</span><span class="op">(</span><span class="nam">RuntimeError</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t95" href="#t95">95</a></span><span class="t">    <span class="str">"""Raised when extraction cannot be performed."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t96" href="#t96">96</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t97" href="#t97">97</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t98" href="#t98">98</a></span><span class="t"><span class="key">class</span> <span class="nam">FileExtractor</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t99" href="#t99">99</a></span><span class="t">    <span class="str">"""Extract text-friendly files from a project tree into a single document."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t100" href="#t100">100</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t101" href="#t101">101</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t102" href="#t102">102</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t103" href="#t103">103</a></span><span class="t">        <span class="op">*</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t104" href="#t104">104</a></span><span class="t">        <span class="nam">max_file_size_kb</span><span class="op">:</span> <span class="nam">int</span> <span class="op">=</span> <span class="num">500</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t105" href="#t105">105</a></span><span class="t">        <span class="nam">skip_empty</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t106" href="#t106">106</a></span><span class="t">        <span class="nam">compact_mode</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t107" href="#t107">107</a></span><span class="t">        <span class="nam">use_gitignore</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t108" href="#t108">108</a></span><span class="t">        <span class="nam">include_patterns</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t109" href="#t109">109</a></span><span class="t">        <span class="nam">exclude_patterns</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t110" href="#t110">110</a></span><span class="t">        <span class="nam">force_include</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t111" href="#t111">111</a></span><span class="t">        <span class="nam">tokenizer_model</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t112" href="#t112">112</a></span><span class="t">        <span class="nam">count_tokens</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t113" href="#t113">113</a></span><span class="t">        <span class="com"># Configurable filtering rules</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t114" href="#t114">114</a></span><span class="t">        <span class="nam">skip_extensions</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t115" href="#t115">115</a></span><span class="t">        <span class="nam">skip_patterns</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t116" href="#t116">116</a></span><span class="t">        <span class="nam">skip_files</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t117" href="#t117">117</a></span><span class="t">    <span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t118" href="#t118">118</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">max_file_size</span> <span class="op">=</span> <span class="nam">max_file_size_kb</span> <span class="op">*</span> <span class="num">1024</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t119" href="#t119">119</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="op">=</span> <span class="nam">skip_empty</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t120" href="#t120">120</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="op">=</span> <span class="nam">compact_mode</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t121" href="#t121">121</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">use_gitignore</span> <span class="op">=</span> <span class="nam">use_gitignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t122" href="#t122">122</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span> <span class="op">=</span> <span class="nam">tuple</span><span class="op">(</span><span class="nam">include_patterns</span> <span class="key">or</span> <span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t123" href="#t123">123</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">exclude_patterns</span> <span class="op">=</span> <span class="nam">tuple</span><span class="op">(</span><span class="nam">exclude_patterns</span> <span class="key">or</span> <span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t124" href="#t124">124</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">force_include</span> <span class="op">=</span> <span class="nam">force_include</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t125" href="#t125">125</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">tokenizer_model</span> <span class="op">=</span> <span class="nam">tokenizer_model</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t126" href="#t126">126</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">count_tokens</span> <span class="op">=</span> <span class="nam">count_tokens</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t127" href="#t127">127</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t128" href="#t128">128</a></span><span class="t">        <span class="com"># Default filtering rules</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t129" href="#t129">129</a></span><span class="t">        <span class="nam">default_extensions</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t130" href="#t130">130</a></span><span class="t">            <span class="str">".csv"</span><span class="op">,</span> <span class="str">".jpeg"</span><span class="op">,</span> <span class="str">".jpg"</span><span class="op">,</span> <span class="str">".png"</span><span class="op">,</span> <span class="str">".gif"</span><span class="op">,</span> <span class="str">".bmp"</span><span class="op">,</span> <span class="str">".gitignore"</span><span class="op">,</span> <span class="str">".env"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t131" href="#t131">131</a></span><span class="t">            <span class="str">".mp4"</span><span class="op">,</span> <span class="str">".lgb"</span><span class="op">,</span> <span class="str">".sqlite3-wal"</span><span class="op">,</span> <span class="str">".sqlite3-shm"</span><span class="op">,</span> <span class="str">".sqlite3"</span><span class="op">,</span> <span class="str">".mkv"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t132" href="#t132">132</a></span><span class="t">            <span class="str">".webm"</span><span class="op">,</span> <span class="str">".mp3"</span><span class="op">,</span> <span class="str">".wav"</span><span class="op">,</span> <span class="str">".flac"</span><span class="op">,</span> <span class="str">".aac"</span><span class="op">,</span> <span class="str">".html"</span><span class="op">,</span> <span class="str">".wma"</span><span class="op">,</span> <span class="str">".ico"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t133" href="#t133">133</a></span><span class="t">            <span class="str">".svg"</span><span class="op">,</span> <span class="str">".zip"</span><span class="op">,</span> <span class="str">".rar"</span><span class="op">,</span> <span class="str">".7z"</span><span class="op">,</span> <span class="str">".tar"</span><span class="op">,</span> <span class="str">".gz"</span><span class="op">,</span> <span class="str">".bz2"</span><span class="op">,</span> <span class="str">".lock"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t134" href="#t134">134</a></span><span class="t">            <span class="str">".exe"</span><span class="op">,</span> <span class="str">".dll"</span><span class="op">,</span> <span class="str">".so"</span><span class="op">,</span> <span class="str">".dylib"</span><span class="op">,</span> <span class="str">".pdf"</span><span class="op">,</span> <span class="str">".doc"</span><span class="op">,</span> <span class="str">".docx"</span><span class="op">,</span> <span class="str">".xls"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t135" href="#t135">135</a></span><span class="t">            <span class="str">".xlsx"</span><span class="op">,</span> <span class="str">".ppt"</span><span class="op">,</span> <span class="str">".pptx"</span><span class="op">,</span> <span class="str">".pyc"</span><span class="op">,</span> <span class="str">".pyo"</span><span class="op">,</span> <span class="str">".pyd"</span><span class="op">,</span> <span class="str">".pkl"</span><span class="op">,</span> <span class="str">".parquet"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t136" href="#t136">136</a></span><span class="t">            <span class="str">".orc"</span><span class="op">,</span> <span class="str">".avro"</span><span class="op">,</span> <span class="str">".feather"</span><span class="op">,</span> <span class="str">".h5"</span><span class="op">,</span> <span class="str">".hdf5"</span><span class="op">,</span> <span class="str">".db"</span><span class="op">,</span> <span class="str">".sqlite"</span><span class="op">,</span> <span class="str">".bin"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t137" href="#t137">137</a></span><span class="t">            <span class="str">".dat"</span><span class="op">,</span> <span class="str">".idx"</span><span class="op">,</span> <span class="str">".model"</span><span class="op">,</span> <span class="str">".pt"</span><span class="op">,</span> <span class="str">".ckpt"</span><span class="op">,</span> <span class="str">".npy"</span><span class="op">,</span> <span class="str">".npz"</span><span class="op">,</span> <span class="str">".woff"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t138" href="#t138">138</a></span><span class="t">            <span class="str">".woff2"</span><span class="op">,</span> <span class="str">".ttf"</span><span class="op">,</span> <span class="str">".eot"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t139" href="#t139">139</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t140" href="#t140">140</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t141" href="#t141">141</a></span><span class="t">        <span class="nam">default_patterns</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t142" href="#t142">142</a></span><span class="t">            <span class="str">"__pycache__"</span><span class="op">,</span> <span class="str">".git"</span><span class="op">,</span> <span class="str">".svn"</span><span class="op">,</span> <span class="str">".hg"</span><span class="op">,</span> <span class="str">"node_modules"</span><span class="op">,</span> <span class="str">".vscode"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t143" href="#t143">143</a></span><span class="t">            <span class="str">".idea"</span><span class="op">,</span> <span class="str">".pytest_cache"</span><span class="op">,</span> <span class="str">".mypy_cache"</span><span class="op">,</span> <span class="str">"venv"</span><span class="op">,</span> <span class="str">"env"</span><span class="op">,</span> <span class="str">"virtualenv"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t144" href="#t144">144</a></span><span class="t">            <span class="str">"dist"</span><span class="op">,</span> <span class="str">"build"</span><span class="op">,</span> <span class="str">".next"</span><span class="op">,</span> <span class="str">"coverage"</span><span class="op">,</span> <span class="str">".nyc_output"</span><span class="op">,</span> <span class="str">"vendor"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t145" href="#t145">145</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t146" href="#t146">146</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t147" href="#t147">147</a></span><span class="t">        <span class="nam">default_files</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t148" href="#t148">148</a></span><span class="t">            <span class="str">"package-lock.json"</span><span class="op">,</span> <span class="str">"yarn.lock"</span><span class="op">,</span> <span class="str">"poetry.lock"</span><span class="op">,</span> <span class="str">"Pipfile.lock"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t149" href="#t149">149</a></span><span class="t">            <span class="str">".DS_Store"</span><span class="op">,</span> <span class="str">"Thumbs.db"</span><span class="op">,</span> <span class="str">"desktop.ini"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t150" href="#t150">150</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t151" href="#t151">151</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t152" href="#t152">152</a></span><span class="t">        <span class="key">def</span> <span class="nam">_coerce_set</span><span class="op">(</span><span class="nam">values</span><span class="op">:</span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">)</span> <span class="op">-></span> <span class="nam">set</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t153" href="#t153">153</a></span><span class="t">            <span class="key">return</span> <span class="op">{</span><span class="nam">str</span><span class="op">(</span><span class="nam">entry</span><span class="op">)</span> <span class="key">for</span> <span class="nam">entry</span> <span class="key">in</span> <span class="nam">values</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t154" href="#t154">154</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t155" href="#t155">155</a></span><span class="t">        <span class="key">def</span> <span class="nam">_coerce_extensions</span><span class="op">(</span><span class="nam">values</span><span class="op">:</span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">)</span> <span class="op">-></span> <span class="nam">set</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t156" href="#t156">156</a></span><span class="t">            <span class="key">return</span> <span class="op">{</span><span class="nam">str</span><span class="op">(</span><span class="nam">entry</span><span class="op">)</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="key">for</span> <span class="nam">entry</span> <span class="key">in</span> <span class="nam">values</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t157" href="#t157">157</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t158" href="#t158">158</a></span><span class="t">        <span class="com"># Use provided rules or fall back to defaults</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t159" href="#t159">159</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">skip_extensions</span> <span class="op">=</span> <span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t160" href="#t160">160</a></span><span class="t">            <span class="nam">_coerce_extensions</span><span class="op">(</span><span class="nam">default_extensions</span><span class="op">)</span> <span class="key">if</span> <span class="nam">skip_extensions</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">_coerce_extensions</span><span class="op">(</span><span class="nam">skip_extensions</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t161" href="#t161">161</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t162" href="#t162">162</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">skip_patterns</span> <span class="op">=</span> <span class="nam">_coerce_set</span><span class="op">(</span><span class="nam">default_patterns</span><span class="op">)</span> <span class="key">if</span> <span class="nam">skip_patterns</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">_coerce_set</span><span class="op">(</span><span class="nam">skip_patterns</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t163" href="#t163">163</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">skip_files</span> <span class="op">=</span> <span class="nam">_coerce_set</span><span class="op">(</span><span class="nam">default_files</span><span class="op">)</span> <span class="key">if</span> <span class="nam">skip_files</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">_coerce_set</span><span class="op">(</span><span class="nam">skip_files</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t164" href="#t164">164</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t165" href="#t165">165</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_root_path</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Path</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t166" href="#t166">166</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t167" href="#t167">167</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t168" href="#t168">168</a></span><span class="t">    <span class="key">def</span> <span class="nam">_rel</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">file_path</span><span class="op">:</span> <span class="nam">Path</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t169" href="#t169">169</a></span><span class="t">        <span class="key">assert</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_root_path</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t170" href="#t170">170</a></span><span class="t">        <span class="key">return</span> <span class="nam">str</span><span class="op">(</span><span class="nam">file_path</span><span class="op">.</span><span class="nam">relative_to</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_root_path</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t171" href="#t171">171</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t172" href="#t172">172</a></span><span class="t">    <span class="op">@</span><span class="nam">staticmethod</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t173" href="#t173">173</a></span><span class="t">    <span class="key">def</span> <span class="nam">_match_any</span><span class="op">(</span><span class="nam">patterns</span><span class="op">:</span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">,</span> <span class="nam">rel</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t174" href="#t174">174</a></span><span class="t">        <span class="key">for</span> <span class="nam">pattern</span> <span class="key">in</span> <span class="nam">patterns</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t175" href="#t175">175</a></span><span class="t">            <span class="key">if</span> <span class="nam">fnmatch</span><span class="op">.</span><span class="nam">fnmatch</span><span class="op">(</span><span class="nam">rel</span><span class="op">,</span> <span class="nam">pattern</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t176" href="#t176">176</a></span><span class="t">                <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t177" href="#t177">177</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t178" href="#t178">178</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t179" href="#t179">179</a></span><span class="t">    <span class="key">def</span> <span class="nam">_should_skip</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">file_path</span><span class="op">:</span> <span class="nam">Path</span><span class="op">,</span> <span class="op">*</span><span class="op">,</span> <span class="nam">include_override</span><span class="op">:</span> <span class="nam">bool</span><span class="op">)</span> <span class="op">-></span> <span class="nam">tuple</span><span class="op">[</span><span class="nam">bool</span><span class="op">,</span> <span class="nam">str</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t180" href="#t180">180</a></span><span class="t">        <span class="nam">rel</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_rel</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t181" href="#t181">181</a></span><span class="t">        <span class="nam">include_forced</span> <span class="op">=</span> <span class="nam">include_override</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">force_include</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t182" href="#t182">182</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t183" href="#t183">183</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">include_forced</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_match_any</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">exclude_patterns</span><span class="op">,</span> <span class="nam">rel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t184" href="#t184">184</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"excluded_pattern"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t185" href="#t185">185</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t186" href="#t186">186</a></span><span class="t">        <span class="key">if</span> <span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t187" href="#t187">187</a></span><span class="t">            <span class="key">not</span> <span class="nam">include_forced</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t188" href="#t188">188</a></span><span class="t">            <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t189" href="#t189">189</a></span><span class="t">            <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span><span class="op">.</span><span class="nam">match_file</span><span class="op">(</span><span class="nam">rel</span><span class="op">)</span>  <span class="com"># type: ignore[union-attr]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t190" href="#t190">190</a></span><span class="t">        <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t191" href="#t191">191</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"gitignore"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t192" href="#t192">192</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t193" href="#t193">193</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">include_override</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t194" href="#t194">194</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"not_included"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t195" href="#t195">195</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t196" href="#t196">196</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">include_override</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t197" href="#t197">197</a></span><span class="t">            <span class="key">if</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">name</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_files</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t198" href="#t198">198</a></span><span class="t">                <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"excluded_name"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t199" href="#t199">199</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t200" href="#t200">200</a></span><span class="t">            <span class="key">if</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">suffix</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_extensions</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t201" href="#t201">201</a></span><span class="t">                <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"excluded_ext"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t202" href="#t202">202</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t203" href="#t203">203</a></span><span class="t">            <span class="com"># Check if filename matches any skip patterns</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t204" href="#t204">204</a></span><span class="t">            <span class="nam">rel</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_rel</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t205" href="#t205">205</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_match_any</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">skip_patterns</span><span class="op">,</span> <span class="nam">rel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t206" href="#t206">206</a></span><span class="t">                <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"excluded_path"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t207" href="#t207">207</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t208" href="#t208">208</a></span><span class="t">            <span class="key">for</span> <span class="nam">part</span> <span class="key">in</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">parts</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t209" href="#t209">209</a></span><span class="t">                <span class="key">if</span> <span class="nam">part</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_patterns</span> <span class="key">or</span> <span class="nam">part</span><span class="op">.</span><span class="nam">startswith</span><span class="op">(</span><span class="str">"."</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t210" href="#t210">210</a></span><span class="t">                    <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"excluded_path"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t211" href="#t211">211</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t212" href="#t212">212</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t213" href="#t213">213</a></span><span class="t">            <span class="nam">size</span> <span class="op">=</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">stat</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">st_size</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t214" href="#t214">214</a></span><span class="t">        <span class="key">except</span> <span class="nam">OSError</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># Permission denied, etc.</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t215" href="#t215">215</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ExtractionError</span><span class="op">(</span><span class="fst">f"</span><span class="fst">Unable to inspect file '</span><span class="op">{</span><span class="nam">file_path</span><span class="op">}</span><span class="fst">': </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span> <span class="key">from</span> <span class="nam">exc</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t216" href="#t216">216</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t217" href="#t217">217</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="key">and</span> <span class="nam">size</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t218" href="#t218">218</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"empty"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t219" href="#t219">219</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t220" href="#t220">220</a></span><span class="t">        <span class="key">if</span> <span class="nam">size</span> <span class="op">></span> <span class="nam">self</span><span class="op">.</span><span class="nam">max_file_size</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t221" href="#t221">221</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span><span class="op">,</span> <span class="str">"too_large"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t222" href="#t222">222</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t223" href="#t223">223</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span><span class="op">,</span> <span class="str">""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t224" href="#t224">224</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t225" href="#t225">225</a></span><span class="t">    <span class="op">@</span><span class="nam">staticmethod</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t226" href="#t226">226</a></span><span class="t">    <span class="key">def</span> <span class="nam">_is_text_file</span><span class="op">(</span><span class="nam">file_path</span><span class="op">:</span> <span class="nam">Path</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t227" href="#t227">227</a></span><span class="t">        <span class="str">"""Enhanced text file detection with binary detection."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t228" href="#t228">228</a></span><span class="t">        <span class="com"># Check file size first - very small files are often text</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t229" href="#t229">229</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t230" href="#t230">230</a></span><span class="t">            <span class="nam">size</span> <span class="op">=</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">stat</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">st_size</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t231" href="#t231">231</a></span><span class="t">        <span class="key">except</span> <span class="nam">OSError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t232" href="#t232">232</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t233" href="#t233">233</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t234" href="#t234">234</a></span><span class="t">        <span class="key">if</span> <span class="nam">size</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t235" href="#t235">235</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t236" href="#t236">236</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t237" href="#t237">237</a></span><span class="t">        <span class="com"># Read a reasonable chunk for analysis (limit to 8192 bytes)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t238" href="#t238">238</a></span><span class="t">        <span class="nam">max_bytes</span> <span class="op">=</span> <span class="nam">min</span><span class="op">(</span><span class="nam">size</span><span class="op">,</span> <span class="num">8192</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t239" href="#t239">239</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t240" href="#t240">240</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t241" href="#t241">241</a></span><span class="t">            <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">file_path</span><span class="op">,</span> <span class="str">"rb"</span><span class="op">)</span> <span class="key">as</span> <span class="nam">handle</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t242" href="#t242">242</a></span><span class="t">                <span class="nam">data</span> <span class="op">=</span> <span class="nam">handle</span><span class="op">.</span><span class="nam">read</span><span class="op">(</span><span class="nam">max_bytes</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t243" href="#t243">243</a></span><span class="t">        <span class="key">except</span> <span class="op">(</span><span class="nam">PermissionError</span><span class="op">,</span> <span class="nam">OSError</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t244" href="#t244">244</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t245" href="#t245">245</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t246" href="#t246">246</a></span><span class="t">        <span class="com"># Check for common binary file signatures (magic bytes)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t247" href="#t247">247</a></span><span class="t">        <span class="nam">binary_signatures</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t248" href="#t248">248</a></span><span class="t">            <span class="com"># Images</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t249" href="#t249">249</a></span><span class="t">            <span class="str">b'\x89PNG'</span><span class="op">:</span> <span class="str">'.png'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t250" href="#t250">250</a></span><span class="t">            <span class="str">b'\xff\xd8\xff'</span><span class="op">:</span> <span class="str">'.jpg'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t251" href="#t251">251</a></span><span class="t">            <span class="str">b'GIF8'</span><span class="op">:</span> <span class="str">'.gif'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t252" href="#t252">252</a></span><span class="t">            <span class="str">b'RIFF'</span><span class="op">:</span> <span class="str">'.webp'</span><span class="op">,</span>  <span class="com"># may be webp or other RIFF-based format</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t253" href="#t253">253</a></span><span class="t">            <span class="com"># Archives</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t254" href="#t254">254</a></span><span class="t">            <span class="str">b'PK\x03\x04'</span><span class="op">:</span> <span class="str">'.zip'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t255" href="#t255">255</a></span><span class="t">            <span class="str">b'PK\x05\x06'</span><span class="op">:</span> <span class="str">'.zip'</span><span class="op">,</span>  <span class="com"># empty zip</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t256" href="#t256">256</a></span><span class="t">            <span class="str">b'PK\x07\x08'</span><span class="op">:</span> <span class="str">'.zip'</span><span class="op">,</span>  <span class="com"># spanned zip</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t257" href="#t257">257</a></span><span class="t">            <span class="str">b'RARF'</span><span class="op">:</span> <span class="str">'.rar'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t258" href="#t258">258</a></span><span class="t">            <span class="str">b'7z\xbc\xaf\x27\x1c'</span><span class="op">:</span> <span class="str">'.7z'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t259" href="#t259">259</a></span><span class="t">            <span class="str">b'\x1f\x8b'</span><span class="op">:</span> <span class="str">'.gz'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t260" href="#t260">260</a></span><span class="t">            <span class="str">b'BZh'</span><span class="op">:</span> <span class="str">'.bz2'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t261" href="#t261">261</a></span><span class="t">            <span class="com"># Documents</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t262" href="#t262">262</a></span><span class="t">            <span class="str">b'%PDF'</span><span class="op">:</span> <span class="str">'.pdf'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t263" href="#t263">263</a></span><span class="t">            <span class="str">b'\xd0\xcf\x11\xe0'</span><span class="op">:</span> <span class="str">'.doc'</span><span class="op">,</span>  <span class="com"># MS Office</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t264" href="#t264">264</a></span><span class="t">            <span class="str">b'PK\x03\x04'</span><span class="op">:</span> <span class="str">'.docx'</span><span class="op">,</span>  <span class="com"># OOXML</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t265" href="#t265">265</a></span><span class="t">            <span class="com"># Audio/Video</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t266" href="#t266">266</a></span><span class="t">            <span class="str">b'fLaC'</span><span class="op">:</span> <span class="str">'.flac'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t267" href="#t267">267</a></span><span class="t">            <span class="str">b'ID3'</span><span class="op">:</span> <span class="str">'.mp3'</span><span class="op">,</span>  <span class="com"># MP3 with ID3</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t268" href="#t268">268</a></span><span class="t">            <span class="str">b'OggS'</span><span class="op">:</span> <span class="str">'.ogg'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t269" href="#t269">269</a></span><span class="t">            <span class="com"># Executables</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t270" href="#t270">270</a></span><span class="t">            <span class="str">b'MZ'</span><span class="op">:</span> <span class="str">'.exe'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t271" href="#t271">271</a></span><span class="t">            <span class="str">b'\x7fELF'</span><span class="op">:</span> <span class="str">'.elf'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t272" href="#t272">272</a></span><span class="t">            <span class="com"># Database files</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t273" href="#t273">273</a></span><span class="t">            <span class="str">b'SQLite'</span><span class="op">:</span> <span class="str">'.sqlite'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t274" href="#t274">274</a></span><span class="t">            <span class="str">b'\x00\x00\x00\x20ftyp'</span><span class="op">:</span> <span class="str">'.mp4'</span><span class="op">,</span>  <span class="com"># MP4/M4A</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t275" href="#t275">275</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t276" href="#t276">276</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t277" href="#t277">277</a></span><span class="t">        <span class="com"># Check for magic bytes</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t278" href="#t278">278</a></span><span class="t">        <span class="key">for</span> <span class="nam">signature</span> <span class="key">in</span> <span class="nam">binary_signatures</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t279" href="#t279">279</a></span><span class="t">            <span class="key">if</span> <span class="nam">data</span><span class="op">.</span><span class="nam">startswith</span><span class="op">(</span><span class="nam">signature</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t280" href="#t280">280</a></span><span class="t">                <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t281" href="#t281">281</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t282" href="#t282">282</a></span><span class="t">        <span class="com"># Check for null bytes (strong indicator of binary content)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t283" href="#t283">283</a></span><span class="t">        <span class="com"># But allow null bytes in specific file types that might contain them</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t284" href="#t284">284</a></span><span class="t">        <span class="key">if</span> <span class="str">b'\x00'</span> <span class="key">in</span> <span class="nam">data</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t285" href="#t285">285</a></span><span class="t">            <span class="com"># Additional check: if file is mostly null bytes, it's definitely binary</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t286" href="#t286">286</a></span><span class="t">            <span class="nam">null_ratio</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">count</span><span class="op">(</span><span class="str">b'\x00'</span><span class="op">)</span> <span class="op">/</span> <span class="nam">len</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t287" href="#t287">287</a></span><span class="t">            <span class="key">if</span> <span class="nam">null_ratio</span> <span class="op">></span> <span class="num">0.1</span><span class="op">:</span>  <span class="com"># More than 10% null bytes</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t288" href="#t288">288</a></span><span class="t">                <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t289" href="#t289">289</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t290" href="#t290">290</a></span><span class="t">        <span class="com"># Try to decode as text with different encodings</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t291" href="#t291">291</a></span><span class="t">        <span class="nam">encodings</span> <span class="op">=</span> <span class="op">[</span><span class="str">"utf-8"</span><span class="op">,</span> <span class="str">"utf-8-sig"</span><span class="op">,</span> <span class="str">"cp1252"</span><span class="op">,</span> <span class="str">"latin-1"</span><span class="op">,</span> <span class="str">"cp1251"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t292" href="#t292">292</a></span><span class="t">        <span class="key">for</span> <span class="nam">encoding</span> <span class="key">in</span> <span class="nam">encodings</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t293" href="#t293">293</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t294" href="#t294">294</a></span><span class="t">                <span class="nam">decoded</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">decode</span><span class="op">(</span><span class="nam">encoding</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t295" href="#t295">295</a></span><span class="t">                <span class="com"># Additional check: if decoded content contains too many control</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t296" href="#t296">296</a></span><span class="t">                <span class="com"># characters (except common ones like \n, \r, \t), it might be binary</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t297" href="#t297">297</a></span><span class="t">                <span class="nam">control_chars</span> <span class="op">=</span> <span class="nam">sum</span><span class="op">(</span><span class="num">1</span> <span class="key">for</span> <span class="nam">c</span> <span class="key">in</span> <span class="nam">decoded</span> <span class="key">if</span> <span class="op">(</span><span class="key">not</span> <span class="nam">c</span><span class="op">.</span><span class="nam">isprintable</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="key">and</span> <span class="nam">c</span> <span class="key">not</span> <span class="key">in</span> <span class="str">'\n\r\t'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t298" href="#t298">298</a></span><span class="t">                <span class="nam">control_ratio</span> <span class="op">=</span> <span class="nam">control_chars</span> <span class="op">/</span> <span class="nam">len</span><span class="op">(</span><span class="nam">decoded</span><span class="op">)</span> <span class="key">if</span> <span class="nam">decoded</span> <span class="key">else</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t299" href="#t299">299</a></span><span class="t">                <span class="key">if</span> <span class="nam">control_ratio</span> <span class="op">></span> <span class="num">0.1</span><span class="op">:</span>  <span class="com"># More than 10% control characters</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t300" href="#t300">300</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t301" href="#t301">301</a></span><span class="t">                <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t302" href="#t302">302</a></span><span class="t">            <span class="key">except</span> <span class="nam">UnicodeDecodeError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t303" href="#t303">303</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t304" href="#t304">304</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t305" href="#t305">305</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t306" href="#t306">306</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t307" href="#t307">307</a></span><span class="t">    <span class="op">@</span><span class="nam">staticmethod</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t308" href="#t308">308</a></span><span class="t">    <span class="key">def</span> <span class="nam">_read_file_content</span><span class="op">(</span><span class="nam">file_path</span><span class="op">:</span> <span class="nam">Path</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t309" href="#t309">309</a></span><span class="t">        <span class="nam">encodings</span> <span class="op">=</span> <span class="op">[</span><span class="str">"utf-8"</span><span class="op">,</span> <span class="str">"cp1251"</span><span class="op">,</span> <span class="str">"latin-1"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t310" href="#t310">310</a></span><span class="t">        <span class="key">for</span> <span class="nam">encoding</span> <span class="key">in</span> <span class="nam">encodings</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t311" href="#t311">311</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t312" href="#t312">312</a></span><span class="t">                <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">file_path</span><span class="op">,</span> <span class="str">"r"</span><span class="op">,</span> <span class="nam">encoding</span><span class="op">=</span><span class="nam">encoding</span><span class="op">)</span> <span class="key">as</span> <span class="nam">handle</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t313" href="#t313">313</a></span><span class="t">                    <span class="key">return</span> <span class="nam">handle</span><span class="op">.</span><span class="nam">read</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t314" href="#t314">314</a></span><span class="t">            <span class="key">except</span> <span class="op">(</span><span class="nam">UnicodeDecodeError</span><span class="op">,</span> <span class="nam">PermissionError</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t315" href="#t315">315</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t316" href="#t316">316</a></span><span class="t">        <span class="key">return</span> <span class="str">"[ERROR: Could not decode file]"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t317" href="#t317">317</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t318" href="#t318">318</a></span><span class="t">    <span class="key">def</span> <span class="nam">_format_compact</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">relative_path</span><span class="op">:</span> <span class="nam">Path</span><span class="op">,</span> <span class="nam">content</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t319" href="#t319">319</a></span><span class="t">        <span class="key">return</span> <span class="fst">f"</span><span class="fst">\n--- </span><span class="op">{</span><span class="nam">relative_path</span><span class="op">}</span><span class="fst"> ---\n</span><span class="op">{</span><span class="nam">content</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t320" href="#t320">320</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t321" href="#t321">321</a></span><span class="t">    <span class="key">def</span> <span class="nam">_format_standard</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">relative_path</span><span class="op">:</span> <span class="nam">Path</span><span class="op">,</span> <span class="nam">content</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t322" href="#t322">322</a></span><span class="t">        <span class="nam">separator</span> <span class="op">=</span> <span class="str">"="</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t323" href="#t323">323</a></span><span class="t">        <span class="key">return</span> <span class="fst">f"</span><span class="fst">\n</span><span class="op">{</span><span class="nam">separator</span><span class="op">}</span><span class="fst">\nFILE: </span><span class="op">{</span><span class="nam">relative_path</span><span class="op">}</span><span class="fst">\n</span><span class="op">{</span><span class="nam">separator</span><span class="op">}</span><span class="fst">\n</span><span class="op">{</span><span class="nam">content</span><span class="op">}</span><span class="fst">\n\n</span><span class="fst">"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t324" href="#t324">324</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t325" href="#t325">325</a></span><span class="t">    <span class="key">def</span> <span class="nam">extract</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t326" href="#t326">326</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t327" href="#t327">327</a></span><span class="t">        <span class="nam">root_dir</span><span class="op">:</span> <span class="nam">str</span> <span class="op">|</span> <span class="nam">Path</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t328" href="#t328">328</a></span><span class="t">        <span class="nam">output_file</span><span class="op">:</span> <span class="nam">str</span> <span class="op">|</span> <span class="nam">Path</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t329" href="#t329">329</a></span><span class="t">        <span class="op">*</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t330" href="#t330">330</a></span><span class="t">        <span class="nam">progress_callback</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">ProgressCallback</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t331" href="#t331">331</a></span><span class="t">    <span class="op">)</span> <span class="op">-></span> <span class="nam">ExtractionStats</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t332" href="#t332">332</a></span><span class="t">        <span class="str">"""Extract text files into a single document.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t333" href="#t333">333</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t334" href="#t334">334</a></span><span class="t"><span class="str">        Args:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t335" href="#t335">335</a></span><span class="t"><span class="str">            root_dir: Directory to scan.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t336" href="#t336">336</a></span><span class="t"><span class="str">            output_file: Destination file path.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t337" href="#t337">337</a></span><span class="t"><span class="str">            progress_callback: Optional callable compatible with</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t338" href="#t338">338</a></span><span class="t"><span class="str">                ``rich.progress.Progress.update``. It receives keyword arguments</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t339" href="#t339">339</a></span><span class="t"><span class="str">                ``advance`` (int) and ``description`` (str) describing the current file.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t340" href="#t340">340</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t341" href="#t341">341</a></span><span class="t"><span class="str">        Returns:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t342" href="#t342">342</a></span><span class="t"><span class="str">            ``ExtractionStats`` describing the operation.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t343" href="#t343">343</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t344" href="#t344">344</a></span><span class="t"><span class="str">        Raises:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t345" href="#t345">345</a></span><span class="t"><span class="str">            ExtractionError: If the root directory is invalid or I/O fails.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t346" href="#t346">346</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t347" href="#t347">347</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t348" href="#t348">348</a></span><span class="t">        <span class="nam">root_path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">root_dir</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">resolve</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t349" href="#t349">349</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">root_path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="op">)</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">root_path</span><span class="op">.</span><span class="nam">is_dir</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t350" href="#t350">350</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ExtractionError</span><span class="op">(</span><span class="fst">f"</span><span class="fst">'</span><span class="op">{</span><span class="nam">root_dir</span><span class="op">}</span><span class="fst">' is not a valid directory</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t351" href="#t351">351</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t352" href="#t352">352</a></span><span class="t">        <span class="nam">output_path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">output_file</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">resolve</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t353" href="#t353">353</a></span><span class="t">        <span class="nam">output_path</span><span class="op">.</span><span class="nam">parent</span><span class="op">.</span><span class="nam">mkdir</span><span class="op">(</span><span class="nam">parents</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">exist_ok</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t354" href="#t354">354</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t355" href="#t355">355</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_root_path</span> <span class="op">=</span> <span class="nam">root_path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t356" href="#t356">356</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t357" href="#t357">357</a></span><span class="t">        <span class="nam">gitignore_error</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t358" href="#t358">358</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t359" href="#t359">359</a></span><span class="t">            <span class="key">if</span> <span class="nam">_pathspec</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t360" href="#t360">360</a></span><span class="t">                <span class="nam">gitignore_error</span> <span class="op">=</span> <span class="str">"use_gitignore enabled but 'pathspec' is not installed"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t361" href="#t361">361</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t362" href="#t362">362</a></span><span class="t">                <span class="nam">gitignore_path</span> <span class="op">=</span> <span class="nam">root_path</span> <span class="op">/</span> <span class="str">".gitignore"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t363" href="#t363">363</a></span><span class="t">                <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t364" href="#t364">364</a></span><span class="t">                    <span class="nam">lines</span><span class="op">:</span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t365" href="#t365">365</a></span><span class="t">                    <span class="key">if</span> <span class="nam">gitignore_path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t366" href="#t366">366</a></span><span class="t">                        <span class="nam">lines</span> <span class="op">=</span> <span class="nam">gitignore_path</span><span class="op">.</span><span class="nam">read_text</span><span class="op">(</span><span class="nam">encoding</span><span class="op">=</span><span class="str">"utf-8"</span><span class="op">)</span><span class="op">.</span><span class="nam">splitlines</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t367" href="#t367">367</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span> <span class="op">=</span> <span class="nam">_pathspec</span><span class="op">.</span><span class="nam">PathSpec</span><span class="op">.</span><span class="nam">from_lines</span><span class="op">(</span><span class="str">"gitwildmatch"</span><span class="op">,</span> <span class="nam">lines</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t368" href="#t368">368</a></span><span class="t">                <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - defensive guard</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t369" href="#t369">369</a></span><span class="t">                    <span class="nam">gitignore_error</span> <span class="op">=</span> <span class="fst">f"</span><span class="fst">Failed to load .gitignore: </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t370" href="#t370">370</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t371" href="#t371">371</a></span><span class="t">        <span class="nam">skipped_paths</span><span class="op">:</span> <span class="nam">DefaultDict</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="nam">defaultdict</span><span class="op">(</span><span class="nam">list</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t372" href="#t372">372</a></span><span class="t">        <span class="nam">processed_paths</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t373" href="#t373">373</a></span><span class="t">        <span class="nam">total_bytes</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t374" href="#t374">374</a></span><span class="t">        <span class="nam">errors</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t375" href="#t375">375</a></span><span class="t">        <span class="key">if</span> <span class="nam">gitignore_error</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t376" href="#t376">376</a></span><span class="t">            <span class="nam">errors</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">gitignore_error</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t377" href="#t377">377</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t378" href="#t378">378</a></span><span class="t">        <span class="nam">token_count</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">int</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t379" href="#t379">379</a></span><span class="t">        <span class="nam">token_model</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t380" href="#t380">380</a></span><span class="t">        <span class="nam">encoder</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t381" href="#t381">381</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t382" href="#t382">382</a></span><span class="t">        <span class="nam">temp_path</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Path</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t383" href="#t383">383</a></span><span class="t">        <span class="nam">temp_path_resolved</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Path</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t384" href="#t384">384</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t385" href="#t385">385</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t386" href="#t386">386</a></span><span class="t">            <span class="key">with</span> <span class="nam">tempfile</span><span class="op">.</span><span class="nam">NamedTemporaryFile</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t387" href="#t387">387</a></span><span class="t">                <span class="nam">mode</span><span class="op">=</span><span class="str">"w"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t388" href="#t388">388</a></span><span class="t">                <span class="nam">encoding</span><span class="op">=</span><span class="str">"utf-8"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t389" href="#t389">389</a></span><span class="t">                <span class="nam">delete</span><span class="op">=</span><span class="key">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t390" href="#t390">390</a></span><span class="t">                <span class="nam">dir</span><span class="op">=</span><span class="nam">str</span><span class="op">(</span><span class="nam">output_path</span><span class="op">.</span><span class="nam">parent</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t391" href="#t391">391</a></span><span class="t">                <span class="nam">prefix</span><span class="op">=</span><span class="fst">f"</span><span class="op">{</span><span class="nam">output_path</span><span class="op">.</span><span class="nam">name</span><span class="op">}</span><span class="fst">.</span><span class="fst">"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t392" href="#t392">392</a></span><span class="t">                <span class="nam">suffix</span><span class="op">=</span><span class="str">".tmp"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t393" href="#t393">393</a></span><span class="t">            <span class="op">)</span> <span class="key">as</span> <span class="nam">destination</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t394" href="#t394">394</a></span><span class="t">                <span class="nam">temp_path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">destination</span><span class="op">.</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t395" href="#t395">395</a></span><span class="t">                <span class="nam">temp_path_resolved</span> <span class="op">=</span> <span class="nam">temp_path</span><span class="op">.</span><span class="nam">resolve</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t396" href="#t396">396</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Extracted from: </span><span class="op">{</span><span class="nam">root_path</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t397" href="#t397">397</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Max file size: </span><span class="op">{</span><span class="nam">self</span><span class="op">.</span><span class="nam">max_file_size</span> <span class="op">//</span> <span class="num">1024</span><span class="op">}</span><span class="fst">KB\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t398" href="#t398">398</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Mode: </span><span class="op">{</span><span class="str">'compact'</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="key">else</span> <span class="str">'standard'</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t399" href="#t399">399</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">"="</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="str">"\n"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t400" href="#t400">400</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t401" href="#t401">401</a></span><span class="t">                    <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Gitignore: </span><span class="op">{</span><span class="str">'on'</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">else</span> <span class="str">'off'</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t402" href="#t402">402</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t403" href="#t403">403</a></span><span class="t">                    <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Include patterns: </span><span class="op">{</span><span class="str">', '</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">)</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t404" href="#t404">404</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">exclude_patterns</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t405" href="#t405">405</a></span><span class="t">                    <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Exclude patterns: </span><span class="op">{</span><span class="str">', '</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">exclude_patterns</span><span class="op">)</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t406" href="#t406">406</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t407" href="#t407">407</a></span><span class="t">                <span class="nam">encoder</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t408" href="#t408">408</a></span><span class="t">                <span class="nam">token_count</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t409" href="#t409">409</a></span><span class="t">                <span class="nam">token_model</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t410" href="#t410">410</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">count_tokens</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t411" href="#t411">411</a></span><span class="t">                    <span class="key">if</span> <span class="nam">_tiktoken</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t412" href="#t412">412</a></span><span class="t">                        <span class="nam">errors</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">"Token counting enabled but 'tiktoken' is not installed"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t413" href="#t413">413</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t414" href="#t414">414</a></span><span class="t">                        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t415" href="#t415">415</a></span><span class="t">                            <span class="nam">token_model</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">tokenizer_model</span> <span class="key">or</span> <span class="str">"gpt-4"</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t416" href="#t416">416</a></span><span class="t">                            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t417" href="#t417">417</a></span><span class="t">                                <span class="nam">encoder</span> <span class="op">=</span> <span class="nam">_tiktoken</span><span class="op">.</span><span class="nam">encoding_for_model</span><span class="op">(</span><span class="nam">token_model</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t418" href="#t418">418</a></span><span class="t">                            <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t419" href="#t419">419</a></span><span class="t">                                <span class="nam">encoder</span> <span class="op">=</span> <span class="nam">_tiktoken</span><span class="op">.</span><span class="nam">get_encoding</span><span class="op">(</span><span class="str">"cl100k_base"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t420" href="#t420">420</a></span><span class="t">                            <span class="nam">token_count</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t421" href="#t421">421</a></span><span class="t">                        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - defensive</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t422" href="#t422">422</a></span><span class="t">                            <span class="nam">errors</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="fst">f"</span><span class="fst">Failed to initialize tokenizer: </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t423" href="#t423">423</a></span><span class="t">                            <span class="nam">encoder</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t424" href="#t424">424</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t425" href="#t425">425</a></span><span class="t">                <span class="key">def</span> <span class="nam">report</span><span class="op">(</span><span class="nam">description</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t426" href="#t426">426</a></span><span class="t">                    <span class="key">if</span> <span class="nam">progress_callback</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t427" href="#t427">427</a></span><span class="t">                        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t428" href="#t428">428</a></span><span class="t">                    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t429" href="#t429">429</a></span><span class="t">                        <span class="nam">progress_callback</span><span class="op">(</span><span class="nam">advance</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">description</span><span class="op">=</span><span class="nam">description</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t430" href="#t430">430</a></span><span class="t">                    <span class="key">except</span> <span class="nam">TypeError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t431" href="#t431">431</a></span><span class="t">                        <span class="nam">progress_callback</span><span class="op">(</span><span class="num">1</span><span class="op">)</span>  <span class="com"># type: ignore[misc]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t432" href="#t432">432</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t433" href="#t433">433</a></span><span class="t">                <span class="key">for</span> <span class="nam">file_path</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">root_path</span><span class="op">.</span><span class="nam">rglob</span><span class="op">(</span><span class="str">"*"</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t434" href="#t434">434</a></span><span class="t">                    <span class="key">if</span> <span class="key">not</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">is_file</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t435" href="#t435">435</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t436" href="#t436">436</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t437" href="#t437">437</a></span><span class="t">                    <span class="nam">relative_path</span> <span class="op">=</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">relative_to</span><span class="op">(</span><span class="nam">root_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t438" href="#t438">438</a></span><span class="t">                    <span class="nam">relative_str</span> <span class="op">=</span> <span class="nam">str</span><span class="op">(</span><span class="nam">relative_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t439" href="#t439">439</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t440" href="#t440">440</a></span><span class="t">                    <span class="key">if</span> <span class="nam">temp_path_resolved</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">resolve</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="nam">temp_path_resolved</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t441" href="#t441">441</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t442" href="#t442">442</a></span><span class="t">                    <span class="key">if</span> <span class="nam">file_path</span><span class="op">.</span><span class="nam">resolve</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="nam">output_path</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t443" href="#t443">443</a></span><span class="t">                        <span class="nam">report</span><span class="op">(</span><span class="fst">f"</span><span class="fst">Skipping </span><span class="op">{</span><span class="nam">relative_str</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t444" href="#t444">444</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t445" href="#t445">445</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t446" href="#t446">446</a></span><span class="t">                    <span class="nam">include_override</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t447" href="#t447">447</a></span><span class="t">                    <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t448" href="#t448">448</a></span><span class="t">                        <span class="nam">include_override</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_match_any</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">,</span> <span class="nam">relative_str</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t449" href="#t449">449</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t450" href="#t450">450</a></span><span class="t">                    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t451" href="#t451">451</a></span><span class="t">                        <span class="nam">skip</span><span class="op">,</span> <span class="nam">reason</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_should_skip</span><span class="op">(</span><span class="nam">file_path</span><span class="op">,</span> <span class="nam">include_override</span><span class="op">=</span><span class="nam">include_override</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t452" href="#t452">452</a></span><span class="t">                    <span class="key">except</span> <span class="nam">ExtractionError</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t453" href="#t453">453</a></span><span class="t">                        <span class="nam">errors</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">exc</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t454" href="#t454">454</a></span><span class="t">                        <span class="nam">skipped_paths</span><span class="op">[</span><span class="str">"other"</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">relative_str</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t455" href="#t455">455</a></span><span class="t">                        <span class="nam">report</span><span class="op">(</span><span class="fst">f"</span><span class="fst">Skipping </span><span class="op">{</span><span class="nam">relative_str</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t456" href="#t456">456</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t457" href="#t457">457</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t458" href="#t458">458</a></span><span class="t">                    <span class="key">if</span> <span class="nam">skip</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t459" href="#t459">459</a></span><span class="t">                        <span class="nam">skipped_key</span> <span class="op">=</span> <span class="nam">reason</span> <span class="key">or</span> <span class="str">"other"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t460" href="#t460">460</a></span><span class="t">                        <span class="nam">skipped_paths</span><span class="op">[</span><span class="nam">skipped_key</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">relative_str</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t461" href="#t461">461</a></span><span class="t">                        <span class="nam">report</span><span class="op">(</span><span class="fst">f"</span><span class="fst">Skipping </span><span class="op">{</span><span class="nam">relative_str</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t462" href="#t462">462</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t463" href="#t463">463</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t464" href="#t464">464</a></span><span class="t">                    <span class="key">if</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_is_text_file</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t465" href="#t465">465</a></span><span class="t">                        <span class="nam">skipped_paths</span><span class="op">[</span><span class="str">"binary"</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">relative_str</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t466" href="#t466">466</a></span><span class="t">                        <span class="nam">report</span><span class="op">(</span><span class="fst">f"</span><span class="fst">Skipping </span><span class="op">{</span><span class="nam">relative_str</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t467" href="#t467">467</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t468" href="#t468">468</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t469" href="#t469">469</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t470" href="#t470">470</a></span><span class="t">                    <span class="nam">content</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_read_file_content</span><span class="op">(</span><span class="nam">file_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t471" href="#t471">471</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t472" href="#t472">472</a></span><span class="t">                    <span class="nam">formatter</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_format_compact</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="key">else</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_format_standard</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t473" href="#t473">473</a></span><span class="t">                    <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="nam">formatter</span><span class="op">(</span><span class="nam">relative_path</span><span class="op">,</span> <span class="nam">content</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t474" href="#t474">474</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t475" href="#t475">475</a></span><span class="t">                    <span class="nam">processed_paths</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">relative_str</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t476" href="#t476">476</a></span><span class="t">                    <span class="nam">total_bytes</span> <span class="op">+=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">content</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t477" href="#t477">477</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t478" href="#t478">478</a></span><span class="t">                    <span class="key">if</span> <span class="nam">encoder</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">token_count</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t479" href="#t479">479</a></span><span class="t">                        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t480" href="#t480">480</a></span><span class="t">                            <span class="nam">token_count</span> <span class="op">+=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">encoder</span><span class="op">.</span><span class="nam">encode</span><span class="op">(</span><span class="nam">content</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t481" href="#t481">481</a></span><span class="t">                        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - tokenizer fallback</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t482" href="#t482">482</a></span><span class="t">                            <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t483" href="#t483">483</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t484" href="#t484">484</a></span><span class="t">                    <span class="nam">report</span><span class="op">(</span><span class="nam">relative_str</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t485" href="#t485">485</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t486" href="#t486">486</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst">\n</span><span class="op">{</span><span class="str">'='</span> <span class="op">*</span> <span class="num">60</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t487" href="#t487">487</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Total files processed: </span><span class="op">{</span><span class="nam">len</span><span class="op">(</span><span class="nam">processed_paths</span><span class="op">)</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t488" href="#t488">488</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Total size: </span><span class="op">{</span><span class="nam">total_bytes</span> <span class="op">//</span> <span class="num">1024</span><span class="op">}</span><span class="fst">KB\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t489" href="#t489">489</a></span><span class="t">                <span class="key">if</span> <span class="nam">token_count</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t490" href="#t490">490</a></span><span class="t">                    <span class="nam">destination</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="fst">f"</span><span class="fst"># Total tokens: </span><span class="op">{</span><span class="nam">token_count</span><span class="op">}</span><span class="fst">\n</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t491" href="#t491">491</a></span><span class="t">                <span class="nam">destination</span><span class="op">.</span><span class="nam">flush</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t492" href="#t492">492</a></span><span class="t">                <span class="nam">os</span><span class="op">.</span><span class="nam">fsync</span><span class="op">(</span><span class="nam">destination</span><span class="op">.</span><span class="nam">fileno</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t493" href="#t493">493</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t494" href="#t494">494</a></span><span class="t">            <span class="key">if</span> <span class="nam">temp_path</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t495" href="#t495">495</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ExtractionError</span><span class="op">(</span><span class="str">"Failed to create temporary output file"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t496" href="#t496">496</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t497" href="#t497">497</a></span><span class="t">            <span class="nam">os</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="nam">temp_path</span><span class="op">,</span> <span class="nam">output_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t498" href="#t498">498</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t499" href="#t499">499</a></span><span class="t">        <span class="key">except</span> <span class="nam">ExtractionError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t500" href="#t500">500</a></span><span class="t">            <span class="key">if</span> <span class="nam">temp_path</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t501" href="#t501">501</a></span><span class="t">                <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t502" href="#t502">502</a></span><span class="t">                    <span class="nam">temp_path</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="nam">missing_ok</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t503" href="#t503">503</a></span><span class="t">                <span class="key">except</span> <span class="nam">OSError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t504" href="#t504">504</a></span><span class="t">                    <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t505" href="#t505">505</a></span><span class="t">            <span class="key">raise</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t506" href="#t506">506</a></span><span class="t">        <span class="key">except</span> <span class="nam">OSError</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t507" href="#t507">507</a></span><span class="t">            <span class="key">if</span> <span class="nam">temp_path</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t508" href="#t508">508</a></span><span class="t">                <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t509" href="#t509">509</a></span><span class="t">                    <span class="nam">temp_path</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="nam">missing_ok</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t510" href="#t510">510</a></span><span class="t">                <span class="key">except</span> <span class="nam">OSError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t511" href="#t511">511</a></span><span class="t">                    <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t512" href="#t512">512</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ExtractionError</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">exc</span><span class="op">)</span><span class="op">)</span> <span class="key">from</span> <span class="nam">exc</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t513" href="#t513">513</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t514" href="#t514">514</a></span><span class="t">            <span class="key">if</span> <span class="nam">temp_path</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t515" href="#t515">515</a></span><span class="t">                <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t516" href="#t516">516</a></span><span class="t">                    <span class="nam">temp_path</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="nam">missing_ok</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t517" href="#t517">517</a></span><span class="t">                <span class="key">except</span> <span class="nam">OSError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t518" href="#t518">518</a></span><span class="t">                    <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t519" href="#t519">519</a></span><span class="t">            <span class="key">raise</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t520" href="#t520">520</a></span><span class="t">        <span class="key">finally</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t521" href="#t521">521</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_root_path</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t522" href="#t522">522</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_gitignore_spec</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t523" href="#t523">523</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t524" href="#t524">524</a></span><span class="t">        <span class="nam">stats</span> <span class="op">=</span> <span class="nam">ExtractionStats</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t525" href="#t525">525</a></span><span class="t">            <span class="nam">root</span><span class="op">=</span><span class="nam">root_path</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t526" href="#t526">526</a></span><span class="t">            <span class="nam">output</span><span class="op">=</span><span class="nam">output_path</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t527" href="#t527">527</a></span><span class="t">            <span class="nam">processed_paths</span><span class="op">=</span><span class="nam">list</span><span class="op">(</span><span class="nam">processed_paths</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t528" href="#t528">528</a></span><span class="t">            <span class="nam">total_bytes</span><span class="op">=</span><span class="nam">total_bytes</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t529" href="#t529">529</a></span><span class="t">            <span class="nam">skipped_paths</span><span class="op">=</span><span class="op">{</span><span class="nam">reason</span><span class="op">:</span> <span class="nam">list</span><span class="op">(</span><span class="nam">paths</span><span class="op">)</span> <span class="key">for</span> <span class="nam">reason</span><span class="op">,</span> <span class="nam">paths</span> <span class="key">in</span> <span class="nam">skipped_paths</span><span class="op">.</span><span class="nam">items</span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t530" href="#t530">530</a></span><span class="t">            <span class="nam">errors</span><span class="op">=</span><span class="nam">errors</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t531" href="#t531">531</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t532" href="#t532">532</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t533" href="#t533">533</a></span><span class="t">        <span class="key">if</span> <span class="nam">token_count</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t534" href="#t534">534</a></span><span class="t">            <span class="nam">stats</span><span class="op">.</span><span class="nam">token_count</span> <span class="op">=</span> <span class="nam">token_count</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t535" href="#t535">535</a></span><span class="t">            <span class="nam">stats</span><span class="op">.</span><span class="nam">token_model</span> <span class="op">=</span> <span class="nam">token_model</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t536" href="#t536">536</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t537" href="#t537">537</a></span><span class="t">        <span class="key">return</span> <span class="nam">stats</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t538" href="#t538">538</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t539" href="#t539">539</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t540" href="#t540">540</a></span><span class="t"><span class="nam">__all__</span> <span class="op">=</span> <span class="op">[</span><span class="str">"FileExtractor"</span><span class="op">,</span> <span class="str">"ExtractionError"</span><span class="op">,</span> <span class="str">"ExtractionStats"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87_config_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87_interactive_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:06 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87_interactive_py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/interactive.py: 73%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/interactive.py</b>:
            <span class="pc_cov">73%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">321 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">234<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">87<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">56<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87_core_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87_main_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Rich + prompt_toolkit powered REPL for Proxtract."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">annotations</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">import</span> <span class="nam">shlex</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">from</span> <span class="nam">contextlib</span> <span class="key">import</span> <span class="nam">nullcontext</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="key">from</span> <span class="nam">pathlib</span> <span class="key">import</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t"><span class="key">from</span> <span class="nam">typing</span> <span class="key">import</span> <span class="nam">Iterable</span><span class="op">,</span> <span class="nam">List</span><span class="op">,</span> <span class="nam">Sequence</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># pragma: no cover - optional import guarded for minimal envs</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t">    <span class="key">from</span> <span class="nam">prompt_toolkit</span> <span class="key">import</span> <span class="nam">PromptSession</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t">    <span class="key">from</span> <span class="nam">prompt_toolkit</span><span class="op">.</span><span class="nam">completion</span> <span class="key">import</span> <span class="nam">Completer</span><span class="op">,</span> <span class="nam">Completion</span><span class="op">,</span> <span class="nam">PathCompleter</span><span class="op">,</span> <span class="nam">WordCompleter</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t">    <span class="key">from</span> <span class="nam">prompt_toolkit</span><span class="op">.</span><span class="nam">document</span> <span class="key">import</span> <span class="nam">Document</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t">    <span class="key">from</span> <span class="nam">prompt_toolkit</span><span class="op">.</span><span class="nam">history</span> <span class="key">import</span> <span class="nam">FileHistory</span><span class="op">,</span> <span class="nam">InMemoryHistory</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t">    <span class="key">from</span> <span class="nam">prompt_toolkit</span><span class="op">.</span><span class="nam">patch_stdout</span> <span class="key">import</span> <span class="nam">patch_stdout</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">    <span class="nam">PROMPT_TOOLKIT_AVAILABLE</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - fallback when prompt_toolkit absent</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t">    <span class="nam">PromptSession</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t">    <span class="nam">PROMPT_TOOLKIT_AVAILABLE</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t">    <span class="key">class</span> <span class="nam">Completion</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t">        <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">text</span><span class="op">:</span> <span class="nam">str</span><span class="op">,</span> <span class="nam">start_position</span><span class="op">:</span> <span class="nam">int</span> <span class="op">=</span> <span class="num">0</span><span class="op">,</span> <span class="nam">display</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">display_meta</span><span class="op">=</span><span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">text</span> <span class="op">=</span> <span class="nam">text</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">start_position</span> <span class="op">=</span> <span class="nam">start_position</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">display</span> <span class="op">=</span> <span class="nam">display</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">display_meta</span> <span class="op">=</span> <span class="nam">display_meta</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t">    <span class="key">class</span> <span class="nam">Completer</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t">        <span class="key">def</span> <span class="nam">get_completions</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t">            <span class="key">return</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t">    <span class="key">class</span> <span class="nam">WordCompleter</span><span class="op">(</span><span class="nam">Completer</span><span class="op">)</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">        <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">words</span><span class="op">,</span> <span class="op">**</span><span class="nam">_</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">words</span> <span class="op">=</span> <span class="nam">list</span><span class="op">(</span><span class="nam">words</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t">    <span class="key">class</span> <span class="nam">PathCompleter</span><span class="op">(</span><span class="nam">Completer</span><span class="op">)</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t">        <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">**</span><span class="nam">_</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t">            <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t">        <span class="key">def</span> <span class="nam">get_completions</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t">            <span class="key">return</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t">    <span class="key">class</span> <span class="nam">Document</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t">        <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">text</span><span class="op">:</span> <span class="nam">str</span> <span class="op">=</span> <span class="str">""</span><span class="op">,</span> <span class="nam">cursor_position</span><span class="op">:</span> <span class="nam">int</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">text</span> <span class="op">=</span> <span class="nam">text</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">cursor_position</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">text</span><span class="op">)</span> <span class="key">if</span> <span class="nam">cursor_position</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">cursor_position</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t">        <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t">        <span class="key">def</span> <span class="nam">text_before_cursor</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">text</span><span class="op">[</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">cursor_position</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t">        <span class="key">def</span> <span class="nam">get_word_before_cursor</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t">            <span class="nam">text</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">text_before_cursor</span><span class="op">.</span><span class="nam">rstrip</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">            <span class="key">return</span> <span class="nam">text</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">text</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="op">)</span> <span class="key">else</span> <span class="str">""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">    <span class="key">class</span> <span class="nam">InMemoryHistory</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t">        <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="nam">_</span><span class="op">,</span> <span class="op">**</span><span class="nam">__</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t">            <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t">    <span class="key">class</span> <span class="nam">FileHistory</span><span class="op">(</span><span class="nam">InMemoryHistory</span><span class="op">)</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">        <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="nam">_</span><span class="op">,</span> <span class="op">**</span><span class="nam">__</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t">            <span class="key">raise</span> <span class="nam">RuntimeError</span><span class="op">(</span><span class="str">"prompt_toolkit is required for persistent history support"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t">    <span class="key">def</span> <span class="nam">patch_stdout</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># type: ignore[override]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">        <span class="key">return</span> <span class="nam">nullcontext</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">console</span> <span class="key">import</span> <span class="nam">Console</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">panel</span> <span class="key">import</span> <span class="nam">Panel</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">progress</span> <span class="key">import</span> <span class="nam">BarColumn</span><span class="op">,</span> <span class="nam">Progress</span><span class="op">,</span> <span class="nam">SpinnerColumn</span><span class="op">,</span> <span class="nam">TextColumn</span><span class="op">,</span> <span class="nam">TimeElapsedColumn</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">table</span> <span class="key">import</span> <span class="nam">Table</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t71" href="#t71">71</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">text</span> <span class="key">import</span> <span class="nam">Text</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t72" href="#t72">72</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t73" href="#t73">73</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">config</span> <span class="key">import</span> <span class="nam">apply_config</span><span class="op">,</span> <span class="nam">load_config</span><span class="op">,</span> <span class="nam">save_config</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t74" href="#t74">74</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">core</span> <span class="key">import</span> <span class="nam">ExtractionError</span><span class="op">,</span> <span class="nam">ExtractionStats</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t75" href="#t75">75</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">state</span> <span class="key">import</span> <span class="nam">AppState</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t76" href="#t76">76</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">utils</span> <span class="key">import</span> <span class="nam">create_console</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t77" href="#t77">77</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t78" href="#t78">78</a></span><span class="t"><span class="nam">COMMANDS</span> <span class="op">=</span> <span class="op">[</span><span class="str">"extract"</span><span class="op">,</span> <span class="str">"set"</span><span class="op">,</span> <span class="str">"show"</span><span class="op">,</span> <span class="str">"config"</span><span class="op">,</span> <span class="str">"save"</span><span class="op">,</span> <span class="str">"help"</span><span class="op">,</span> <span class="str">"exit"</span><span class="op">,</span> <span class="str">"quit"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t79" href="#t79">79</a></span><span class="t"><span class="nam">SETTING_KEYS</span> <span class="op">=</span> <span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t80" href="#t80">80</a></span><span class="t">    <span class="str">"source_path"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t81" href="#t81">81</a></span><span class="t">    <span class="str">"output_path"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t82" href="#t82">82</a></span><span class="t">    <span class="str">"max_size_kb"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t83" href="#t83">83</a></span><span class="t">    <span class="str">"compact_mode"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t84" href="#t84">84</a></span><span class="t">    <span class="str">"skip_empty"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t85" href="#t85">85</a></span><span class="t">    <span class="str">"use_gitignore"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t86" href="#t86">86</a></span><span class="t">    <span class="str">"force_include"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t87" href="#t87">87</a></span><span class="t">    <span class="str">"include_patterns"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t88" href="#t88">88</a></span><span class="t">    <span class="str">"exclude_patterns"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t89" href="#t89">89</a></span><span class="t">    <span class="str">"count_tokens"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t90" href="#t90">90</a></span><span class="t">    <span class="str">"tokenizer_model"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t91" href="#t91">91</a></span><span class="t">    <span class="str">"copy_clipboard"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t92" href="#t92">92</a></span><span class="t"><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t93" href="#t93">93</a></span><span class="t"><span class="nam">BOOLEAN_KEYS</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t94" href="#t94">94</a></span><span class="t">    <span class="str">"compact_mode"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t95" href="#t95">95</a></span><span class="t">    <span class="str">"skip_empty"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t96" href="#t96">96</a></span><span class="t">    <span class="str">"use_gitignore"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t97" href="#t97">97</a></span><span class="t">    <span class="str">"force_include"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t98" href="#t98">98</a></span><span class="t">    <span class="str">"count_tokens"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t99" href="#t99">99</a></span><span class="t">    <span class="str">"copy_clipboard"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t100" href="#t100">100</a></span><span class="t"><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t101" href="#t101">101</a></span><span class="t"><span class="nam">PATH_KEYS</span> <span class="op">=</span> <span class="op">{</span><span class="str">"source_path"</span><span class="op">,</span> <span class="str">"output_path"</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t102" href="#t102">102</a></span><span class="t"><span class="nam">PATH_ONLY_DIR_KEYS</span> <span class="op">=</span> <span class="op">{</span><span class="str">"source_path"</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t103" href="#t103">103</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t104" href="#t104">104</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t105" href="#t105">105</a></span><span class="t"><span class="key">def</span> <span class="nam">_history_path</span><span class="op">(</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Path</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t106" href="#t106">106</a></span><span class="t">    <span class="key">return</span> <span class="nam">Path</span><span class="op">(</span><span class="str">"~/.config/proxtract/history"</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t107" href="#t107">107</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t108" href="#t108">108</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t109" href="#t109">109</a></span><span class="t"><span class="key">def</span> <span class="nam">_tokenize</span><span class="op">(</span><span class="nam">command</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">List</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t110" href="#t110">110</a></span><span class="t">    <span class="nam">stripped</span> <span class="op">=</span> <span class="nam">command</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t111" href="#t111">111</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">stripped</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t112" href="#t112">112</a></span><span class="t">        <span class="key">return</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t113" href="#t113">113</a></span><span class="t">    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t114" href="#t114">114</a></span><span class="t">        <span class="nam">tokens</span> <span class="op">=</span> <span class="nam">shlex</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="nam">command</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t115" href="#t115">115</a></span><span class="t">    <span class="key">except</span> <span class="nam">ValueError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t116" href="#t116">116</a></span><span class="t">        <span class="com"># Fallback to simple whitespace split if quoting is incomplete</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t117" href="#t117">117</a></span><span class="t">        <span class="nam">tokens</span> <span class="op">=</span> <span class="nam">command</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t118" href="#t118">118</a></span><span class="t">    <span class="key">if</span> <span class="nam">command</span><span class="op">.</span><span class="nam">endswith</span><span class="op">(</span><span class="op">(</span><span class="str">" "</span><span class="op">,</span> <span class="str">"\t"</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t119" href="#t119">119</a></span><span class="t">        <span class="nam">tokens</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">""</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t120" href="#t120">120</a></span><span class="t">    <span class="key">return</span> <span class="nam">tokens</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t121" href="#t121">121</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t122" href="#t122">122</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t123" href="#t123">123</a></span><span class="t"><span class="key">class</span> <span class="nam">ProxtractCompleter</span><span class="op">(</span><span class="nam">Completer</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t124" href="#t124">124</a></span><span class="t">    <span class="str">"""Context-aware completer for the REPL."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t125" href="#t125">125</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t126" href="#t126">126</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t127" href="#t127">127</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_command_words</span> <span class="op">=</span> <span class="nam">WordCompleter</span><span class="op">(</span><span class="nam">COMMANDS</span><span class="op">,</span> <span class="nam">ignore_case</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t128" href="#t128">128</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_setting_words</span> <span class="op">=</span> <span class="nam">WordCompleter</span><span class="op">(</span><span class="nam">SETTING_KEYS</span><span class="op">,</span> <span class="nam">ignore_case</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t129" href="#t129">129</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_boolean_words</span> <span class="op">=</span> <span class="nam">WordCompleter</span><span class="op">(</span><span class="op">[</span><span class="str">"on"</span><span class="op">,</span> <span class="str">"off"</span><span class="op">]</span><span class="op">,</span> <span class="nam">ignore_case</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t130" href="#t130">130</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_path_completer</span> <span class="op">=</span> <span class="nam">PathCompleter</span><span class="op">(</span><span class="nam">expanduser</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t131" href="#t131">131</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_dir_completer</span> <span class="op">=</span> <span class="nam">PathCompleter</span><span class="op">(</span><span class="nam">expanduser</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">only_directories</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t132" href="#t132">132</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t133" href="#t133">133</a></span><span class="t">    <span class="key">def</span> <span class="nam">_complete_from_word_completer</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t134" href="#t134">134</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span> <span class="nam">completer</span><span class="op">:</span> <span class="nam">WordCompleter</span><span class="op">,</span> <span class="nam">word</span><span class="op">:</span> <span class="nam">str</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t135" href="#t135">135</a></span><span class="t">    <span class="op">)</span> <span class="op">-></span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">Completion</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t136" href="#t136">136</a></span><span class="t">        <span class="nam">prefix</span> <span class="op">=</span> <span class="str">""</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t137" href="#t137">137</a></span><span class="t">        <span class="nam">lookup</span> <span class="op">=</span> <span class="nam">word</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t138" href="#t138">138</a></span><span class="t">        <span class="key">if</span> <span class="nam">lookup</span><span class="op">.</span><span class="nam">startswith</span><span class="op">(</span><span class="str">"/"</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t139" href="#t139">139</a></span><span class="t">            <span class="nam">prefix</span> <span class="op">=</span> <span class="str">"/"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t140" href="#t140">140</a></span><span class="t">            <span class="nam">lookup</span> <span class="op">=</span> <span class="nam">lookup</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t141" href="#t141">141</a></span><span class="t">        <span class="nam">start_position</span> <span class="op">=</span> <span class="op">-</span><span class="nam">len</span><span class="op">(</span><span class="nam">word</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t142" href="#t142">142</a></span><span class="t">        <span class="nam">lowered</span> <span class="op">=</span> <span class="nam">lookup</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t143" href="#t143">143</a></span><span class="t">        <span class="key">for</span> <span class="nam">candidate</span> <span class="key">in</span> <span class="nam">completer</span><span class="op">.</span><span class="nam">words</span><span class="op">:</span>  <span class="com"># type: ignore[attr-defined]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t144" href="#t144">144</a></span><span class="t">            <span class="key">if</span> <span class="nam">lowered</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">candidate</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">startswith</span><span class="op">(</span><span class="nam">lowered</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t145" href="#t145">145</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t146" href="#t146">146</a></span><span class="t">            <span class="nam">candidate_text</span> <span class="op">=</span> <span class="nam">prefix</span> <span class="op">+</span> <span class="nam">candidate</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t147" href="#t147">147</a></span><span class="t">            <span class="key">yield</span> <span class="nam">Completion</span><span class="op">(</span><span class="nam">candidate_text</span><span class="op">,</span> <span class="nam">start_position</span><span class="op">=</span><span class="nam">start_position</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t148" href="#t148">148</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t149" href="#t149">149</a></span><span class="t">    <span class="key">def</span> <span class="nam">_complete_path</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">word</span><span class="op">:</span> <span class="nam">str</span><span class="op">,</span> <span class="op">*</span><span class="op">,</span> <span class="nam">directories_only</span><span class="op">:</span> <span class="nam">bool</span><span class="op">,</span> <span class="nam">complete_event</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">Completion</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t150" href="#t150">150</a></span><span class="t">        <span class="nam">completer</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_dir_completer</span> <span class="key">if</span> <span class="nam">directories_only</span> <span class="key">else</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_path_completer</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t151" href="#t151">151</a></span><span class="t">        <span class="nam">fake_document</span> <span class="op">=</span> <span class="nam">Document</span><span class="op">(</span><span class="nam">text</span><span class="op">=</span><span class="nam">word</span><span class="op">,</span> <span class="nam">cursor_position</span><span class="op">=</span><span class="nam">len</span><span class="op">(</span><span class="nam">word</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t152" href="#t152">152</a></span><span class="t">        <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">completer</span><span class="op">.</span><span class="nam">get_completions</span><span class="op">(</span><span class="nam">fake_document</span><span class="op">,</span> <span class="nam">complete_event</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t153" href="#t153">153</a></span><span class="t">            <span class="key">yield</span> <span class="nam">Completion</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t154" href="#t154">154</a></span><span class="t">                <span class="nam">item</span><span class="op">.</span><span class="nam">text</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t155" href="#t155">155</a></span><span class="t">                <span class="nam">start_position</span><span class="op">=</span><span class="op">-</span><span class="nam">len</span><span class="op">(</span><span class="nam">word</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t156" href="#t156">156</a></span><span class="t">                <span class="nam">display</span><span class="op">=</span><span class="nam">item</span><span class="op">.</span><span class="nam">display</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t157" href="#t157">157</a></span><span class="t">                <span class="nam">display_meta</span><span class="op">=</span><span class="nam">item</span><span class="op">.</span><span class="nam">display_meta</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t158" href="#t158">158</a></span><span class="t">            <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t159" href="#t159">159</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t160" href="#t160">160</a></span><span class="t">    <span class="key">def</span> <span class="nam">get_completions</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">document</span><span class="op">:</span> <span class="nam">Document</span><span class="op">,</span> <span class="nam">complete_event</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">Completion</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t161" href="#t161">161</a></span><span class="t">        <span class="nam">text</span> <span class="op">=</span> <span class="nam">document</span><span class="op">.</span><span class="nam">text_before_cursor</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t162" href="#t162">162</a></span><span class="t">        <span class="nam">tokens</span> <span class="op">=</span> <span class="nam">_tokenize</span><span class="op">(</span><span class="nam">text</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t163" href="#t163">163</a></span><span class="t">        <span class="nam">raw_command</span> <span class="op">=</span> <span class="nam">tokens</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">if</span> <span class="nam">tokens</span> <span class="key">else</span> <span class="nam">document</span><span class="op">.</span><span class="nam">get_word_before_cursor</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t164" href="#t164">164</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">tokens</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t165" href="#t165">165</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_from_word_completer</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_command_words</span><span class="op">,</span> <span class="nam">raw_command</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t166" href="#t166">166</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t167" href="#t167">167</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t168" href="#t168">168</a></span><span class="t">        <span class="key">if</span> <span class="nam">tokens</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">""</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t169" href="#t169">169</a></span><span class="t">            <span class="nam">current_word</span> <span class="op">=</span> <span class="str">""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t170" href="#t170">170</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t171" href="#t171">171</a></span><span class="t">            <span class="nam">current_word</span> <span class="op">=</span> <span class="nam">document</span><span class="op">.</span><span class="nam">get_word_before_cursor</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t172" href="#t172">172</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t173" href="#t173">173</a></span><span class="t">        <span class="nam">command</span> <span class="op">=</span> <span class="nam">tokens</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t174" href="#t174">174</a></span><span class="t">        <span class="nam">token_count</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">tokens</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t175" href="#t175">175</a></span><span class="t">        <span class="key">if</span> <span class="nam">token_count</span> <span class="op">==</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">current_word</span> <span class="op">!=</span> <span class="str">""</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t176" href="#t176">176</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_from_word_completer</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_command_words</span><span class="op">,</span> <span class="nam">raw_command</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t177" href="#t177">177</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t178" href="#t178">178</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t179" href="#t179">179</a></span><span class="t">        <span class="key">if</span> <span class="nam">command</span> <span class="key">in</span> <span class="op">{</span><span class="str">"exit"</span><span class="op">,</span> <span class="str">"quit"</span><span class="op">,</span> <span class="str">"help"</span><span class="op">,</span> <span class="str">"show"</span><span class="op">,</span> <span class="str">"config"</span><span class="op">,</span> <span class="str">"save"</span><span class="op">}</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t180" href="#t180">180</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t181" href="#t181">181</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t182" href="#t182">182</a></span><span class="t">        <span class="key">if</span> <span class="nam">command</span> <span class="op">==</span> <span class="str">"set"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t183" href="#t183">183</a></span><span class="t">            <span class="key">if</span> <span class="nam">token_count</span> <span class="op">&lt;=</span> <span class="num">2</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">text</span><span class="op">.</span><span class="nam">endswith</span><span class="op">(</span><span class="str">" "</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t184" href="#t184">184</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_from_word_completer</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_setting_words</span><span class="op">,</span> <span class="nam">current_word</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t185" href="#t185">185</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t186" href="#t186">186</a></span><span class="t">            <span class="key">if</span> <span class="nam">token_count</span> <span class="op">==</span> <span class="num">2</span> <span class="key">and</span> <span class="nam">text</span><span class="op">.</span><span class="nam">endswith</span><span class="op">(</span><span class="str">" "</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t187" href="#t187">187</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_from_word_completer</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_setting_words</span><span class="op">,</span> <span class="str">""</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t188" href="#t188">188</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t189" href="#t189">189</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t190" href="#t190">190</a></span><span class="t">            <span class="nam">key</span> <span class="op">=</span> <span class="nam">tokens</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">tokens</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span> <span class="key">else</span> <span class="str">""</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t191" href="#t191">191</a></span><span class="t">            <span class="key">if</span> <span class="nam">key</span> <span class="key">in</span> <span class="nam">BOOLEAN_KEYS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t192" href="#t192">192</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_from_word_completer</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_boolean_words</span><span class="op">,</span> <span class="nam">current_word</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t193" href="#t193">193</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t194" href="#t194">194</a></span><span class="t">            <span class="key">if</span> <span class="nam">key</span> <span class="key">in</span> <span class="nam">PATH_KEYS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t195" href="#t195">195</a></span><span class="t">                <span class="nam">directories_only</span> <span class="op">=</span> <span class="nam">key</span> <span class="key">in</span> <span class="nam">PATH_ONLY_DIR_KEYS</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t196" href="#t196">196</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_path</span><span class="op">(</span><span class="nam">current_word</span><span class="op">,</span> <span class="nam">directories_only</span><span class="op">=</span><span class="nam">directories_only</span><span class="op">,</span> <span class="nam">complete_event</span><span class="op">=</span><span class="nam">complete_event</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t197" href="#t197">197</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t198" href="#t198">198</a></span><span class="t">            <span class="key">if</span> <span class="nam">key</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t199" href="#t199">199</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t200" href="#t200">200</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t201" href="#t201">201</a></span><span class="t">        <span class="key">if</span> <span class="nam">command</span> <span class="op">==</span> <span class="str">"extract"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t202" href="#t202">202</a></span><span class="t">            <span class="key">if</span> <span class="nam">token_count</span> <span class="op">&lt;=</span> <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t203" href="#t203">203</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_path</span><span class="op">(</span><span class="nam">current_word</span><span class="op">,</span> <span class="nam">directories_only</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">complete_event</span><span class="op">=</span><span class="nam">complete_event</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t204" href="#t204">204</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t205" href="#t205">205</a></span><span class="t">            <span class="key">if</span> <span class="nam">token_count</span> <span class="op">==</span> <span class="num">3</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t206" href="#t206">206</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_complete_path</span><span class="op">(</span><span class="nam">current_word</span><span class="op">,</span> <span class="nam">directories_only</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="nam">complete_event</span><span class="op">=</span><span class="nam">complete_event</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t207" href="#t207">207</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t208" href="#t208">208</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t209" href="#t209">209</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t210" href="#t210">210</a></span><span class="t"><span class="key">class</span> <span class="nam">InteractiveShell</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t211" href="#t211">211</a></span><span class="t">    <span class="str">"""Interactive REPL for Proxtract commands."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t212" href="#t212">212</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t213" href="#t213">213</a></span><span class="t">    <span class="nam">PROMPT</span> <span class="op">=</span> <span class="str">"proxtract> "</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t214" href="#t214">214</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t215" href="#t215">215</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">console</span><span class="op">:</span> <span class="nam">Console</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span> <span class="nam">state</span><span class="op">:</span> <span class="nam">AppState</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t216" href="#t216">216</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span> <span class="op">=</span> <span class="nam">console</span> <span class="key">or</span> <span class="nam">create_console</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t217" href="#t217">217</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span> <span class="op">=</span> <span class="nam">state</span> <span class="key">or</span> <span class="nam">apply_config</span><span class="op">(</span><span class="nam">AppState</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">load_config</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t218" href="#t218">218</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">completer</span> <span class="op">=</span> <span class="nam">ProxtractCompleter</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t219" href="#t219">219</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_session</span><span class="op">:</span> <span class="nam">PromptSession</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t220" href="#t220">220</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_running</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t221" href="#t221">221</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t222" href="#t222">222</a></span><span class="t">    <span class="key">def</span> <span class="nam">run</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t223" href="#t223">223</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_render_banner</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t224" href="#t224">224</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t225" href="#t225">225</a></span><span class="t">            <span class="nam">session</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_ensure_session</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t226" href="#t226">226</a></span><span class="t">        <span class="key">except</span> <span class="nam">RuntimeError</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t227" href="#t227">227</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]</span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">[/red]</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t228" href="#t228">228</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t229" href="#t229">229</a></span><span class="t">        <span class="key">with</span> <span class="nam">patch_stdout</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t230" href="#t230">230</a></span><span class="t">            <span class="key">while</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_running</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t231" href="#t231">231</a></span><span class="t">                <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t232" href="#t232">232</a></span><span class="t">                    <span class="nam">text</span> <span class="op">=</span> <span class="nam">session</span><span class="op">.</span><span class="nam">prompt</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">PROMPT</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t233" href="#t233">233</a></span><span class="t">                <span class="key">except</span> <span class="op">(</span><span class="nam">KeyboardInterrupt</span><span class="op">,</span> <span class="nam">EOFError</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t234" href="#t234">234</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="str">"[yellow]Type 'exit' or 'quit' to close Proxtract.[/yellow]"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t235" href="#t235">235</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t236" href="#t236">236</a></span><span class="t">                <span class="key">if</span> <span class="key">not</span> <span class="nam">text</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t237" href="#t237">237</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t238" href="#t238">238</a></span><span class="t">                <span class="key">if</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">handle_command</span><span class="op">(</span><span class="nam">text</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t239" href="#t239">239</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t240" href="#t240">240</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t241" href="#t241">241</a></span><span class="t">    <span class="key">def</span> <span class="nam">handle_command</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">command</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t242" href="#t242">242</a></span><span class="t">        <span class="nam">tokens</span> <span class="op">=</span> <span class="nam">_tokenize</span><span class="op">(</span><span class="nam">command</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t243" href="#t243">243</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">tokens</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t244" href="#t244">244</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t245" href="#t245">245</a></span><span class="t">        <span class="nam">cmd</span> <span class="op">=</span> <span class="nam">tokens</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lstrip</span><span class="op">(</span><span class="str">"/"</span><span class="op">)</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t246" href="#t246">246</a></span><span class="t">        <span class="nam">args</span> <span class="op">=</span> <span class="nam">tokens</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t247" href="#t247">247</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t248" href="#t248">248</a></span><span class="t">        <span class="key">if</span> <span class="nam">cmd</span> <span class="key">in</span> <span class="op">{</span><span class="str">"exit"</span><span class="op">,</span> <span class="str">"quit"</span><span class="op">}</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t249" href="#t249">249</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="str">"[green]&#1044;&#1086; &#1074;&#1089;&#1090;&#1088;&#1077;&#1095;&#1080;![/green]"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"green"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t250" href="#t250">250</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t251" href="#t251">251</a></span><span class="t">        <span class="key">if</span> <span class="nam">cmd</span> <span class="op">==</span> <span class="str">"help"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t252" href="#t252">252</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_show_help</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t253" href="#t253">253</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t254" href="#t254">254</a></span><span class="t">        <span class="key">if</span> <span class="nam">cmd</span> <span class="key">in</span> <span class="op">{</span><span class="str">"show"</span><span class="op">,</span> <span class="str">"config"</span><span class="op">}</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t255" href="#t255">255</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_show_config</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t256" href="#t256">256</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t257" href="#t257">257</a></span><span class="t">        <span class="key">if</span> <span class="nam">cmd</span> <span class="op">==</span> <span class="str">"save"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t258" href="#t258">258</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_save_config_command</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t259" href="#t259">259</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t260" href="#t260">260</a></span><span class="t">        <span class="key">if</span> <span class="nam">cmd</span> <span class="op">==</span> <span class="str">"set"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t261" href="#t261">261</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_set_value</span><span class="op">(</span><span class="nam">args</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t262" href="#t262">262</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t263" href="#t263">263</a></span><span class="t">        <span class="key">if</span> <span class="nam">cmd</span> <span class="op">==</span> <span class="str">"extract"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t264" href="#t264">264</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_run_extract</span><span class="op">(</span><span class="nam">args</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t265" href="#t265">265</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t266" href="#t266">266</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t267" href="#t267">267</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]&#1053;&#1077;&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1072;&#1103; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1072;:[/red] </span><span class="op">{</span><span class="nam">cmd</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t268" href="#t268">268</a></span><span class="t">        <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t269" href="#t269">269</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t270" href="#t270">270</a></span><span class="t">    <span class="key">def</span> <span class="nam">_render_banner</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t271" href="#t271">271</a></span><span class="t">        <span class="nam">text</span> <span class="op">=</span> <span class="nam">Text</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t272" href="#t272">272</a></span><span class="t">        <span class="nam">text</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">"Proxtract\n"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"bold green"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t273" href="#t273">273</a></span><span class="t">        <span class="nam">text</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">"&#1048;&#1085;&#1090;&#1077;&#1088;&#1072;&#1082;&#1090;&#1080;&#1074;&#1085;&#1099;&#1081; REPL &#1076;&#1083;&#1103; &#1080;&#1079;&#1074;&#1083;&#1077;&#1095;&#1077;&#1085;&#1080;&#1103; &#1092;&#1072;&#1081;&#1083;&#1086;&#1074; &#1087;&#1088;&#1086;&#1077;&#1082;&#1090;&#1086;&#1074;.\n"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"cyan"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t274" href="#t274">274</a></span><span class="t">        <span class="nam">text</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">"&#1050;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099;: extract, set, show, save, help, exit"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"white"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t275" href="#t275">275</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="nam">text</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"cyan"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t276" href="#t276">276</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t277" href="#t277">277</a></span><span class="t">    <span class="key">def</span> <span class="nam">_ensure_session</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">PromptSession</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t278" href="#t278">278</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_session</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t279" href="#t279">279</a></span><span class="t">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_session</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t280" href="#t280">280</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">PROMPT_TOOLKIT_AVAILABLE</span> <span class="key">or</span> <span class="nam">PromptSession</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t281" href="#t281">281</a></span><span class="t">            <span class="key">raise</span> <span class="nam">RuntimeError</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t282" href="#t282">282</a></span><span class="t">                <span class="str">"prompt_toolkit is required for the interactive REPL. "</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t283" href="#t283">283</a></span><span class="t">                <span class="str">"Install it via 'pip install prompt_toolkit' or reinstall Proxtract with the new dependencies."</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t284" href="#t284">284</a></span><span class="t">            <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t285" href="#t285">285</a></span><span class="t">        <span class="nam">history_path</span> <span class="op">=</span> <span class="nam">_history_path</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t286" href="#t286">286</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t287" href="#t287">287</a></span><span class="t">            <span class="nam">history_path</span><span class="op">.</span><span class="nam">parent</span><span class="op">.</span><span class="nam">mkdir</span><span class="op">(</span><span class="nam">parents</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">exist_ok</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t288" href="#t288">288</a></span><span class="t">            <span class="nam">history</span> <span class="op">=</span> <span class="nam">FileHistory</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">history_path</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t289" href="#t289">289</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t290" href="#t290">290</a></span><span class="t">            <span class="nam">history</span> <span class="op">=</span> <span class="nam">InMemoryHistory</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t291" href="#t291">291</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t292" href="#t292">292</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">_session</span> <span class="op">=</span> <span class="nam">PromptSession</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t293" href="#t293">293</a></span><span class="t">            <span class="nam">history</span><span class="op">=</span><span class="nam">history</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t294" href="#t294">294</a></span><span class="t">            <span class="nam">completer</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">completer</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t295" href="#t295">295</a></span><span class="t">            <span class="nam">complete_while_typing</span><span class="op">=</span><span class="key">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t296" href="#t296">296</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t297" href="#t297">297</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_session</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t298" href="#t298">298</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t299" href="#t299">299</a></span><span class="t">    <span class="key">def</span> <span class="nam">_show_help</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t300" href="#t300">300</a></span><span class="t">        <span class="nam">table</span> <span class="op">=</span> <span class="nam">Table</span><span class="op">(</span><span class="nam">show_header</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">header_style</span><span class="op">=</span><span class="str">"bold magenta"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t301" href="#t301">301</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_column</span><span class="op">(</span><span class="str">"&#1050;&#1086;&#1084;&#1072;&#1085;&#1076;&#1072;"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"cyan"</span><span class="op">,</span> <span class="nam">no_wrap</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t302" href="#t302">302</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_column</span><span class="op">(</span><span class="str">"&#1054;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1077;"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"white"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t303" href="#t303">303</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"extract [src] [out]"</span><span class="op">,</span> <span class="str">"&#1047;&#1072;&#1087;&#1091;&#1089;&#1090;&#1080;&#1090;&#1100; &#1080;&#1079;&#1074;&#1083;&#1077;&#1095;&#1077;&#1085;&#1080;&#1077;. &#1055;&#1091;&#1090;&#1080; &#1086;&#1087;&#1094;&#1080;&#1086;&#1085;&#1072;&#1083;&#1100;&#1085;&#1099;."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t304" href="#t304">304</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"set &lt;key> &lt;value>"</span><span class="op">,</span> <span class="str">"&#1048;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100; &#1085;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1091; (&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1081;&#1090;&#1077; Tab &#1076;&#1083;&#1103; &#1087;&#1086;&#1076;&#1089;&#1082;&#1072;&#1079;&#1086;&#1082;)."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t305" href="#t305">305</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"show / config"</span><span class="op">,</span> <span class="str">"&#1055;&#1086;&#1082;&#1072;&#1079;&#1072;&#1090;&#1100; &#1090;&#1077;&#1082;&#1091;&#1097;&#1080;&#1077; &#1085;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1080;."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t306" href="#t306">306</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"save"</span><span class="op">,</span> <span class="str">"&#1057;&#1086;&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1100; &#1085;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1080; &#1074; settings.toml."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t307" href="#t307">307</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"help"</span><span class="op">,</span> <span class="str">"&#1054;&#1090;&#1086;&#1073;&#1088;&#1072;&#1079;&#1080;&#1090;&#1100; &#1101;&#1090;&#1091; &#1089;&#1087;&#1088;&#1072;&#1074;&#1082;&#1091;."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t308" href="#t308">308</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"exit / quit"</span><span class="op">,</span> <span class="str">"&#1047;&#1072;&#1074;&#1077;&#1088;&#1096;&#1080;&#1090;&#1100; &#1088;&#1072;&#1073;&#1086;&#1090;&#1091;."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t309" href="#t309">309</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">table</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t310" href="#t310">310</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t311" href="#t311">311</a></span><span class="t">    <span class="key">def</span> <span class="nam">_show_config</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t312" href="#t312">312</a></span><span class="t">        <span class="nam">table</span> <span class="op">=</span> <span class="nam">Table</span><span class="op">(</span><span class="nam">title</span><span class="op">=</span><span class="str">"&#1058;&#1077;&#1082;&#1091;&#1097;&#1080;&#1077; &#1085;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1080;"</span><span class="op">,</span> <span class="nam">header_style</span><span class="op">=</span><span class="str">"bold blue"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t313" href="#t313">313</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_column</span><span class="op">(</span><span class="str">"&#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"cyan"</span><span class="op">,</span> <span class="nam">no_wrap</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t314" href="#t314">314</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_column</span><span class="op">(</span><span class="str">"&#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"white"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t315" href="#t315">315</a></span><span class="t">        <span class="key">for</span> <span class="nam">key</span><span class="op">,</span> <span class="nam">value</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_iter_config</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t316" href="#t316">316</a></span><span class="t">            <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="nam">key</span><span class="op">,</span> <span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t317" href="#t317">317</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">table</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t318" href="#t318">318</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t319" href="#t319">319</a></span><span class="t">    <span class="key">def</span> <span class="nam">_iter_config</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">tuple</span><span class="op">[</span><span class="nam">str</span><span class="op">,</span> <span class="nam">str</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t320" href="#t320">320</a></span><span class="t">        <span class="nam">state</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">state</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t321" href="#t321">321</a></span><span class="t">        <span class="key">yield</span> <span class="str">"source_path"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">source_root</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t322" href="#t322">322</a></span><span class="t">        <span class="key">yield</span> <span class="str">"output_path"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">output_path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t323" href="#t323">323</a></span><span class="t">        <span class="key">yield</span> <span class="str">"max_size_kb"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t324" href="#t324">324</a></span><span class="t">        <span class="key">yield</span> <span class="str">"compact_mode"</span><span class="op">,</span> <span class="str">"on"</span> <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="key">else</span> <span class="str">"off"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t325" href="#t325">325</a></span><span class="t">        <span class="key">yield</span> <span class="str">"skip_empty"</span><span class="op">,</span> <span class="str">"on"</span> <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="key">else</span> <span class="str">"off"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t326" href="#t326">326</a></span><span class="t">        <span class="key">yield</span> <span class="str">"use_gitignore"</span><span class="op">,</span> <span class="str">"on"</span> <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span> <span class="key">else</span> <span class="str">"off"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t327" href="#t327">327</a></span><span class="t">        <span class="key">yield</span> <span class="str">"force_include"</span><span class="op">,</span> <span class="str">"on"</span> <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span> <span class="key">else</span> <span class="str">"off"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t328" href="#t328">328</a></span><span class="t">        <span class="key">yield</span> <span class="str">"include_patterns"</span><span class="op">,</span> <span class="str">", "</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">)</span> <span class="key">or</span> <span class="str">"-"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t329" href="#t329">329</a></span><span class="t">        <span class="key">yield</span> <span class="str">"exclude_patterns"</span><span class="op">,</span> <span class="str">", "</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">state</span><span class="op">.</span><span class="nam">exclude_patterns</span><span class="op">)</span> <span class="key">or</span> <span class="str">"-"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t330" href="#t330">330</a></span><span class="t">        <span class="key">yield</span> <span class="str">"count_tokens"</span><span class="op">,</span> <span class="str">"on"</span> <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span> <span class="key">else</span> <span class="str">"off"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t331" href="#t331">331</a></span><span class="t">        <span class="key">yield</span> <span class="str">"tokenizer_model"</span><span class="op">,</span> <span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span> <span class="key">or</span> <span class="str">"-"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t332" href="#t332">332</a></span><span class="t">        <span class="key">yield</span> <span class="str">"copy_clipboard"</span><span class="op">,</span> <span class="str">"on"</span> <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span> <span class="key">else</span> <span class="str">"off"</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t333" href="#t333">333</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t334" href="#t334">334</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_value</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">args</span><span class="op">:</span> <span class="nam">Sequence</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t335" href="#t335">335</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">args</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t336" href="#t336">336</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="str">"[red]&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;: set &lt;key> &lt;value>[/red]"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t337" href="#t337">337</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t338" href="#t338">338</a></span><span class="t">        <span class="nam">key</span> <span class="op">=</span> <span class="nam">args</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t339" href="#t339">339</a></span><span class="t">        <span class="nam">value</span> <span class="op">=</span> <span class="str">" "</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">args</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t340" href="#t340">340</a></span><span class="t">        <span class="nam">handler</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="fst">f"</span><span class="fst">_set_</span><span class="op">{</span><span class="nam">key</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t341" href="#t341">341</a></span><span class="t">        <span class="key">if</span> <span class="nam">handler</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t342" href="#t342">342</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]&#1053;&#1077;&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1099;&#1081; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;:[/red] </span><span class="op">{</span><span class="nam">key</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t343" href="#t343">343</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t344" href="#t344">344</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t345" href="#t345">345</a></span><span class="t">            <span class="nam">handler</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t346" href="#t346">346</a></span><span class="t">        <span class="key">except</span> <span class="nam">ValueError</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t347" href="#t347">347</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]&#1054;&#1096;&#1080;&#1073;&#1082;&#1072;:[/red] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t348" href="#t348">348</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t349" href="#t349">349</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[green]</span><span class="op">{</span><span class="nam">key</span><span class="op">}</span><span class="fst"> &#1086;&#1073;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;.[/green]</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"green"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t350" href="#t350">350</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t351" href="#t351">351</a></span><span class="t">    <span class="key">def</span> <span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t352" href="#t352">352</a></span><span class="t">        <span class="nam">normalized</span> <span class="op">=</span> <span class="nam">value</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t353" href="#t353">353</a></span><span class="t">        <span class="key">if</span> <span class="nam">normalized</span> <span class="key">in</span> <span class="op">{</span><span class="str">"on"</span><span class="op">,</span> <span class="str">"true"</span><span class="op">,</span> <span class="str">"1"</span><span class="op">,</span> <span class="str">"yes"</span><span class="op">}</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t354" href="#t354">354</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t355" href="#t355">355</a></span><span class="t">        <span class="key">if</span> <span class="nam">normalized</span> <span class="key">in</span> <span class="op">{</span><span class="str">"off"</span><span class="op">,</span> <span class="str">"false"</span><span class="op">,</span> <span class="str">"0"</span><span class="op">,</span> <span class="str">"no"</span><span class="op">}</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t356" href="#t356">356</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t357" href="#t357">357</a></span><span class="t">        <span class="key">raise</span> <span class="nam">ValueError</span><span class="op">(</span><span class="str">"&#1042;&#1074;&#1077;&#1076;&#1080;&#1090;&#1077; 'on' &#1080;&#1083;&#1080; 'off'"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t358" href="#t358">358</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t359" href="#t359">359</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_source_path</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t360" href="#t360">360</a></span><span class="t">        <span class="nam">path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t361" href="#t361">361</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t362" href="#t362">362</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ValueError</span><span class="op">(</span><span class="str">"&#1055;&#1091;&#1090;&#1100; &#1085;&#1077; &#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t363" href="#t363">363</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">set_source_root</span><span class="op">(</span><span class="nam">path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t364" href="#t364">364</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t365" href="#t365">365</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_output_path</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t366" href="#t366">366</a></span><span class="t">        <span class="nam">path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t367" href="#t367">367</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">set_output_path</span><span class="op">(</span><span class="nam">path</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t368" href="#t368">368</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t369" href="#t369">369</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_max_size_kb</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t370" href="#t370">370</a></span><span class="t">        <span class="nam">size</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t371" href="#t371">371</a></span><span class="t">        <span class="key">if</span> <span class="nam">size</span> <span class="op">&lt;=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t372" href="#t372">372</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ValueError</span><span class="op">(</span><span class="str">"&#1056;&#1072;&#1079;&#1084;&#1077;&#1088; &#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077; &#1085;&#1091;&#1083;&#1103;"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t373" href="#t373">373</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span> <span class="op">=</span> <span class="nam">size</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t374" href="#t374">374</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t375" href="#t375">375</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_compact_mode</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t376" href="#t376">376</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t377" href="#t377">377</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t378" href="#t378">378</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_skip_empty</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t379" href="#t379">379</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t380" href="#t380">380</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t381" href="#t381">381</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_use_gitignore</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t382" href="#t382">382</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t383" href="#t383">383</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t384" href="#t384">384</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_force_include</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t385" href="#t385">385</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t386" href="#t386">386</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t387" href="#t387">387</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_include_patterns</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t388" href="#t388">388</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">include_patterns</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_patterns</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t389" href="#t389">389</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t390" href="#t390">390</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_exclude_patterns</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t391" href="#t391">391</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">exclude_patterns</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_patterns</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t392" href="#t392">392</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t393" href="#t393">393</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_count_tokens</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t394" href="#t394">394</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t395" href="#t395">395</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t396" href="#t396">396</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_tokenizer_model</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t397" href="#t397">397</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span> <span class="op">=</span> <span class="nam">value</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span> <span class="key">or</span> <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t398" href="#t398">398</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t399" href="#t399">399</a></span><span class="t">    <span class="key">def</span> <span class="nam">_set_copy_clipboard</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t400" href="#t400">400</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_parse_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t401" href="#t401">401</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t402" href="#t402">402</a></span><span class="t">    <span class="key">def</span> <span class="nam">_parse_patterns</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">str</span><span class="op">)</span> <span class="op">-></span> <span class="nam">List</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t403" href="#t403">403</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">value</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t404" href="#t404">404</a></span><span class="t">            <span class="key">return</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t405" href="#t405">405</a></span><span class="t">        <span class="key">return</span> <span class="op">[</span><span class="nam">item</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">value</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">","</span><span class="op">)</span> <span class="key">if</span> <span class="nam">item</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t406" href="#t406">406</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t407" href="#t407">407</a></span><span class="t">    <span class="key">def</span> <span class="nam">_run_extract</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">args</span><span class="op">:</span> <span class="nam">Sequence</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t408" href="#t408">408</a></span><span class="t">        <span class="nam">source</span> <span class="op">=</span> <span class="nam">args</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">if</span> <span class="nam">args</span> <span class="key">else</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t409" href="#t409">409</a></span><span class="t">        <span class="nam">output</span> <span class="op">=</span> <span class="nam">args</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">args</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span> <span class="key">else</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t410" href="#t410">410</a></span><span class="t">        <span class="key">if</span> <span class="nam">source</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t411" href="#t411">411</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">set_source_root</span><span class="op">(</span><span class="nam">source</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t412" href="#t412">412</a></span><span class="t">        <span class="key">if</span> <span class="nam">output</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t413" href="#t413">413</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">set_output_path</span><span class="op">(</span><span class="nam">output</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t414" href="#t414">414</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t415" href="#t415">415</a></span><span class="t">        <span class="nam">root</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">source_root</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t416" href="#t416">416</a></span><span class="t">        <span class="nam">destination</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">output_path</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t417" href="#t417">417</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t418" href="#t418">418</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">root</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t419" href="#t419">419</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="str">"[red]&#1059;&#1082;&#1072;&#1078;&#1080;&#1090;&#1077; &#1082;&#1086;&#1088;&#1088;&#1077;&#1082;&#1090;&#1085;&#1099;&#1081; source_path.[/red]"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t420" href="#t420">420</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t421" href="#t421">421</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t422" href="#t422">422</a></span><span class="t">        <span class="nam">extractor</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">create_extractor</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t423" href="#t423">423</a></span><span class="t">        <span class="nam">progress_columns</span> <span class="op">=</span> <span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t424" href="#t424">424</a></span><span class="t">            <span class="nam">SpinnerColumn</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t425" href="#t425">425</a></span><span class="t">            <span class="nam">TextColumn</span><span class="op">(</span><span class="str">"[progress.description]{task.description}"</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t426" href="#t426">426</a></span><span class="t">            <span class="nam">BarColumn</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t427" href="#t427">427</a></span><span class="t">            <span class="nam">TimeElapsedColumn</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t428" href="#t428">428</a></span><span class="t">        <span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t429" href="#t429">429</a></span><span class="t">        <span class="key">with</span> <span class="nam">Progress</span><span class="op">(</span><span class="op">*</span><span class="nam">progress_columns</span><span class="op">,</span> <span class="nam">refresh_per_second</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">console</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">)</span> <span class="key">as</span> <span class="nam">progress</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t430" href="#t430">430</a></span><span class="t">            <span class="nam">task_id</span> <span class="op">=</span> <span class="nam">progress</span><span class="op">.</span><span class="nam">add_task</span><span class="op">(</span><span class="str">"&#1048;&#1079;&#1074;&#1083;&#1077;&#1095;&#1077;&#1085;&#1080;&#1077;..."</span><span class="op">,</span> <span class="nam">start</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t431" href="#t431">431</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t432" href="#t432">432</a></span><span class="t">            <span class="key">def</span> <span class="nam">_callback</span><span class="op">(</span><span class="nam">advance</span><span class="op">:</span> <span class="nam">int</span> <span class="op">=</span> <span class="num">1</span><span class="op">,</span> <span class="nam">description</span><span class="op">:</span> <span class="nam">str</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t433" href="#t433">433</a></span><span class="t">                <span class="nam">desc</span> <span class="op">=</span> <span class="nam">description</span> <span class="key">or</span> <span class="str">"..."</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t434" href="#t434">434</a></span><span class="t">                <span class="key">if</span> <span class="key">not</span> <span class="nam">progress</span><span class="op">.</span><span class="nam">tasks</span><span class="op">[</span><span class="nam">task_id</span><span class="op">]</span><span class="op">.</span><span class="nam">started</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t435" href="#t435">435</a></span><span class="t">                    <span class="nam">progress</span><span class="op">.</span><span class="nam">start_task</span><span class="op">(</span><span class="nam">task_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t436" href="#t436">436</a></span><span class="t">                <span class="nam">progress</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">task_id</span><span class="op">,</span> <span class="nam">advance</span><span class="op">=</span><span class="nam">advance</span><span class="op">,</span> <span class="nam">description</span><span class="op">=</span><span class="nam">desc</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t437" href="#t437">437</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t438" href="#t438">438</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t439" href="#t439">439</a></span><span class="t">                <span class="nam">stats</span> <span class="op">=</span> <span class="nam">extractor</span><span class="op">.</span><span class="nam">extract</span><span class="op">(</span><span class="nam">root</span><span class="op">,</span> <span class="nam">destination</span><span class="op">,</span> <span class="nam">progress_callback</span><span class="op">=</span><span class="nam">_callback</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t440" href="#t440">440</a></span><span class="t">            <span class="key">except</span> <span class="nam">ExtractionError</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t441" href="#t441">441</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]&#1054;&#1096;&#1080;&#1073;&#1082;&#1072; &#1080;&#1079;&#1074;&#1083;&#1077;&#1095;&#1077;&#1085;&#1080;&#1103;:[/red] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t442" href="#t442">442</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t443" href="#t443">443</a></span><span class="t">            <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - defensive</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t444" href="#t444">444</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]&#1053;&#1077;&#1087;&#1088;&#1077;&#1076;&#1074;&#1080;&#1076;&#1077;&#1085;&#1085;&#1072;&#1103; &#1086;&#1096;&#1080;&#1073;&#1082;&#1072;:[/red] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t445" href="#t445">445</a></span><span class="t">                <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t446" href="#t446">446</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t447" href="#t447">447</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">last_stats</span> <span class="op">=</span> <span class="nam">stats</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t448" href="#t448">448</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_build_summary_panel</span><span class="op">(</span><span class="nam">stats</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t449" href="#t449">449</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t450" href="#t450">450</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">_try_copy</span><span class="op">(</span><span class="nam">stats</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t451" href="#t451">451</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t452" href="#t452">452</a></span><span class="t">    <span class="key">def</span> <span class="nam">_build_summary_panel</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">stats</span><span class="op">:</span> <span class="nam">ExtractionStats</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Panel</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t453" href="#t453">453</a></span><span class="t">        <span class="nam">table</span> <span class="op">=</span> <span class="nam">Table</span><span class="op">.</span><span class="nam">grid</span><span class="op">(</span><span class="nam">padding</span><span class="op">=</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t454" href="#t454">454</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_column</span><span class="op">(</span><span class="nam">justify</span><span class="op">=</span><span class="str">"right"</span><span class="op">,</span> <span class="nam">style</span><span class="op">=</span><span class="str">"bold"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t455" href="#t455">455</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_column</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t456" href="#t456">456</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Root"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">root</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t457" href="#t457">457</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Output"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">output</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t458" href="#t458">458</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Files"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">processed_files</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t459" href="#t459">459</a></span><span class="t">        <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Bytes"</span><span class="op">,</span> <span class="nam">str</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">total_bytes</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t460" href="#t460">460</a></span><span class="t">        <span class="key">if</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">token_count</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t461" href="#t461">461</a></span><span class="t">            <span class="nam">token_info</span> <span class="op">=</span> <span class="fst">f"</span><span class="op">{</span><span class="nam">stats</span><span class="op">.</span><span class="nam">token_count</span><span class="op">}</span><span class="fst">"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t462" href="#t462">462</a></span><span class="t">            <span class="key">if</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">token_model</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t463" href="#t463">463</a></span><span class="t">                <span class="nam">token_info</span> <span class="op">+=</span> <span class="fst">f"</span><span class="fst"> (</span><span class="op">{</span><span class="nam">stats</span><span class="op">.</span><span class="nam">token_model</span><span class="op">}</span><span class="fst">)</span><span class="fst">"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t464" href="#t464">464</a></span><span class="t">            <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Tokens"</span><span class="op">,</span> <span class="nam">token_info</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t465" href="#t465">465</a></span><span class="t">        <span class="nam">skipped_summary</span> <span class="op">=</span> <span class="str">", "</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="fst">f"</span><span class="op">{</span><span class="nam">reason</span><span class="op">}</span><span class="fst">: </span><span class="op">{</span><span class="nam">count</span><span class="op">}</span><span class="fst">"</span> <span class="key">for</span> <span class="nam">reason</span><span class="op">,</span> <span class="nam">count</span> <span class="key">in</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">skipped</span><span class="op">.</span><span class="nam">items</span><span class="op">(</span><span class="op">)</span> <span class="key">if</span> <span class="nam">count</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t466" href="#t466">466</a></span><span class="t">        <span class="key">if</span> <span class="nam">skipped_summary</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t467" href="#t467">467</a></span><span class="t">            <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Skipped"</span><span class="op">,</span> <span class="nam">skipped_summary</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t468" href="#t468">468</a></span><span class="t">        <span class="key">if</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">errors</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t469" href="#t469">469</a></span><span class="t">            <span class="nam">table</span><span class="op">.</span><span class="nam">add_row</span><span class="op">(</span><span class="str">"Warnings"</span><span class="op">,</span> <span class="str">" | "</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">errors</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t470" href="#t470">470</a></span><span class="t">        <span class="key">return</span> <span class="nam">Panel</span><span class="op">(</span><span class="nam">table</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">"[bold green]&#1043;&#1086;&#1090;&#1086;&#1074;&#1086;[/bold green]"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"green"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t471" href="#t471">471</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t472" href="#t472">472</a></span><span class="t">    <span class="key">def</span> <span class="nam">_try_copy</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">stats</span><span class="op">:</span> <span class="nam">ExtractionStats</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t473" href="#t473">473</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t474" href="#t474">474</a></span><span class="t">            <span class="key">import</span> <span class="nam">pyperclip</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t475" href="#t475">475</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t476" href="#t476">476</a></span><span class="t">            <span class="nam">contents</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">output</span><span class="op">)</span><span class="op">.</span><span class="nam">read_text</span><span class="op">(</span><span class="nam">encoding</span><span class="op">=</span><span class="str">"utf-8"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t477" href="#t477">477</a></span><span class="t">            <span class="nam">pyperclip</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="nam">contents</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t478" href="#t478">478</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="str">"[green]&#1056;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090; &#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085; &#1074; &#1073;&#1091;&#1092;&#1077;&#1088; &#1086;&#1073;&#1084;&#1077;&#1085;&#1072;.[/green]"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"green"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t479" href="#t479">479</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - platform dependent</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t480" href="#t480">480</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[yellow]&#1053;&#1077; &#1091;&#1076;&#1072;&#1083;&#1086;&#1089;&#1100; &#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;:[/yellow] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"yellow"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t481" href="#t481">481</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t482" href="#t482">482</a></span><span class="t">    <span class="key">def</span> <span class="nam">_save_config_command</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t483" href="#t483">483</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t484" href="#t484">484</a></span><span class="t">            <span class="nam">save_config</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">state</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t485" href="#t485">485</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - persistence is best effort</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t486" href="#t486">486</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]&#1053;&#1077; &#1091;&#1076;&#1072;&#1083;&#1086;&#1089;&#1100; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1100; &#1085;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1080;:[/red] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"red"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t487" href="#t487">487</a></span><span class="t">            <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t488" href="#t488">488</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="nam">Panel</span><span class="op">(</span><span class="str">"[green]&#1053;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1080; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1099;.[/green]"</span><span class="op">,</span> <span class="nam">border_style</span><span class="op">=</span><span class="str">"green"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t489" href="#t489">489</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t490" href="#t490">490</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t491" href="#t491">491</a></span><span class="t"><span class="key">def</span> <span class="nam">run_interactive</span><span class="op">(</span><span class="nam">console</span><span class="op">:</span> <span class="nam">Console</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t492" href="#t492">492</a></span><span class="t">    <span class="str">"""Entry helper used by ``proxtract`` when launched without arguments."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t493" href="#t493">493</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t494" href="#t494">494</a></span><span class="t">    <span class="nam">InteractiveShell</span><span class="op">(</span><span class="nam">console</span><span class="op">=</span><span class="nam">console</span><span class="op">)</span><span class="op">.</span><span class="nam">run</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t495" href="#t495">495</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t496" href="#t496">496</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t497" href="#t497">497</a></span><span class="t"><span class="nam">__all__</span> <span class="op">=</span> <span class="op">[</span><span class="str">"run_interactive"</span><span class="op">,</span> <span class="str">"InteractiveShell"</span><span class="op">,</span> <span class="str">"ProxtractCompleter"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87_core_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87_main_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87_main_py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/main.py: 87%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/main.py</b>:
            <span class="pc_cov">87%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">110 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">96<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">14<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">28<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87_interactive_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87_state_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Entry point for launching the Proxtract CLI and interactive REPL."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">annotations</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">import</span> <span class="nam">argparse</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">import</span> <span class="nam">sys</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="key">from</span> <span class="nam">pathlib</span> <span class="key">import</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t"><span class="key">from</span> <span class="nam">typing</span> <span class="key">import</span> <span class="nam">Optional</span><span class="op">,</span> <span class="nam">Sequence</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">console</span> <span class="key">import</span> <span class="nam">Console</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">interactive</span> <span class="key">import</span> <span class="nam">run_interactive</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">state</span> <span class="key">import</span> <span class="nam">AppState</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">utils</span> <span class="key">import</span> <span class="nam">create_console</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># Shell auto-completion support</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">    <span class="key">import</span> <span class="nam">argcomplete</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t">    <span class="key">from</span> <span class="nam">argcomplete</span><span class="op">.</span><span class="nam">completers</span> <span class="key">import</span> <span class="nam">FilesCompleter</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - degrade gracefully if unavailable</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t">    <span class="nam">argcomplete</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore[assignment]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t">    <span class="nam">FilesCompleter</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore[assignment]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t"><span class="key">try</span><span class="op">:</span>  <span class="com"># Config helpers are optional if tomllib/tomli missing</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t">    <span class="key">from</span> <span class="op">.</span><span class="nam">config</span> <span class="key">import</span> <span class="nam">apply_config</span><span class="op">,</span> <span class="nam">load_config</span><span class="op">,</span> <span class="nam">save_config</span> <span class="key">as</span> <span class="nam">_save_config</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t"><span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>  <span class="com"># pragma: no cover - fallback when persistence unavailable</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t">    <span class="nam">apply_config</span> <span class="op">=</span> <span class="key">lambda</span> <span class="nam">state</span><span class="op">,</span> <span class="nam">data</span><span class="op">:</span> <span class="nam">state</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t">    <span class="nam">load_config</span> <span class="op">=</span> <span class="key">lambda</span><span class="op">:</span> <span class="op">{</span><span class="op">}</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t">    <span class="nam">_save_config</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t"><span class="key">def</span> <span class="nam">_run_cli_extract</span><span class="op">(</span><span class="nam">args</span><span class="op">:</span> <span class="nam">argparse</span><span class="op">.</span><span class="nam">Namespace</span><span class="op">,</span> <span class="nam">console</span><span class="op">:</span> <span class="nam">Console</span><span class="op">)</span> <span class="op">-></span> <span class="nam">int</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t">    <span class="nam">state</span> <span class="op">=</span> <span class="nam">apply_config</span><span class="op">(</span><span class="nam">AppState</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">load_config</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">output</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">set_output_path</span><span class="op">(</span><span class="nam">args</span><span class="op">.</span><span class="nam">output</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">max_size</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">max_size_kb</span> <span class="op">=</span> <span class="nam">args</span><span class="op">.</span><span class="nam">max_size</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">compact</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t">    <span class="key">elif</span> <span class="nam">args</span><span class="op">.</span><span class="nam">no_compact</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">compact_mode</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">skip_empty</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t">    <span class="key">elif</span> <span class="nam">args</span><span class="op">.</span><span class="nam">no_skip_empty</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">skip_empty</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t">    <span class="key">elif</span> <span class="nam">args</span><span class="op">.</span><span class="nam">no_gitignore</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">use_gitignore</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">include_patterns</span> <span class="op">=</span> <span class="op">[</span><span class="nam">str</span><span class="op">(</span><span class="nam">pattern</span><span class="op">)</span> <span class="key">for</span> <span class="nam">pattern</span> <span class="key">in</span> <span class="nam">args</span><span class="op">.</span><span class="nam">include</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">exclude</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">exclude_patterns</span> <span class="op">=</span> <span class="op">[</span><span class="nam">str</span><span class="op">(</span><span class="nam">pattern</span><span class="op">)</span> <span class="key">for</span> <span class="nam">pattern</span> <span class="key">in</span> <span class="nam">args</span><span class="op">.</span><span class="nam">exclude</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">force_include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t">    <span class="key">elif</span> <span class="nam">args</span><span class="op">.</span><span class="nam">no_force_include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">force_include</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">tokenizer_model</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">tokenizer_model</span> <span class="op">=</span> <span class="nam">args</span><span class="op">.</span><span class="nam">tokenizer_model</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">no_token_count</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">enable_token_count</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">copy</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t">        <span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t">    <span class="nam">extractor</span> <span class="op">=</span> <span class="nam">state</span><span class="op">.</span><span class="nam">create_extractor</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">    <span class="nam">root</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">args</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t">    <span class="nam">output</span> <span class="op">=</span> <span class="nam">state</span><span class="op">.</span><span class="nam">output_path</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t">    <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[bold]Extracting[/bold] from [cyan]</span><span class="op">{</span><span class="nam">root</span><span class="op">}</span><span class="fst">[/cyan] to [green]</span><span class="op">{</span><span class="nam">output</span><span class="op">}</span><span class="fst">[/green] ...</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t">    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t">        <span class="nam">stats</span> <span class="op">=</span> <span class="nam">extractor</span><span class="op">.</span><span class="nam">extract</span><span class="op">(</span><span class="nam">root</span><span class="op">,</span> <span class="nam">output</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t">    <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t71" href="#t71">71</a></span><span class="t">        <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[red]Extraction failed:[/red] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t72" href="#t72">72</a></span><span class="t">        <span class="key">return</span> <span class="num">2</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t73" href="#t73">73</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t74" href="#t74">74</a></span><span class="t">    <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t75" href="#t75">75</a></span><span class="t">        <span class="str">"[bold green]Done.[/bold green] "</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t76" href="#t76">76</a></span><span class="t">        <span class="op">+</span> <span class="fst">f"</span><span class="fst">Files: </span><span class="op">{</span><span class="nam">stats</span><span class="op">.</span><span class="nam">processed_files</span><span class="op">}</span><span class="fst">, Size: </span><span class="op">{</span><span class="nam">stats</span><span class="op">.</span><span class="nam">total_bytes</span><span class="op">}</span><span class="fst"> bytes</span><span class="fst">"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t77" href="#t77">77</a></span><span class="t">        <span class="op">+</span> <span class="op">(</span><span class="fst">f"</span><span class="fst">, Tokens: </span><span class="op">{</span><span class="nam">stats</span><span class="op">.</span><span class="nam">token_count</span><span class="op">}</span><span class="fst">"</span> <span class="key">if</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">token_count</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">else</span> <span class="str">""</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t78" href="#t78">78</a></span><span class="t">    <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t79" href="#t79">79</a></span><span class="t">    <span class="key">if</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">errors</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t80" href="#t80">80</a></span><span class="t">        <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[yellow]Warnings (</span><span class="op">{</span><span class="nam">len</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">errors</span><span class="op">)</span><span class="op">}</span><span class="fst">):[/yellow]</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t81" href="#t81">81</a></span><span class="t">        <span class="key">for</span> <span class="nam">warning</span> <span class="key">in</span> <span class="nam">stats</span><span class="op">.</span><span class="nam">errors</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t82" href="#t82">82</a></span><span class="t">            <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="fst">f"</span><span class="fst">  &#8226; </span><span class="op">{</span><span class="nam">warning</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t83" href="#t83">83</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t84" href="#t84">84</a></span><span class="t">    <span class="key">if</span> <span class="nam">state</span><span class="op">.</span><span class="nam">copy_to_clipboard</span> <span class="key">or</span> <span class="nam">args</span><span class="op">.</span><span class="nam">copy</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t85" href="#t85">85</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t86" href="#t86">86</a></span><span class="t">            <span class="key">import</span> <span class="nam">pyperclip</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t87" href="#t87">87</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t88" href="#t88">88</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t89" href="#t89">89</a></span><span class="t">                <span class="nam">contents</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">stats</span><span class="op">.</span><span class="nam">output</span><span class="op">)</span><span class="op">.</span><span class="nam">read_text</span><span class="op">(</span><span class="nam">encoding</span><span class="op">=</span><span class="str">"utf-8"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t90" href="#t90">90</a></span><span class="t">                <span class="nam">pyperclip</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="nam">contents</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t91" href="#t91">91</a></span><span class="t">                <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="str">"[green]Copied extracted content to clipboard.[/green]"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t92" href="#t92">92</a></span><span class="t">            <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - environment specific</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t93" href="#t93">93</a></span><span class="t">                <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[yellow]Failed to copy to clipboard:[/yellow] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t94" href="#t94">94</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t95" href="#t95">95</a></span><span class="t">            <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="str">"[yellow]pyperclip not installed; cannot copy to clipboard.[/yellow]"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t96" href="#t96">96</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t97" href="#t97">97</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">save_config</span> <span class="key">and</span> <span class="nam">_save_config</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t98" href="#t98">98</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t99" href="#t99">99</a></span><span class="t">            <span class="nam">_save_config</span><span class="op">(</span><span class="nam">state</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t100" href="#t100">100</a></span><span class="t">            <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="str">"[green]Settings saved.[/green]"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t101" href="#t101">101</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">exc</span><span class="op">:</span>  <span class="com"># pragma: no cover - persistence is best-effort</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t102" href="#t102">102</a></span><span class="t">            <span class="nam">console</span><span class="op">.</span><span class="nam">print</span><span class="op">(</span><span class="fst">f"</span><span class="fst">[yellow]Failed to save settings:[/yellow] </span><span class="op">{</span><span class="nam">exc</span><span class="op">}</span><span class="fst">"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t103" href="#t103">103</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t104" href="#t104">104</a></span><span class="t">    <span class="key">return</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t105" href="#t105">105</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t106" href="#t106">106</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t107" href="#t107">107</a></span><span class="t"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="nam">argv</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Sequence</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t108" href="#t108">108</a></span><span class="t">    <span class="nam">program_name</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">.</span><span class="nam">name</span> <span class="key">or</span> <span class="str">"proxtract"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t109" href="#t109">109</a></span><span class="t">    <span class="nam">parser</span> <span class="op">=</span> <span class="nam">argparse</span><span class="op">.</span><span class="nam">ArgumentParser</span><span class="op">(</span><span class="nam">prog</span><span class="op">=</span><span class="nam">program_name</span><span class="op">,</span> <span class="nam">allow_abbrev</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t110" href="#t110">110</a></span><span class="t">    <span class="nam">subparsers</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">add_subparsers</span><span class="op">(</span><span class="nam">dest</span><span class="op">=</span><span class="str">"command"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t111" href="#t111">111</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t112" href="#t112">112</a></span><span class="t">    <span class="nam">p_extract</span> <span class="op">=</span> <span class="nam">subparsers</span><span class="op">.</span><span class="nam">add_parser</span><span class="op">(</span><span class="str">"extract"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Run a one-off extraction"</span><span class="op">,</span> <span class="nam">aliases</span><span class="op">=</span><span class="op">[</span><span class="str">"e"</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t113" href="#t113">113</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">set_defaults</span><span class="op">(</span><span class="nam">command</span><span class="op">=</span><span class="str">"extract"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t114" href="#t114">114</a></span><span class="t">    <span class="nam">path_argument</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"path"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Root directory to extract"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t115" href="#t115">115</a></span><span class="t">    <span class="nam">output_argument</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--output"</span><span class="op">,</span> <span class="str">"-o"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Output file path"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t116" href="#t116">116</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--max-size"</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Maximum file size in KB"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t117" href="#t117">117</a></span><span class="t">    <span class="nam">group_compact</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_mutually_exclusive_group</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t118" href="#t118">118</a></span><span class="t">    <span class="nam">group_compact</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--compact"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Enable compact formatting"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t119" href="#t119">119</a></span><span class="t">    <span class="nam">group_compact</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--no-compact"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Disable compact formatting"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t120" href="#t120">120</a></span><span class="t">    <span class="nam">group_empty</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_mutually_exclusive_group</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t121" href="#t121">121</a></span><span class="t">    <span class="nam">group_empty</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--skip-empty"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Skip empty files"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t122" href="#t122">122</a></span><span class="t">    <span class="nam">group_empty</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--no-skip-empty"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Do not skip empty files"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t123" href="#t123">123</a></span><span class="t">    <span class="nam">group_gitignore</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_mutually_exclusive_group</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t124" href="#t124">124</a></span><span class="t">    <span class="nam">group_gitignore</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--use-gitignore"</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">"use_gitignore"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Respect .gitignore rules"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t125" href="#t125">125</a></span><span class="t">    <span class="nam">group_gitignore</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--no-gitignore"</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">"no_gitignore"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Ignore .gitignore rules"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t126" href="#t126">126</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--include"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"append"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Include glob pattern (repeatable)"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t127" href="#t127">127</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--exclude"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"append"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Exclude glob pattern (repeatable)"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t128" href="#t128">128</a></span><span class="t">    <span class="nam">group_force</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_mutually_exclusive_group</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t129" href="#t129">129</a></span><span class="t">    <span class="nam">group_force</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t130" href="#t130">130</a></span><span class="t">        <span class="str">"--force-include"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t131" href="#t131">131</a></span><span class="t">        <span class="nam">dest</span><span class="op">=</span><span class="str">"force_include"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t132" href="#t132">132</a></span><span class="t">        <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t133" href="#t133">133</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Allow include patterns to bypass exclude rules and .gitignore"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t134" href="#t134">134</a></span><span class="t">    <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t135" href="#t135">135</a></span><span class="t">    <span class="nam">group_force</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t136" href="#t136">136</a></span><span class="t">        <span class="str">"--no-force-include"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t137" href="#t137">137</a></span><span class="t">        <span class="nam">dest</span><span class="op">=</span><span class="str">"no_force_include"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t138" href="#t138">138</a></span><span class="t">        <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t139" href="#t139">139</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Do not allow include patterns to bypass exclude rules"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t140" href="#t140">140</a></span><span class="t">    <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t141" href="#t141">141</a></span><span class="t">    <span class="nam">tokenizer_argument</span> <span class="op">=</span> <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--tokenizer-model"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Tokenizer model for token counting"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t142" href="#t142">142</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--no-token-count"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Disable token counting"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t143" href="#t143">143</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--copy"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Copy result to clipboard"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t144" href="#t144">144</a></span><span class="t">    <span class="nam">p_extract</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">"--save-config"</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">"store_true"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Persist current settings"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t145" href="#t145">145</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t146" href="#t146">146</a></span><span class="t">    <span class="nam">args_list</span> <span class="op">=</span> <span class="nam">list</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span> <span class="key">if</span> <span class="nam">argv</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">argv</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t147" href="#t147">147</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t148" href="#t148">148</a></span><span class="t">    <span class="key">if</span> <span class="nam">FilesCompleter</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>  <span class="com"># pragma: no cover - requires argcomplete at runtime</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t149" href="#t149">149</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t150" href="#t150">150</a></span><span class="t">            <span class="nam">path_argument</span><span class="op">.</span><span class="nam">completer</span> <span class="op">=</span> <span class="nam">FilesCompleter</span><span class="op">(</span><span class="nam">directories</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>  <span class="com"># type: ignore[attr-defined]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t151" href="#t151">151</a></span><span class="t">            <span class="nam">output_argument</span><span class="op">.</span><span class="nam">completer</span> <span class="op">=</span> <span class="nam">FilesCompleter</span><span class="op">(</span><span class="op">)</span>  <span class="com"># type: ignore[attr-defined]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t152" href="#t152">152</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t153" href="#t153">153</a></span><span class="t">            <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t154" href="#t154">154</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t155" href="#t155">155</a></span><span class="t">    <span class="key">if</span> <span class="nam">argv</span> <span class="key">is</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">argcomplete</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>  <span class="com"># pragma: no cover - requires argcomplete at runtime</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t156" href="#t156">156</a></span><span class="t">        <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t157" href="#t157">157</a></span><span class="t">            <span class="key">from</span> <span class="nam">argcomplete</span><span class="op">.</span><span class="nam">completers</span> <span class="key">import</span> <span class="nam">ChoicesCompleter</span>  <span class="com"># type: ignore</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t158" href="#t158">158</a></span><span class="t">        <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t159" href="#t159">159</a></span><span class="t">            <span class="nam">ChoicesCompleter</span> <span class="op">=</span> <span class="key">None</span>  <span class="com"># type: ignore[assignment]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t160" href="#t160">160</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t161" href="#t161">161</a></span><span class="t">            <span class="nam">token_models</span> <span class="op">=</span> <span class="op">[</span><span class="str">"gpt-4o-mini"</span><span class="op">,</span> <span class="str">"gpt-4o"</span><span class="op">,</span> <span class="str">"gpt-3.5-turbo"</span><span class="op">,</span> <span class="str">"o200k_base"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t162" href="#t162">162</a></span><span class="t">            <span class="nam">tokenizer_argument</span><span class="op">.</span><span class="nam">completer</span> <span class="op">=</span> <span class="nam">ChoicesCompleter</span><span class="op">(</span><span class="nam">token_models</span><span class="op">)</span>  <span class="com"># type: ignore[attr-defined]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t163" href="#t163">163</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t164" href="#t164">164</a></span><span class="t">        <span class="nam">argcomplete</span><span class="op">.</span><span class="nam">autocomplete</span><span class="op">(</span><span class="nam">parser</span><span class="op">)</span>  <span class="com"># type: ignore[call-arg]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t165" href="#t165">165</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t166" href="#t166">166</a></span><span class="t">    <span class="nam">shared_console</span> <span class="op">=</span> <span class="nam">create_console</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t167" href="#t167">167</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t168" href="#t168">168</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">args_list</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t169" href="#t169">169</a></span><span class="t">        <span class="nam">run_interactive</span><span class="op">(</span><span class="nam">shared_console</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t170" href="#t170">170</a></span><span class="t">        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t171" href="#t171">171</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t172" href="#t172">172</a></span><span class="t">    <span class="nam">args</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">parse_args</span><span class="op">(</span><span class="nam">args_list</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t173" href="#t173">173</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t174" href="#t174">174</a></span><span class="t">    <span class="key">if</span> <span class="nam">args</span><span class="op">.</span><span class="nam">command</span> <span class="op">==</span> <span class="str">"extract"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t175" href="#t175">175</a></span><span class="t">        <span class="key">raise</span> <span class="nam">SystemExit</span><span class="op">(</span><span class="nam">_run_cli_extract</span><span class="op">(</span><span class="nam">args</span><span class="op">,</span> <span class="nam">create_console</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t176" href="#t176">176</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t177" href="#t177">177</a></span><span class="t">    <span class="nam">run_interactive</span><span class="op">(</span><span class="nam">shared_console</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t178" href="#t178">178</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t179" href="#t179">179</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t180" href="#t180">180</a></span><span class="t"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">"__main__"</span><span class="op">:</span>  <span class="com"># pragma: no cover</span>&nbsp;</span><span class="r"></span></p>
    <p class="exc show_exc"><span class="n"><a id="t181" href="#t181">181</a></span><span class="t">    <span class="nam">main</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87_interactive_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87_state_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87_state_py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/state.py: 86%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/state.py</b>:
            <span class="pc_cov">86%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">35 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">30<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">5<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">0<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87_main_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="z_89a6376cf0395b87_utils_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 22:59 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Session state management for the Proxtract TUI and CLI."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">annotations</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">from</span> <span class="nam">dataclasses</span> <span class="key">import</span> <span class="nam">dataclass</span><span class="op">,</span> <span class="nam">field</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">from</span> <span class="nam">pathlib</span> <span class="key">import</span> <span class="nam">Path</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="key">from</span> <span class="nam">typing</span> <span class="key">import</span> <span class="nam">Optional</span><span class="op">,</span> <span class="nam">Sequence</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t"><span class="key">from</span> <span class="op">.</span><span class="nam">core</span> <span class="key">import</span> <span class="nam">ExtractionStats</span><span class="op">,</span> <span class="nam">FileExtractor</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t"><span class="op">@</span><span class="nam">dataclass</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t"><span class="key">class</span> <span class="nam">AppState</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t">    <span class="str">"""Mutable configuration shared across TUI widgets and CLI commands."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t">    <span class="nam">source_root</span><span class="op">:</span> <span class="nam">Path</span> <span class="op">=</span> <span class="nam">field</span><span class="op">(</span><span class="nam">default_factory</span><span class="op">=</span><span class="key">lambda</span><span class="op">:</span> <span class="nam">Path</span><span class="op">.</span><span class="nam">cwd</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">    <span class="nam">output_path</span><span class="op">:</span> <span class="nam">Path</span> <span class="op">=</span> <span class="nam">field</span><span class="op">(</span><span class="nam">default_factory</span><span class="op">=</span><span class="key">lambda</span><span class="op">:</span> <span class="nam">Path</span><span class="op">(</span><span class="str">"extracted.txt"</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t">    <span class="nam">max_size_kb</span><span class="op">:</span> <span class="nam">int</span> <span class="op">=</span> <span class="num">500</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t">    <span class="nam">compact_mode</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t">    <span class="nam">skip_empty</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t">    <span class="nam">use_gitignore</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t">    <span class="nam">include_patterns</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="nam">field</span><span class="op">(</span><span class="nam">default_factory</span><span class="op">=</span><span class="nam">list</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t">    <span class="nam">exclude_patterns</span><span class="op">:</span> <span class="nam">list</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">=</span> <span class="nam">field</span><span class="op">(</span><span class="nam">default_factory</span><span class="op">=</span><span class="nam">list</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t">    <span class="nam">force_include</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t">    <span class="com"># Filtering rules - configurable via settings.toml</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t">    <span class="nam">skip_extensions</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">set</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t">    <span class="nam">skip_patterns</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">set</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t">    <span class="nam">skip_files</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">set</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t">    <span class="nam">tokenizer_model</span><span class="op">:</span> <span class="nam">str</span> <span class="op">=</span> <span class="str">"gpt-4"</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t">    <span class="nam">enable_token_count</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t">    <span class="nam">copy_to_clipboard</span><span class="op">:</span> <span class="nam">bool</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t">    <span class="nam">last_stats</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">ExtractionStats</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">    <span class="key">def</span> <span class="nam">create_extractor</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">-></span> <span class="nam">FileExtractor</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t">        <span class="str">"""Instantiate a ``FileExtractor`` with the current settings."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t">        <span class="key">return</span> <span class="nam">FileExtractor</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t">            <span class="nam">max_file_size_kb</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">max_size_kb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t">            <span class="nam">skip_empty</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">skip_empty</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t">            <span class="nam">compact_mode</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">compact_mode</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t">            <span class="nam">use_gitignore</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">use_gitignore</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t">            <span class="nam">include_patterns</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t">            <span class="nam">exclude_patterns</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">exclude_patterns</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t">            <span class="nam">force_include</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">force_include</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t">            <span class="nam">tokenizer_model</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">tokenizer_model</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t">            <span class="nam">count_tokens</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">enable_token_count</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t">            <span class="nam">skip_extensions</span><span class="op">=</span><span class="key">None</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_extensions</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">set</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">skip_extensions</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t">            <span class="nam">skip_patterns</span><span class="op">=</span><span class="key">None</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_patterns</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">set</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">skip_patterns</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t">            <span class="nam">skip_files</span><span class="op">=</span><span class="key">None</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">skip_files</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">set</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">skip_files</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t">    <span class="key">def</span> <span class="nam">set_output_path</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">path</span><span class="op">:</span> <span class="nam">str</span> <span class="op">|</span> <span class="nam">Path</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">output_path</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">path</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">    <span class="key">def</span> <span class="nam">set_source_root</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">path</span><span class="op">:</span> <span class="nam">str</span> <span class="op">|</span> <span class="nam">Path</span><span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">source_root</span> <span class="op">=</span> <span class="nam">Path</span><span class="op">(</span><span class="nam">path</span><span class="op">)</span><span class="op">.</span><span class="nam">expanduser</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t">    <span class="key">def</span> <span class="nam">set_patterns</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">        <span class="op">*</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t">        <span class="nam">include</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Sequence</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">        <span class="nam">exclude</span><span class="op">:</span> <span class="nam">Optional</span><span class="op">[</span><span class="nam">Sequence</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p class="run run2"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t">    <span class="op">)</span> <span class="op">-></span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">        <span class="key">if</span> <span class="nam">include</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">include_patterns</span> <span class="op">=</span> <span class="op">[</span><span class="nam">str</span><span class="op">(</span><span class="nam">p</span><span class="op">)</span> <span class="key">for</span> <span class="nam">p</span> <span class="key">in</span> <span class="nam">include</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">        <span class="key">if</span> <span class="nam">exclude</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">exclude_patterns</span> <span class="op">=</span> <span class="op">[</span><span class="nam">str</span><span class="op">(</span><span class="nam">p</span><span class="op">)</span> <span class="key">for</span> <span class="nam">p</span> <span class="key">in</span> <span class="nam">exclude</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t"><span class="nam">__all__</span> <span class="op">=</span> <span class="op">[</span><span class="str">"AppState"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87_main_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="z_89a6376cf0395b87_utils_py.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 22:59 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- htmlcov/z_89a6376cf0395b87_utils_py.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Coverage for src/proxtract/utils.py: 88%</title>
    <link rel="icon" sizes="32x32" href="favicon_32_cb_58284776.png">
    <link rel="stylesheet" href="style_cb_6b508a39.css" type="text/css">
    <script src="coverage_html_cb_6fb7b396.js" defer></script>
</head>
<body class="pyfile">
<header>
    <div class="content">
        <h1>
            <span class="text">Coverage for </span><b>src/proxtract/utils.py</b>:
            <span class="pc_cov">88%</span>
        </h1>
        <aside id="help_panel_wrapper">
            <input id="help_panel_state" type="checkbox">
            <label for="help_panel_state">
                <img id="keyboard_icon" src="keybd_closed_cb_ce680311.png" alt="Show/hide keyboard shortcuts">
            </label>
            <div id="help_panel">
                <p class="legend">Shortcuts on this page</p>
                <div class="keyhelp">
                    <p>
                        <kbd>r</kbd>
                        <kbd>m</kbd>
                        <kbd>x</kbd>
                        &nbsp; toggle line displays
                    </p>
                    <p>
                        <kbd>j</kbd>
                        <kbd>k</kbd>
                        &nbsp; next/prev highlighted chunk
                    </p>
                    <p>
                        <kbd>0</kbd> &nbsp; (zero) top of page
                    </p>
                    <p>
                        <kbd>1</kbd> &nbsp; (one) first highlighted chunk
                    </p>
                    <p>
                        <kbd>[</kbd>
                        <kbd>]</kbd>
                        &nbsp; prev/next file
                    </p>
                    <p>
                        <kbd>u</kbd> &nbsp; up to the index
                    </p>
                    <p>
                        <kbd>?</kbd> &nbsp; show/hide this help
                    </p>
                </div>
            </div>
        </aside>
        <h2>
            <span class="text">67 statements &nbsp;</span>
            <button type="button" class="run button_toggle_run" value="run" data-shortcut="r" title="Toggle lines run">59<span class="text"> run</span></button>
            <button type="button" class="mis show_mis button_toggle_mis" value="mis" data-shortcut="m" title="Toggle lines missing">8<span class="text"> missing</span></button>
            <button type="button" class="exc show_exc button_toggle_exc" value="exc" data-shortcut="x" title="Toggle lines excluded">0<span class="text"> excluded</span></button>
        </h2>
        <p class="text">
            <a id="prevFileLink" class="nav" href="z_89a6376cf0395b87_state_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a id="indexLink" class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a id="nextFileLink" class="nav" href="index.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
        <aside class="hidden">
            <button type="button" class="button_next_chunk" data-shortcut="j"></button>
            <button type="button" class="button_prev_chunk" data-shortcut="k"></button>
            <button type="button" class="button_top_of_page" data-shortcut="0"></button>
            <button type="button" class="button_first_chunk" data-shortcut="1"></button>
            <button type="button" class="button_prev_file" data-shortcut="["></button>
            <button type="button" class="button_next_file" data-shortcut="]"></button>
            <button type="button" class="button_to_index" data-shortcut="u"></button>
            <button type="button" class="button_show_hide_help" data-shortcut="?"></button>
        </aside>
    </div>
</header>
<main id="source">
    <p class="pln"><span class="n"><a id="t1" href="#t1">1</a></span><span class="t"><span class="str">"""Shared utility helpers for Proxtract."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t2" href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t3" href="#t3">3</a></span><span class="t"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">annotations</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t4" href="#t4">4</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t5" href="#t5">5</a></span><span class="t"><span class="key">import</span> <span class="nam">os</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t6" href="#t6">6</a></span><span class="t"><span class="key">import</span> <span class="nam">sys</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t7" href="#t7">7</a></span><span class="t"><span class="key">from</span> <span class="nam">typing</span> <span class="key">import</span> <span class="nam">Any</span><span class="op">,</span> <span class="nam">IO</span><span class="op">,</span> <span class="nam">Iterable</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t8" href="#t8">8</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t9" href="#t9">9</a></span><span class="t"><span class="key">from</span> <span class="nam">rich</span><span class="op">.</span><span class="nam">console</span> <span class="key">import</span> <span class="nam">Console</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t10" href="#t10">10</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t11" href="#t11">11</a></span><span class="t"><span class="nam">_TRUE_WORDS</span> <span class="op">=</span> <span class="op">{</span><span class="str">"1"</span><span class="op">,</span> <span class="str">"true"</span><span class="op">,</span> <span class="str">"yes"</span><span class="op">,</span> <span class="str">"on"</span><span class="op">,</span> <span class="str">"y"</span><span class="op">,</span> <span class="str">"t"</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t12" href="#t12">12</a></span><span class="t"><span class="nam">_FALSE_WORDS</span> <span class="op">=</span> <span class="op">{</span><span class="str">"0"</span><span class="op">,</span> <span class="str">"false"</span><span class="op">,</span> <span class="str">"no"</span><span class="op">,</span> <span class="str">"off"</span><span class="op">,</span> <span class="str">"n"</span><span class="op">,</span> <span class="str">"f"</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t13" href="#t13">13</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t14" href="#t14">14</a></span><span class="t"><span class="nam">_ENV_TRUE</span> <span class="op">=</span> <span class="op">{</span><span class="str">"1"</span><span class="op">,</span> <span class="str">"true"</span><span class="op">,</span> <span class="str">"yes"</span><span class="op">,</span> <span class="str">"on"</span><span class="op">,</span> <span class="str">"enable"</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t15" href="#t15">15</a></span><span class="t"><span class="nam">_ENV_FALSE</span> <span class="op">=</span> <span class="op">{</span><span class="str">"0"</span><span class="op">,</span> <span class="str">"false"</span><span class="op">,</span> <span class="str">"no"</span><span class="op">,</span> <span class="str">"off"</span><span class="op">,</span> <span class="str">""</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t16" href="#t16">16</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t17" href="#t17">17</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t18" href="#t18">18</a></span><span class="t"><span class="key">def</span> <span class="nam">normalize_bool</span><span class="op">(</span><span class="nam">value</span><span class="op">:</span> <span class="nam">Any</span><span class="op">,</span> <span class="nam">default</span><span class="op">:</span> <span class="nam">bool</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t19" href="#t19">19</a></span><span class="t">    <span class="str">"""Return a normalized boolean value from arbitrary input.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t20" href="#t20">20</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t21" href="#t21">21</a></span><span class="t"><span class="str">    Args:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t22" href="#t22">22</a></span><span class="t"><span class="str">        value: Incoming configuration value (string, number, bool, etc.).</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t23" href="#t23">23</a></span><span class="t"><span class="str">        default: Fallback value when ``value`` cannot be interpreted.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t24" href="#t24">24</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t25" href="#t25">25</a></span><span class="t"><span class="str">    Returns:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t26" href="#t26">26</a></span><span class="t"><span class="str">        ``True`` or ``False`` based on ``value`` or ``default`` if parsing fails.</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t27" href="#t27">27</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t28" href="#t28">28</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t29" href="#t29">29</a></span><span class="t">    <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="nam">bool</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t30" href="#t30">30</a></span><span class="t">        <span class="key">return</span> <span class="nam">value</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t31" href="#t31">31</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t32" href="#t32">32</a></span><span class="t">    <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="op">(</span><span class="nam">int</span><span class="op">,</span> <span class="nam">float</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t33" href="#t33">33</a></span><span class="t">        <span class="key">if</span> <span class="nam">value</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t34" href="#t34">34</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t35" href="#t35">35</a></span><span class="t">        <span class="key">if</span> <span class="nam">value</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t36" href="#t36">36</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t37" href="#t37">37</a></span><span class="t">        <span class="key">return</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t38" href="#t38">38</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t39" href="#t39">39</a></span><span class="t">    <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">value</span><span class="op">,</span> <span class="nam">str</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t40" href="#t40">40</a></span><span class="t">        <span class="nam">normalized</span> <span class="op">=</span> <span class="nam">value</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t41" href="#t41">41</a></span><span class="t">        <span class="key">if</span> <span class="nam">normalized</span> <span class="key">in</span> <span class="nam">_TRUE_WORDS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t42" href="#t42">42</a></span><span class="t">            <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t43" href="#t43">43</a></span><span class="t">        <span class="key">if</span> <span class="nam">normalized</span> <span class="key">in</span> <span class="nam">_FALSE_WORDS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t44" href="#t44">44</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t45" href="#t45">45</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t46" href="#t46">46</a></span><span class="t">    <span class="key">return</span> <span class="nam">default</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t47" href="#t47">47</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t48" href="#t48">48</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t49" href="#t49">49</a></span><span class="t"><span class="key">def</span> <span class="nam">_env_flag</span><span class="op">(</span><span class="nam">name</span><span class="op">:</span> <span class="nam">str</span><span class="op">,</span> <span class="nam">truthy</span><span class="op">:</span> <span class="nam">Iterable</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t50" href="#t50">50</a></span><span class="t">    <span class="str">"""Return True when env var ``name`` is set to a truthy value."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t51" href="#t51">51</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t52" href="#t52">52</a></span><span class="t">    <span class="nam">value</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t53" href="#t53">53</a></span><span class="t">    <span class="key">if</span> <span class="nam">value</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t54" href="#t54">54</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t55" href="#t55">55</a></span><span class="t">    <span class="nam">normalized</span> <span class="op">=</span> <span class="nam">value</span><span class="op">.</span><span class="nam">strip</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t56" href="#t56">56</a></span><span class="t">    <span class="nam">truthy_values</span> <span class="op">=</span> <span class="nam">_ENV_TRUE</span> <span class="key">if</span> <span class="nam">truthy</span> <span class="key">is</span> <span class="key">None</span> <span class="key">else</span> <span class="nam">set</span><span class="op">(</span><span class="nam">truthy</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t57" href="#t57">57</a></span><span class="t">    <span class="nam">falsy_values</span> <span class="op">=</span> <span class="nam">_ENV_FALSE</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t58" href="#t58">58</a></span><span class="t">    <span class="key">if</span> <span class="nam">normalized</span> <span class="key">in</span> <span class="nam">truthy_values</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t59" href="#t59">59</a></span><span class="t">        <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t60" href="#t60">60</a></span><span class="t">    <span class="key">if</span> <span class="nam">normalized</span> <span class="key">in</span> <span class="nam">falsy_values</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t61" href="#t61">61</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t62" href="#t62">62</a></span><span class="t">    <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t63" href="#t63">63</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t64" href="#t64">64</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t65" href="#t65">65</a></span><span class="t"><span class="key">def</span> <span class="nam">supports_color</span><span class="op">(</span><span class="nam">stream</span><span class="op">:</span> <span class="nam">IO</span><span class="op">[</span><span class="nam">str</span><span class="op">]</span> <span class="op">|</span> <span class="key">None</span> <span class="op">=</span> <span class="key">None</span><span class="op">)</span> <span class="op">-></span> <span class="nam">bool</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t66" href="#t66">66</a></span><span class="t">    <span class="str">"""Best-effort check for ANSI color support."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t67" href="#t67">67</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t68" href="#t68">68</a></span><span class="t">    <span class="key">if</span> <span class="nam">_env_flag</span><span class="op">(</span><span class="str">"PROXTRACT_FORCE_COLOR"</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t69" href="#t69">69</a></span><span class="t">        <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t70" href="#t70">70</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t71" href="#t71">71</a></span><span class="t">    <span class="key">if</span> <span class="nam">_env_flag</span><span class="op">(</span><span class="str">"PROXTRACT_NO_COLOR"</span><span class="op">)</span> <span class="key">or</span> <span class="nam">_env_flag</span><span class="op">(</span><span class="str">"NO_COLOR"</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t72" href="#t72">72</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t73" href="#t73">73</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t74" href="#t74">74</a></span><span class="t">    <span class="key">if</span> <span class="nam">stream</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t75" href="#t75">75</a></span><span class="t">        <span class="nam">stream</span> <span class="op">=</span> <span class="nam">sys</span><span class="op">.</span><span class="nam">stdout</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t76" href="#t76">76</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t77" href="#t77">77</a></span><span class="t">    <span class="nam">isatty</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">stream</span><span class="op">,</span> <span class="str">"isatty"</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t78" href="#t78">78</a></span><span class="t">    <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t79" href="#t79">79</a></span><span class="t">        <span class="key">if</span> <span class="nam">isatty</span> <span class="key">is</span> <span class="key">None</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">isatty</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t80" href="#t80">80</a></span><span class="t">            <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t81" href="#t81">81</a></span><span class="t">    <span class="key">except</span> <span class="nam">Exception</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t82" href="#t82">82</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t83" href="#t83">83</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t84" href="#t84">84</a></span><span class="t">    <span class="key">if</span> <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"PYCHARM_HOSTED"</span><span class="op">)</span> <span class="op">==</span> <span class="str">"1"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t85" href="#t85">85</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t86" href="#t86">86</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t87" href="#t87">87</a></span><span class="t">    <span class="nam">term</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"TERM"</span><span class="op">,</span> <span class="str">""</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t88" href="#t88">88</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">term</span> <span class="key">or</span> <span class="nam">term</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="str">"dumb"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t89" href="#t89">89</a></span><span class="t">        <span class="key">return</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t90" href="#t90">90</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t91" href="#t91">91</a></span><span class="t">    <span class="key">if</span> <span class="nam">sys</span><span class="op">.</span><span class="nam">platform</span> <span class="op">==</span> <span class="str">"win32"</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis show_mis"><span class="n"><a id="t92" href="#t92">92</a></span><span class="t">        <span class="key">return</span> <span class="nam">bool</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t93" href="#t93">93</a></span><span class="t">            <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"WT_SESSION"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t94" href="#t94">94</a></span><span class="t">            <span class="key">or</span> <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"ANSICON"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t95" href="#t95">95</a></span><span class="t">            <span class="key">or</span> <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"ConEmuANSI"</span><span class="op">)</span> <span class="op">==</span> <span class="str">"ON"</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t96" href="#t96">96</a></span><span class="t">            <span class="key">or</span> <span class="nam">os</span><span class="op">.</span><span class="nam">environ</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"TERM_PROGRAM"</span><span class="op">)</span> <span class="op">==</span> <span class="str">"vscode"</span>&nbsp;</span><span class="r"></span></p>
    <p class="mis mis2 show_mis"><span class="n"><a id="t97" href="#t97">97</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t98" href="#t98">98</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t99" href="#t99">99</a></span><span class="t">    <span class="key">return</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t100" href="#t100">100</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t101" href="#t101">101</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t102" href="#t102">102</a></span><span class="t"><span class="key">def</span> <span class="nam">create_console</span><span class="op">(</span><span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span> <span class="op">-></span> <span class="nam">Console</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t103" href="#t103">103</a></span><span class="t">    <span class="str">"""Return a Rich console tuned for the current environment."""</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t104" href="#t104">104</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t105" href="#t105">105</a></span><span class="t">    <span class="nam">stream</span> <span class="op">=</span> <span class="nam">kwargs</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"file"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t106" href="#t106">106</a></span><span class="t">    <span class="nam">color_enabled</span> <span class="op">=</span> <span class="nam">supports_color</span><span class="op">(</span><span class="nam">stream</span> <span class="key">if</span> <span class="nam">stream</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">else</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t107" href="#t107">107</a></span><span class="t">    <span class="nam">options</span> <span class="op">=</span> <span class="nam">dict</span><span class="op">(</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t108" href="#t108">108</a></span><span class="t">    <span class="nam">options</span><span class="op">.</span><span class="nam">setdefault</span><span class="op">(</span><span class="str">"force_terminal"</span><span class="op">,</span> <span class="nam">color_enabled</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t109" href="#t109">109</a></span><span class="t">    <span class="key">if</span> <span class="key">not</span> <span class="nam">color_enabled</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t110" href="#t110">110</a></span><span class="t">        <span class="nam">options</span><span class="op">.</span><span class="nam">setdefault</span><span class="op">(</span><span class="str">"no_color"</span><span class="op">,</span> <span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t111" href="#t111">111</a></span><span class="t">    <span class="key">return</span> <span class="nam">Console</span><span class="op">(</span><span class="op">**</span><span class="nam">options</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t112" href="#t112">112</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="pln"><span class="n"><a id="t113" href="#t113">113</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p class="run"><span class="n"><a id="t114" href="#t114">114</a></span><span class="t"><span class="nam">__all__</span> <span class="op">=</span> <span class="op">[</span><span class="str">"normalize_bool"</span><span class="op">,</span> <span class="str">"supports_color"</span><span class="op">,</span> <span class="str">"create_console"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
</main>
<footer>
    <div class="content">
        <p>
            <a class="nav" href="z_89a6376cf0395b87_state_py.html">&#xab; prev</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&Hat; index</a> &nbsp; &nbsp;
            <a class="nav" href="index.html">&#xbb; next</a>
            &nbsp; &nbsp; &nbsp;
            <a class="nav" href="https://coverage.readthedocs.io/en/7.11.0">coverage.py v7.11.0</a>,
            created at 2025-11-07 23:16 +0300
        </p>
    </div>
</footer>
</body>
</html>


--- plan.md ---
   

1.      .  safe_bool  bool(value),    "false"   True.         settings.toml  UI. :   compact_mode/skip_empty/use_gitignore. :   {"1","true","yes","on"}  True, {"0","false","no","off"}  False;  default  None/ . 

2.    TOML  stdlib tomllib.  save_config  Python 3.11+ tomllib has dump(s) : tomllib readonly    dump/dumps.         . :   tomliw  ,       TOML     fallback      tomllib. 

3.      (skip_*).  FileExtractor   if skip_extensions else default,     AppState     ,     .   skip_patterns/skip_files. :       . :  None   ,      .  

4.      .  extract()  open(output_path, "w"),  mkdir(parents=True).      OSError. :    output_path.parent.         rename. 

5.  .  TUI total      rglob(*),         (    ).           100%.    : )       (visited),  )          total.  

6.  include/exclude . exclude_patterns  .gitignore   include_override; , include      .     include ,        force_include. : exclude  gitignore  not_included  skip_*  /. 

7.       .  binary_signatures  PK\x03\x04   (zip/docx),   ,      ;  "SQLite"  , RIFF    webp.  :    (nullbytes,  ),  mimes (mimetypes)    zip/pdf/png/jpg;   pythonmagic  . 

8.         . _read_file_content  "[ERROR: Could not decode file]"      bundle.    stats.errors/ skipped    . 

9.   . rglob()   ; is_file()  True    .          root. :   skip  is_symlink(),   allow_symlinks  . 

10.   .  pyproject  --cov-fail-under=80,  coverage.xml     hits="0".    CI   quality.   ,      .  

 UX/UI,   

1.  Source Directory   parent  output_path,    :   cwd   root. :  =   ;    root. 

2.     : ,      . :      (Root, Output)    Extract.   Summary    /. 

3.      .     10+ .   (Output, Max size, .gitignore)   (include/exclude, token count, tokenizer, clipboard)  collapsible    . 

4.      total=100,     .   total   indeterminate    total. 

5.     TUI    ,         .   Retry,      errors. 

6.       dismiss ,           UI.    dismiss       Copy  Summary. 

7.   Include/Exclude Patterns  comma separated,   ,     .    : "src/**, *.md". 

8. Summary  Bytes  .   (KB/MB)   3    ,   . 

       ( )

 1     

1.     :     True/False.   apply_config   UI  .  :  "false"/"no"/"0"   ;    .  
2.   :   tomllib  ;  tomliw,   fallback  . : save_config      tomliw    TOML. 
3.   skip_*: None  ,     .   AppState  create_extractor  FileExtractor.**init**. :  skip_*   .  
4.       : mkdir(parents=True, exist_ok=True),      rename;  .tmp . :            . 
5.   :  total     (visited)           ;   indeterminate    total. :    100%.  
6.   :    force include, include  exclude/.gitignore.    . :    include  exclude. 

 2   UI

1.  Extract:      (Root, Output)   Extract.     ;   Summary    /. :      . 
2.  Root = cwd;    Root  /. :       . 
3.  :       (collapsible  ). :   3 ;     . 
4.    : ,     Root,   . : unit     . 

 3     

1.  :   skip is_symlink();   allow_symlinks. :     root   . 
2.  :   ,  pipeline: fast checks (nullbytes/),    (png/jpg/gif/pdf/zip),   ;  pythonmagic  . :    images/pdf/zip,  <1%. 
3.  :   [ERROR]   +    stats.errors  skipped["other"]. :  bundle    . 
4.        standardmode: softcap (, 5   )     errors. :    .

 4     

1. Summary:   (KB/MB), 3   +  N,   . :    . 
2. Retry/Copy  UI:  Retry  ; Copy to clipboard  Summary    dismiss. :    UI. 
3. :      output (output.log)      .

 5    

1.       rglob,       ;    stable order . :    100k+ .
2. :  tiktoken  ,  sampleestimate   . :       . 

 6  /

1.  unit      skip_* ( ). :  "false"/"off"  [] . 
2.   mkdir+atomic write:        .
3.   :             100%. 
4.        ;        main/tui.  

  (   )

  ExtractScreen  on_mount  root = cwd  output.parent;  ProgressBar  ;   indeterminate. 
  save_config   tomllib.dumps,  tomliw   fallback. 
  FileExtractor.**init**  None     skip_*;    AppState.  
  extract()  open()  output_path.parent.mkdir(parents=True, exist_ok=True);      rename. 
  _read_file_content     ;   stats    skipped["other"]. 
     processed        total  .  
  binary_signatures     ;  / . 

 

       .
      UI,   .
     (,  ,  , ).
     .
   CI   .

 ,               .


--- pyproject.toml ---
[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "proxtract"
version = "0.2.22"
description = "Interactive TUI CLI to extract project files into a single bundle"
authors = [
    { name = "Proxtract Team" }
]
readme = "README.md"
requires-python = ">=3.9"
license = "MIT"
keywords = ["cli", "developer-tools", "prompt-engineering", "project-extraction"]
license-files = ["LICENSE"]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Developers",
    "Environment :: Console",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Operating System :: OS Independent"
]
dependencies = [
    "rich>=13.7.0",
    "prompt_toolkit>=3.0.43",
    "argcomplete>=3.1.4"
]

[project.scripts]
proxtract = "proxtract.main:main"
prx = "proxtract.main:main"

[project.optional-dependencies]
banner = ["art>=6.0"]
gitignore = ["pathspec>=0.11"]
tokens = ["tiktoken>=0.7"]
clipboard = ["pyperclip>=1.8"]
config = ["tomli>=2.0", "tomli-w>=1.0"]
all = [
    "art>=6.0",
    "pathspec>=0.11",
    "tiktoken>=0.7",
    "pyperclip>=1.8",
    "tomli>=2.0",
    "tomli-w>=1.0",
    "argcomplete>=3.1.4",
]
dev = [
    "build>=1.0.3",
    "twine>=4.0.2",
    "pytest>=7.0.0",
    "pytest-cov>=4.0.0",
    "pytest-mock>=3.10.0"
]

[tool.setuptools.packages.find]
where = ["src"]

[tool.setuptools]
include-package-data = true

[tool.pytest.ini_options]
minversion = "6.0"
addopts = [
    "-ra",
    "--strict-markers",
    "--strict-config",
    "--cov=src/proxtract",
    "--cov-report=term-missing",
    "--cov-report=html:htmlcov",
    "--cov-report=xml",
    "--cov-fail-under=80"
]
testpaths = [
    "tests"
]
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests",
    "cli: marks tests as CLI-related",
    "core: marks tests as core functionality",
    "config: marks tests as configuration-related"
]
filterwarnings = [
    "error",
    "ignore::UserWarning",
    "ignore::DeprecationWarning:rich.*",
]

[tool.coverage.run]
source = ["src/proxtract"]
omit = [
    "*/tests/*",
    "*/test_*",
    "setup.py",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "if settings.DEBUG",
    "raise AssertionError",
    "raise NotImplementedError",
    "if 0:",
    "if __name__ == .__main__.:",
    "class .*\\bProtocol\\):",
    "@(abc\\.)?abstractmethod"
]

[tool.coverage.html]
directory = "htmlcov"


--- scripts/smoke_test.py ---
"""Quick smoke test for the Proxtract interfaces.

The test validates that the CLI help is accessible, performs a single-file
extraction check using the public API, and verifies the command-line extract
subcommand. This script is intended for manual verification and CI smoke runs.
"""

from __future__ import annotations

import subprocess
import sys
import tempfile
import os
from pathlib import Path
from unittest.mock import patch

from proxtract.core import FileExtractor


def _check_cli_help() -> None:
    result = subprocess.run(
        [sys.executable, "-m", "proxtract", "--help"],
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        text=True,
        timeout=10,
    )

    if result.returncode != 0:
        raise RuntimeError(f"CLI help failed: {result.stderr or result.stdout}")

    if "extract" not in result.stdout:
        raise RuntimeError("Expected extract subcommand to appear in help output")


def _check_cli_extract() -> None:
    with tempfile.TemporaryDirectory() as tmpdir:
        root = Path(tmpdir)
        (root / "sample.txt").write_text("hello cli", encoding="utf-8")
        output = root / "cli_output.txt"

        process = subprocess.Popen(
            [sys.executable, "-m", "proxtract", "extract", str(root), "--output", str(output)],
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True,
        )

        stdout, stderr = process.communicate(timeout=15)

        if process.returncode != 0:
            raise RuntimeError(f"CLI extract failed: {stderr or stdout}")

        if not output.exists():
            raise RuntimeError("CLI extract did not produce the expected output file")


def _check_core_extraction() -> None:
    extractor = FileExtractor()
    with tempfile.TemporaryDirectory() as tmpdir:
        root = Path(tmpdir)
        sample_file = root / "sample.txt"
        sample_file.write_text("hello proxtract", encoding="utf-8")
        output = root / "output.txt"

        stats = extractor.extract(root, output)

        if stats.processed_files != 1:
            raise RuntimeError("Expected exactly one file processed")

        merged = output.read_text(encoding="utf-8")
        if "hello proxtract" not in merged:
            raise RuntimeError("Extracted content missing from output")


def _check_file_filtering() -> None:
    """Test file filtering logic including extensions, patterns, and file names."""
    with tempfile.TemporaryDirectory() as tmpdir:
        root = Path(tmpdir)
        
        # Create test files
        (root / "python.py").write_text("print('python')", encoding="utf-8")
        (root / "image.png").write_text("fake png content", encoding="utf-8")  # Binary-like
        (root / "document.pdf").write_text("fake pdf content", encoding="utf-8")
        (root / "test.js").write_text("console.log('test');", encoding="utf-8")
        (root / "package.json").write_text('{"name": "test"}', encoding="utf-8")
        (root / "empty.txt").write_text("", encoding="utf-8")  # Empty file
        (root / "large.txt").write_text("x" * (600 * 1024), encoding="utf-8")  # Large file
        
        # Test with custom filtering rules
        extractor = FileExtractor(
            skip_extensions={".pdf", ".png"},  # Skip PDF and PNG files
            skip_files={"package.json"},       # Skip package.json specifically
            skip_patterns={"test_*"},          # Skip files starting with test_
            max_file_size_kb=500,              # 500KB limit
        )
        
        output = root / "filtered_output.txt"
        stats = extractor.extract(root, output)
        
        # Verify filtering worked
        content = output.read_text(encoding="utf-8")
        
        # Should have processed the .py and .js files
        if "python.py" not in content:
            raise RuntimeError("Expected python.py to be processed")
        if "test.js" not in content:
            raise RuntimeError("Expected test.js to be processed (test_* pattern doesn't match .js files)")
        
        # Should have skipped the filtered files
        if "image.png" in content:
            raise RuntimeError("Expected image.png to be skipped")
        if "document.pdf" in content:
            raise RuntimeError("Expected document.pdf to be skipped")
        if "package.json" in content:
            raise RuntimeError("Expected package.json to be skipped")
        if "empty.txt" in content:
            raise RuntimeError("Expected empty.txt to be skipped (empty files)")
        if "large.txt" in content:
            raise RuntimeError("Expected large.txt to be skipped (too large)")
        
        # Verify stats
        if stats.processed_files != 2:
            raise RuntimeError(f"Expected 2 files processed, got {stats.processed_files}")
        
        if stats.skipped.get("excluded_ext", 0) != 2:
            raise RuntimeError(f"Expected 2 files skipped by extension, got {stats.skipped.get('excluded_ext', 0)}")
        
        if stats.skipped.get("excluded_name", 0) != 1:
            raise RuntimeError(f"Expected 1 file skipped by name, got {stats.skipped.get('excluded_name', 0)}")
        
        if stats.skipped.get("empty", 0) != 1:
            raise RuntimeError(f"Expected 1 file skipped as empty, got {stats.skipped.get('empty', 0)}")
        
        if stats.skipped.get("too_large", 0) != 1:
            raise RuntimeError(f"Expected 1 file skipped as too large, got {stats.skipped.get('too_large', 0)}")


def _check_binary_detection() -> None:
    """Test binary file detection."""
    with tempfile.TemporaryDirectory() as tmpdir:
        root = Path(tmpdir)
        
        # Create test files with different content types
        text_file = root / "text.txt"
        text_file.write_text("This is a text file", encoding="utf-8")
        
        binary_like_file = root / "binary.xyz"  # Use extension not in default skip list
        # Write PNG signature + some binary content
        binary_content = b'\x89PNG\r\n\x1a\n' + b'\x00' * 100
        binary_like_file.write_bytes(binary_content)
        
        # Create a file with high null byte ratio
        null_file = root / "nulls.abc"  # Use extension not in default skip list
        null_file.write_bytes(b'\x00' * 50 + b'text' + b'\x00' * 50)
        
        extractor = FileExtractor()
        output = root / "binary_output.txt"
        stats = extractor.extract(root, output)
        
        content = output.read_text(encoding="utf-8")
        
        # Text file should be processed
        if "text.txt" not in content:
            raise RuntimeError("Expected text.txt to be processed")
        
        # Binary files should be skipped
        if "binary.xyz" in content:
            raise RuntimeError("Expected binary.xyz to be skipped")
        
        if "nulls.abc" in content:
            raise RuntimeError("Expected nulls.abc to be skipped")
        
        # Verify stats
        if stats.skipped.get("binary", 0) != 2:
            raise RuntimeError(f"Expected 2 files skipped as binary, got {stats.skipped.get('binary', 0)}")


def _check_include_patterns() -> None:
    """Test include pattern filtering."""
    with tempfile.TemporaryDirectory() as tmpdir:
        root = Path(tmpdir)
        
        # Create test files with directories
        (root / "src").mkdir()
        (root / "src" / "file.py").write_text("print('python')", encoding="utf-8")
        (root / "docs").mkdir()
        (root / "docs" / "readme.md").write_text("# README", encoding="utf-8")
        (root / "tests").mkdir()
        (root / "tests" / "test.py").write_text("def test(): pass", encoding="utf-8")
        
        extractor = FileExtractor(include_patterns=["src/*", "*.md"])
        output = root / "include_output.txt"
        stats = extractor.extract(root, output)
        
        content = output.read_text(encoding="utf-8")
        
        # Should only process included files
        if "src/file.py" not in content:
            raise RuntimeError("Expected src/file.py to be processed (included pattern)")
        if "docs/readme.md" not in content:
            raise RuntimeError("Expected docs/readme.md to be processed (included pattern)")
        
        # Should skip excluded files
        if "tests/test.py" in content:
            raise RuntimeError("Expected tests/test.py to be skipped (not in include patterns)")


def main() -> None:
    print("Running smoke tests...")
    _check_cli_help()
    print(" CLI help check passed")
    
    _check_cli_extract()
    print(" CLI extract check passed")
    
    _check_core_extraction()
    print(" Core extraction check passed")
    
    _check_file_filtering()
    print(" File filtering check passed")
    
    _check_binary_detection()
    print(" Binary detection check passed")
    
    _check_include_patterns()
    print(" Include patterns check passed")
    
    print("All smoke tests passed! CLI launches and all filtering logic works.")


if __name__ == "__main__":
    main()


--- src/proxtract/__init__.py ---
"""Proxtract package exposing the interactive extractor CLI."""

from importlib import metadata as _metadata

from .core import ExtractionError, ExtractionStats, FileExtractor

try:
    __version__ = _metadata.version("proxtract")
except _metadata.PackageNotFoundError:  # pragma: no cover - local editable install
    __version__ = "0.1.0"

__all__ = ["FileExtractor", "ExtractionError", "ExtractionStats", "__version__"]


--- src/proxtract/__main__.py ---
"""Module entrypoint for ``python -m proxtract``."""

from .main import main


if __name__ == "__main__":  # pragma: no cover
    main()


--- src/proxtract/config.py ---
"""Configuration persistence helpers for Proxtract."""

from __future__ import annotations

from pathlib import Path
from typing import Any, Dict, Iterable, Optional

from .state import AppState
from .utils import normalize_bool

try:  # Python 3.11+
    import tomllib as _tomllib  # type: ignore[assignment]
except Exception:  # pragma: no cover - fallback to tomli if available
    try:
        import tomli as _tomllib  # type: ignore
    except Exception:  # pragma: no cover - optional dependency missing
        _tomllib = None  # type: ignore

try:  # TOML writing library
    import tomli_w as _tomli_w  # type: ignore[assignment]
except Exception:  # pragma: no cover - optional dependency missing
    _tomli_w = None  # type: ignore


def _config_path() -> Path:
    return Path("~/.config/proxtract/settings.toml").expanduser()


def load_config() -> Dict[str, Any]:
    path = _config_path()
    if not path.exists() or _tomllib is None:
        return {}
    try:
        return _tomllib.loads(path.read_text(encoding="utf-8"))
    except Exception:
        return {}


def apply_config(state: AppState, data: Dict[str, Any]) -> AppState:
    if not data:
        return state

    # Helper function to safely convert to int
    def safe_int(value, default):
        try:
            return int(value)
        except (ValueError, TypeError):
            return default

    source_root = data.get("source_root", state.source_root)
    state.source_root = Path(source_root).expanduser()

    output_path = data.get("output_path", state.output_path)
    state.output_path = Path(output_path).expanduser()
    
    state.max_size_kb = safe_int(data.get("max_size_kb", state.max_size_kb), state.max_size_kb)
    state.compact_mode = normalize_bool(data.get("compact_mode", state.compact_mode), state.compact_mode)
    state.skip_empty = normalize_bool(data.get("skip_empty", state.skip_empty), state.skip_empty)
    state.use_gitignore = normalize_bool(data.get("use_gitignore", state.use_gitignore), state.use_gitignore)
    state.force_include = normalize_bool(data.get("force_include", state.force_include), state.force_include)

    include = data.get("include_patterns")
    if isinstance(include, list):
        state.include_patterns = [str(item) for item in include]

    exclude = data.get("exclude_patterns")
    if isinstance(exclude, list):
        state.exclude_patterns = [str(item) for item in exclude]

    # Filter configuration - allow overriding hardcoded filters
    skip_extensions = data.get("skip_extensions", state.skip_extensions)
    if skip_extensions is None:
        state.skip_extensions = None
    elif isinstance(skip_extensions, list):
        state.skip_extensions = {str(item) for item in skip_extensions}

    skip_patterns = data.get("skip_patterns", state.skip_patterns)
    if skip_patterns is None:
        state.skip_patterns = None
    elif isinstance(skip_patterns, list):
        state.skip_patterns = {str(item) for item in skip_patterns}

    skip_files = data.get("skip_files", state.skip_files)
    if skip_files is None:
        state.skip_files = None
    elif isinstance(skip_files, list):
        state.skip_files = {str(item) for item in skip_files}

    state.tokenizer_model = str(data.get("tokenizer_model", state.tokenizer_model))
    state.enable_token_count = normalize_bool(
        data.get("enable_token_count", state.enable_token_count), state.enable_token_count
    )
    state.copy_to_clipboard = normalize_bool(
        data.get("copy_to_clipboard", state.copy_to_clipboard), state.copy_to_clipboard
    )
    return state


def save_config(state: AppState) -> None:
    path = _config_path()
    path.parent.mkdir(parents=True, exist_ok=True)

    source_root = getattr(state, "source_root", Path.cwd())
    output_path = getattr(state, "output_path", Path("extracted.txt"))

    data: Dict[str, Any] = {
        "source_root": str(Path(source_root)),
        "output_path": str(Path(output_path)),
        "max_size_kb": int(state.max_size_kb),
        "compact_mode": bool(state.compact_mode),
        "skip_empty": bool(state.skip_empty),
        "use_gitignore": bool(state.use_gitignore),
        "force_include": bool(state.force_include),
        "include_patterns": list(state.include_patterns),
        "exclude_patterns": list(state.exclude_patterns),
        "tokenizer_model": str(state.tokenizer_model),
        "enable_token_count": bool(state.enable_token_count),
        "copy_to_clipboard": bool(state.copy_to_clipboard),
    }

    def _serialize_optional_iterable(key: str, value: Optional[Iterable[str]]) -> None:
        if value is None:
            return
        data[key] = list(value)

    _serialize_optional_iterable("skip_extensions", getattr(state, "skip_extensions", None))
    _serialize_optional_iterable("skip_patterns", getattr(state, "skip_patterns", None))
    _serialize_optional_iterable("skip_files", getattr(state, "skip_files", None))

    # Use proper TOML library if available, otherwise fall back to manual construction
    if _tomli_w is not None:
        try:
            with path.open("wb") as handle:
                _tomli_w.dump(data, handle)
            return
        except Exception:
            # Fall back to manual construction if TOML serialization fails
            pass

    # Fallback to manual construction if TOML library is not available or fails
    def _escape(item: str) -> str:
        return item.replace("\\", "\\\\").replace('"', '\\"')

    lines: list[str] = []
    for key, value in data.items():
        if isinstance(value, bool):
            rendered = "true" if value else "false"
        elif isinstance(value, int):
            rendered = str(value)
        elif isinstance(value, (list, set)):
            rendered = "[" + ", ".join(f'"{_escape(entry)}"' for entry in value) + "]"
        else:
            rendered = f'"{_escape(str(value))}"'
        lines.append(f"{key} = {rendered}")

    with path.open("w", encoding="utf-8") as handle:
        handle.write("\n".join(lines))
        handle.write("\n")


__all__ = ["load_config", "apply_config", "save_config"]


--- src/proxtract/core.py ---
"""Core extraction logic for the Proxtract CLI."""

from __future__ import annotations

from collections import defaultdict
from dataclasses import dataclass
from pathlib import Path
from typing import Callable, DefaultDict, Dict, Iterable, Optional, Protocol
import fnmatch
import os
import tempfile

try:  # Optional dependency for .gitignore support
    import pathspec as _pathspec  # type: ignore
except Exception:  # pragma: no cover - dependency optional
    _pathspec = None  # type: ignore

try:  # Optional dependency for token counting
    import tiktoken as _tiktoken  # type: ignore
except Exception:  # pragma: no cover - dependency optional
    _tiktoken = None  # type: ignore


class ProgressCallback(Protocol):
    """Callable invoked to report extraction progress."""

    def __call__(self, *, advance: int, description: Optional[str] = None) -> None:  # pragma: no cover - Protocol definition
        ...


@dataclass
class ExtractionStats:
    """Structured information returned after a successful extraction."""

    root: Path
    output: Path
    processed_paths: list[str]
    total_bytes: int
    skipped_paths: Dict[str, list[str]]
    errors: list[str]
    token_count: Optional[int] = None
    token_model: Optional[str] = None

    @property
    def processed_files(self) -> int:
        """Backward compatible count of processed files."""

        return len(self.processed_paths)

    @property
    def skipped(self) -> Dict[str, int]:
        """Backward compatible summary of skipped files by reason."""

        counts: DefaultDict[str, int] = defaultdict(int)
        canonical_reasons = {
            "excluded_ext",
            "empty",
            "too_large",
            "binary",
            "excluded_name",
            "excluded_path",
            "excluded_pattern",
            "gitignore",
            "not_included",
            "other",
        }
        for reason, paths in self.skipped_paths.items():
            key = reason if reason in canonical_reasons else "other"
            count = len(paths)
            if count:
                counts[key] = counts.get(key, 0) + count
        return counts

    def as_dict(self) -> Dict[str, object]:
        """Return stats in plain dict form for serialization/logging."""

        result = {
            "root": str(self.root),
            "output": str(self.output),
            "processed_paths": list(self.processed_paths),
            "processed_files": self.processed_files,
            "total_bytes": self.total_bytes,
            "skipped_paths": {reason: list(paths) for reason, paths in self.skipped_paths.items()},
            "skipped": dict(self.skipped),
            "errors": list(self.errors),
        }
        if self.token_count is not None:
            result["token_count"] = self.token_count
        if self.token_model is not None:
            result["token_model"] = self.token_model
        return result


class ExtractionError(RuntimeError):
    """Raised when extraction cannot be performed."""


class FileExtractor:
    """Extract text-friendly files from a project tree into a single document."""

    def __init__(
        self,
        *,
        max_file_size_kb: int = 500,
        skip_empty: bool = True,
        compact_mode: bool = True,
        use_gitignore: bool = False,
        include_patterns: Optional[Iterable[str]] = None,
        exclude_patterns: Optional[Iterable[str]] = None,
        force_include: bool = False,
        tokenizer_model: Optional[str] = None,
        count_tokens: bool = False,
        # Configurable filtering rules
        skip_extensions: Optional[Iterable[str]] = None,
        skip_patterns: Optional[Iterable[str]] = None,
        skip_files: Optional[Iterable[str]] = None,
    ) -> None:
        self.max_file_size = max_file_size_kb * 1024
        self.skip_empty = skip_empty
        self.compact_mode = compact_mode
        self.use_gitignore = use_gitignore
        self.include_patterns = tuple(include_patterns or ())
        self.exclude_patterns = tuple(exclude_patterns or ())
        self.force_include = force_include
        self.tokenizer_model = tokenizer_model
        self.count_tokens = count_tokens

        # Default filtering rules
        default_extensions = {
            ".csv", ".jpeg", ".jpg", ".png", ".gif", ".bmp", ".gitignore", ".env",
            ".mp4", ".lgb", ".sqlite3-wal", ".sqlite3-shm", ".sqlite3", ".mkv",
            ".webm", ".mp3", ".wav", ".flac", ".aac", ".html", ".wma", ".ico",
            ".svg", ".zip", ".rar", ".7z", ".tar", ".gz", ".bz2", ".lock",
            ".exe", ".dll", ".so", ".dylib", ".pdf", ".doc", ".docx", ".xls",
            ".xlsx", ".ppt", ".pptx", ".pyc", ".pyo", ".pyd", ".pkl", ".parquet",
            ".orc", ".avro", ".feather", ".h5", ".hdf5", ".db", ".sqlite", ".bin",
            ".dat", ".idx", ".model", ".pt", ".ckpt", ".npy", ".npz", ".woff",
            ".woff2", ".ttf", ".eot"
        }

        default_patterns = {
            "__pycache__", ".git", ".svn", ".hg", "node_modules", ".vscode",
            ".idea", ".pytest_cache", ".mypy_cache", "venv", "env", "virtualenv",
            "dist", "build", ".next", "coverage", ".nyc_output", "vendor"
        }

        default_files = {
            "package-lock.json", "yarn.lock", "poetry.lock", "Pipfile.lock",
            ".DS_Store", "Thumbs.db", "desktop.ini"
        }

        def _coerce_set(values: Iterable[str]) -> set[str]:
            return {str(entry) for entry in values}

        def _coerce_extensions(values: Iterable[str]) -> set[str]:
            return {str(entry).lower() for entry in values}

        # Use provided rules or fall back to defaults
        self.skip_extensions = (
            _coerce_extensions(default_extensions) if skip_extensions is None else _coerce_extensions(skip_extensions)
        )
        self.skip_patterns = _coerce_set(default_patterns) if skip_patterns is None else _coerce_set(skip_patterns)
        self.skip_files = _coerce_set(default_files) if skip_files is None else _coerce_set(skip_files)

        self._root_path: Optional[Path] = None
        self._gitignore_spec = None

    def _rel(self, file_path: Path) -> str:
        assert self._root_path is not None
        return str(file_path.relative_to(self._root_path))

    @staticmethod
    def _match_any(patterns: Iterable[str], rel: str) -> bool:
        for pattern in patterns:
            if fnmatch.fnmatch(rel, pattern):
                return True
        return False

    def _should_skip(self, file_path: Path, *, include_override: bool) -> tuple[bool, str]:
        rel = self._rel(file_path)
        include_forced = include_override and self.force_include

        if not include_forced and self._match_any(self.exclude_patterns, rel):
            return True, "excluded_pattern"

        if (
            not include_forced
            and self._gitignore_spec is not None
            and self._gitignore_spec.match_file(rel)  # type: ignore[union-attr]
        ):
            return True, "gitignore"

        if self.include_patterns and not include_override:
            return True, "not_included"

        if not include_override:
            if file_path.name in self.skip_files:
                return True, "excluded_name"

            if file_path.suffix.lower() in self.skip_extensions:
                return True, "excluded_ext"

            # Check if filename matches any skip patterns
            rel = self._rel(file_path)
            if self._match_any(self.skip_patterns, rel):
                return True, "excluded_path"

            for part in file_path.parts:
                if part in self.skip_patterns or part.startswith("."):
                    return True, "excluded_path"

        try:
            size = file_path.stat().st_size
        except OSError as exc:  # Permission denied, etc.
            raise ExtractionError(f"Unable to inspect file '{file_path}': {exc}") from exc

        if self.skip_empty and size == 0:
            return True, "empty"

        if size > self.max_file_size:
            return True, "too_large"

        return False, ""

    @staticmethod
    def _is_text_file(file_path: Path) -> bool:
        """Enhanced text file detection with binary detection."""
        # Check file size first - very small files are often text
        try:
            size = file_path.stat().st_size
        except OSError:
            return False
            
        if size == 0:
            return True
            
        # Read a reasonable chunk for analysis (limit to 8192 bytes)
        max_bytes = min(size, 8192)
        
        try:
            with open(file_path, "rb") as handle:
                data = handle.read(max_bytes)
        except (PermissionError, OSError):
            return False
            
        # Check for common binary file signatures (magic bytes)
        binary_signatures = {
            # Images
            b'\x89PNG': '.png',
            b'\xff\xd8\xff': '.jpg',
            b'GIF8': '.gif',
            b'RIFF': '.webp',  # may be webp or other RIFF-based format
            # Archives
            b'PK\x03\x04': '.zip',
            b'PK\x05\x06': '.zip',  # empty zip
            b'PK\x07\x08': '.zip',  # spanned zip
            b'RARF': '.rar',
            b'7z\xbc\xaf\x27\x1c': '.7z',
            b'\x1f\x8b': '.gz',
            b'BZh': '.bz2',
            # Documents
            b'%PDF': '.pdf',
            b'\xd0\xcf\x11\xe0': '.doc',  # MS Office
            b'PK\x03\x04': '.docx',  # OOXML
            # Audio/Video
            b'fLaC': '.flac',
            b'ID3': '.mp3',  # MP3 with ID3
            b'OggS': '.ogg',
            # Executables
            b'MZ': '.exe',
            b'\x7fELF': '.elf',
            # Database files
            b'SQLite': '.sqlite',
            b'\x00\x00\x00\x20ftyp': '.mp4',  # MP4/M4A
        }
        
        # Check for magic bytes
        for signature in binary_signatures:
            if data.startswith(signature):
                return False
                
        # Check for null bytes (strong indicator of binary content)
        # But allow null bytes in specific file types that might contain them
        if b'\x00' in data:
            # Additional check: if file is mostly null bytes, it's definitely binary
            null_ratio = data.count(b'\x00') / len(data)
            if null_ratio > 0.1:  # More than 10% null bytes
                return False
                
        # Try to decode as text with different encodings
        encodings = ["utf-8", "utf-8-sig", "cp1252", "latin-1", "cp1251"]
        for encoding in encodings:
            try:
                decoded = data.decode(encoding)
                # Additional check: if decoded content contains too many control
                # characters (except common ones like \n, \r, \t), it might be binary
                control_chars = sum(1 for c in decoded if (not c.isprintable()) and c not in '\n\r\t')
                control_ratio = control_chars / len(decoded) if decoded else 0
                if control_ratio > 0.1:  # More than 10% control characters
                    continue
                return True
            except UnicodeDecodeError:
                continue
                
        return False

    @staticmethod
    def _read_file_content(file_path: Path) -> str:
        encodings = ["utf-8", "cp1251", "latin-1"]
        for encoding in encodings:
            try:
                with open(file_path, "r", encoding=encoding) as handle:
                    return handle.read()
            except (UnicodeDecodeError, PermissionError):
                continue
        return "[ERROR: Could not decode file]"

    def _format_compact(self, relative_path: Path, content: str) -> str:
        return f"\n--- {relative_path} ---\n{content}\n"

    def _format_standard(self, relative_path: Path, content: str) -> str:
        separator = "=" * 60
        return f"\n{separator}\nFILE: {relative_path}\n{separator}\n{content}\n\n"

    def extract(
        self,
        root_dir: str | Path,
        output_file: str | Path,
        *,
        progress_callback: Optional[ProgressCallback] = None,
    ) -> ExtractionStats:
        """Extract text files into a single document.

        Args:
            root_dir: Directory to scan.
            output_file: Destination file path.
            progress_callback: Optional callable compatible with
                ``rich.progress.Progress.update``. It receives keyword arguments
                ``advance`` (int) and ``description`` (str) describing the current file.

        Returns:
            ``ExtractionStats`` describing the operation.

        Raises:
            ExtractionError: If the root directory is invalid or I/O fails.
        """

        root_path = Path(root_dir).expanduser().resolve()
        if not root_path.exists() or not root_path.is_dir():
            raise ExtractionError(f"'{root_dir}' is not a valid directory")

        output_path = Path(output_file).expanduser().resolve()
        output_path.parent.mkdir(parents=True, exist_ok=True)

        self._root_path = root_path
        self._gitignore_spec = None
        gitignore_error: Optional[str] = None
        if self.use_gitignore:
            if _pathspec is None:
                gitignore_error = "use_gitignore enabled but 'pathspec' is not installed"
            else:
                gitignore_path = root_path / ".gitignore"
                try:
                    lines: Iterable[str] = ()
                    if gitignore_path.exists():
                        lines = gitignore_path.read_text(encoding="utf-8").splitlines()
                    self._gitignore_spec = _pathspec.PathSpec.from_lines("gitwildmatch", lines)
                except Exception as exc:  # pragma: no cover - defensive guard
                    gitignore_error = f"Failed to load .gitignore: {exc}"

        skipped_paths: DefaultDict[str, list[str]] = defaultdict(list)
        processed_paths: list[str] = []
        total_bytes = 0
        errors: list[str] = []
        if gitignore_error is not None:
            errors.append(gitignore_error)

        token_count: Optional[int] = None
        token_model: Optional[str] = None
        encoder = None

        temp_path: Optional[Path] = None
        temp_path_resolved: Optional[Path] = None

        try:
            with tempfile.NamedTemporaryFile(
                mode="w",
                encoding="utf-8",
                delete=False,
                dir=str(output_path.parent),
                prefix=f"{output_path.name}.",
                suffix=".tmp",
            ) as destination:
                temp_path = Path(destination.name)
                temp_path_resolved = temp_path.resolve()
                destination.write(f"# Extracted from: {root_path}\n")
                destination.write(f"# Max file size: {self.max_file_size // 1024}KB\n")
                destination.write(f"# Mode: {'compact' if self.compact_mode else 'standard'}\n")
                destination.write("=" * 60 + "\n")
                if self.use_gitignore:
                    destination.write(f"# Gitignore: {'on' if self._gitignore_spec is not None else 'off'}\n")
                if self.include_patterns:
                    destination.write(f"# Include patterns: {', '.join(self.include_patterns)}\n")
                if self.exclude_patterns:
                    destination.write(f"# Exclude patterns: {', '.join(self.exclude_patterns)}\n")

                encoder = None
                token_count = None
                token_model = None
                if self.count_tokens:
                    if _tiktoken is None:
                        errors.append("Token counting enabled but 'tiktoken' is not installed")
                    else:
                        try:
                            token_model = self.tokenizer_model or "gpt-4"
                            try:
                                encoder = _tiktoken.encoding_for_model(token_model)
                            except Exception:
                                encoder = _tiktoken.get_encoding("cl100k_base")
                            token_count = 0
                        except Exception as exc:  # pragma: no cover - defensive
                            errors.append(f"Failed to initialize tokenizer: {exc}")
                            encoder = None

                def report(description: str) -> None:
                    if progress_callback is None:
                        return
                    try:
                        progress_callback(advance=1, description=description)
                    except TypeError:
                        progress_callback(1)  # type: ignore[misc]

                for file_path in sorted(root_path.rglob("*")):
                    if not file_path.is_file():
                        continue

                    relative_path = file_path.relative_to(root_path)
                    relative_str = str(relative_path)

                    if temp_path_resolved is not None and file_path.resolve() == temp_path_resolved:
                        continue
                    if file_path.resolve() == output_path:
                        report(f"Skipping {relative_str}")
                        continue

                    include_override = False
                    if self.include_patterns:
                        include_override = self._match_any(self.include_patterns, relative_str)

                    try:
                        skip, reason = self._should_skip(file_path, include_override=include_override)
                    except ExtractionError as exc:
                        errors.append(str(exc))
                        skipped_paths["other"].append(relative_str)
                        report(f"Skipping {relative_str}")
                        continue

                    if skip:
                        skipped_key = reason or "other"
                        skipped_paths[skipped_key].append(relative_str)
                        report(f"Skipping {relative_str}")
                        continue

                    if not self._is_text_file(file_path):
                        skipped_paths["binary"].append(relative_str)
                        report(f"Skipping {relative_str}")

                        continue

                    content = self._read_file_content(file_path)

                    formatter = self._format_compact if self.compact_mode else self._format_standard
                    destination.write(formatter(relative_path, content))

                    processed_paths.append(relative_str)
                    total_bytes += len(content)

                    if encoder is not None and token_count is not None:
                        try:
                            token_count += len(encoder.encode(content))
                        except Exception:  # pragma: no cover - tokenizer fallback
                            pass

                    report(relative_str)

                destination.write(f"\n{'=' * 60}\n")
                destination.write(f"# Total files processed: {len(processed_paths)}\n")
                destination.write(f"# Total size: {total_bytes // 1024}KB\n")
                if token_count is not None:
                    destination.write(f"# Total tokens: {token_count}\n")
                destination.flush()
                os.fsync(destination.fileno())

            if temp_path is None:
                raise ExtractionError("Failed to create temporary output file")

            os.replace(temp_path, output_path)

        except ExtractionError:
            if temp_path is not None:
                try:
                    temp_path.unlink(missing_ok=True)
                except OSError:
                    pass
            raise
        except OSError as exc:
            if temp_path is not None:
                try:
                    temp_path.unlink(missing_ok=True)
                except OSError:
                    pass
            raise ExtractionError(str(exc)) from exc
        except Exception:
            if temp_path is not None:
                try:
                    temp_path.unlink(missing_ok=True)
                except OSError:
                    pass
            raise
        finally:
            self._root_path = None
            self._gitignore_spec = None

        stats = ExtractionStats(
            root=root_path,
            output=output_path,
            processed_paths=list(processed_paths),
            total_bytes=total_bytes,
            skipped_paths={reason: list(paths) for reason, paths in skipped_paths.items()},
            errors=errors,
        )

        if token_count is not None:
            stats.token_count = token_count
            stats.token_model = token_model

        return stats


__all__ = ["FileExtractor", "ExtractionError", "ExtractionStats"]


--- src/proxtract/interactive.py ---
"""Rich + prompt_toolkit powered REPL for Proxtract."""

from __future__ import annotations

import shlex
from contextlib import nullcontext
from pathlib import Path
from typing import Iterable, List, Sequence

try:  # pragma: no cover - optional import guarded for minimal envs
    from prompt_toolkit import PromptSession  # type: ignore
    from prompt_toolkit.completion import Completer, Completion, PathCompleter, WordCompleter  # type: ignore
    from prompt_toolkit.document import Document  # type: ignore
    from prompt_toolkit.history import FileHistory, InMemoryHistory  # type: ignore
    from prompt_toolkit.patch_stdout import patch_stdout  # type: ignore

    PROMPT_TOOLKIT_AVAILABLE = True
except Exception:  # pragma: no cover - fallback when prompt_toolkit absent
    PromptSession = None  # type: ignore
    PROMPT_TOOLKIT_AVAILABLE = False

    class Completion:  # type: ignore[override]
        def __init__(self, text: str, start_position: int = 0, display=None, display_meta=None) -> None:
            self.text = text
            self.start_position = start_position
            self.display = display
            self.display_meta = display_meta

    class Completer:  # type: ignore[override]
        def get_completions(self, *args, **kwargs):
            return []

    class WordCompleter(Completer):  # type: ignore[override]
        def __init__(self, words, **_):
            self.words = list(words)

    class PathCompleter(Completer):  # type: ignore[override]
        def __init__(self, **_):
            pass

        def get_completions(self, *args, **kwargs):
            return []

    class Document:  # type: ignore[override]
        def __init__(self, text: str = "", cursor_position: int | None = None) -> None:
            self.text = text
            self.cursor_position = len(text) if cursor_position is None else cursor_position

        @property
        def text_before_cursor(self) -> str:
            return self.text[: self.cursor_position]

        def get_word_before_cursor(self) -> str:
            text = self.text_before_cursor.rstrip()
            return text.split()[-1] if text.split() else ""

    class InMemoryHistory:  # type: ignore[override]
        def __init__(self, *_, **__):
            pass

    class FileHistory(InMemoryHistory):  # type: ignore[override]
        def __init__(self, *_, **__):
            raise RuntimeError("prompt_toolkit is required for persistent history support")

    def patch_stdout():  # type: ignore[override]
        return nullcontext()
from rich.console import Console
from rich.panel import Panel
from rich.progress import BarColumn, Progress, SpinnerColumn, TextColumn, TimeElapsedColumn
from rich.table import Table
from rich.text import Text

from .config import apply_config, load_config, save_config
from .core import ExtractionError, ExtractionStats
from .state import AppState
from .utils import create_console

COMMANDS = ["extract", "set", "show", "config", "save", "help", "exit", "quit"]
SETTING_KEYS = [
    "source_path",
    "output_path",
    "max_size_kb",
    "compact_mode",
    "skip_empty",
    "use_gitignore",
    "force_include",
    "include_patterns",
    "exclude_patterns",
    "count_tokens",
    "tokenizer_model",
    "copy_clipboard",
]
BOOLEAN_KEYS = {
    "compact_mode",
    "skip_empty",
    "use_gitignore",
    "force_include",
    "count_tokens",
    "copy_clipboard",
}
PATH_KEYS = {"source_path", "output_path"}
PATH_ONLY_DIR_KEYS = {"source_path"}


def _history_path() -> Path:
    return Path("~/.config/proxtract/history").expanduser()


def _tokenize(command: str) -> List[str]:
    stripped = command.strip()
    if not stripped:
        return []
    try:
        tokens = shlex.split(command)
    except ValueError:
        # Fallback to simple whitespace split if quoting is incomplete
        tokens = command.split()
    if command.endswith((" ", "\t")):
        tokens.append("")
    return tokens


class ProxtractCompleter(Completer):
    """Context-aware completer for the REPL."""

    def __init__(self) -> None:
        self._command_words = WordCompleter(COMMANDS, ignore_case=True)
        self._setting_words = WordCompleter(SETTING_KEYS, ignore_case=True)
        self._boolean_words = WordCompleter(["on", "off"], ignore_case=True)
        self._path_completer = PathCompleter(expanduser=True)
        self._dir_completer = PathCompleter(expanduser=True, only_directories=True)

    def _complete_from_word_completer(
        self, completer: WordCompleter, word: str
    ) -> Iterable[Completion]:
        prefix = ""
        lookup = word
        if lookup.startswith("/"):
            prefix = "/"
            lookup = lookup[1:]
        start_position = -len(word)
        lowered = lookup.lower()
        for candidate in completer.words:  # type: ignore[attr-defined]
            if lowered and not candidate.lower().startswith(lowered):
                continue
            candidate_text = prefix + candidate
            yield Completion(candidate_text, start_position=start_position)

    def _complete_path(self, word: str, *, directories_only: bool, complete_event) -> Iterable[Completion]:
        completer = self._dir_completer if directories_only else self._path_completer
        fake_document = Document(text=word, cursor_position=len(word))
        for item in completer.get_completions(fake_document, complete_event):
            yield Completion(
                item.text,
                start_position=-len(word),
                display=item.display,
                display_meta=item.display_meta,
            )

    def get_completions(self, document: Document, complete_event) -> Iterable[Completion]:
        text = document.text_before_cursor
        tokens = _tokenize(text)
        raw_command = tokens[0] if tokens else document.get_word_before_cursor()
        if not tokens:
            yield from self._complete_from_word_completer(self._command_words, raw_command)
            return

        if tokens[-1] == "":
            current_word = ""
        else:
            current_word = document.get_word_before_cursor()

        command = tokens[0].lower()
        token_count = len(tokens)
        if token_count == 1 and current_word != "":
            yield from self._complete_from_word_completer(self._command_words, raw_command)
            return

        if command in {"exit", "quit", "help", "show", "config", "save"}:
            return

        if command == "set":
            if token_count <= 2 and not text.endswith(" "):
                yield from self._complete_from_word_completer(self._setting_words, current_word)
                return
            if token_count == 2 and text.endswith(" "):
                yield from self._complete_from_word_completer(self._setting_words, "")
                return

            key = tokens[1].lower() if len(tokens) > 1 else ""
            if key in BOOLEAN_KEYS:
                yield from self._complete_from_word_completer(self._boolean_words, current_word)
                return
            if key in PATH_KEYS:
                directories_only = key in PATH_ONLY_DIR_KEYS
                yield from self._complete_path(current_word, directories_only=directories_only, complete_event=complete_event)
                return
            if key:
                return

        if command == "extract":
            if token_count <= 2:
                yield from self._complete_path(current_word, directories_only=True, complete_event=complete_event)
                return
            if token_count == 3:
                yield from self._complete_path(current_word, directories_only=False, complete_event=complete_event)
                return


class InteractiveShell:
    """Interactive REPL for Proxtract commands."""

    PROMPT = "proxtract> "

    def __init__(self, console: Console | None = None, state: AppState | None = None) -> None:
        self.console = console or create_console()
        self.state = state or apply_config(AppState(), load_config())
        self.completer = ProxtractCompleter()
        self._session: PromptSession | None = None
        self._running = True

    def run(self) -> None:
        self._render_banner()
        try:
            session = self._ensure_session()
        except RuntimeError as exc:
            self.console.print(Panel(f"[red]{exc}[/red]", border_style="red"))
            return
        with patch_stdout():
            while self._running:
                try:
                    text = session.prompt(self.PROMPT)
                except (KeyboardInterrupt, EOFError):
                    self.console.print("[yellow]Type 'exit' or 'quit' to close Proxtract.[/yellow]")
                    continue
                if not text.strip():
                    continue
                if not self.handle_command(text):
                    break

    def handle_command(self, command: str) -> bool:
        tokens = _tokenize(command)
        if not tokens:
            return True
        cmd = tokens[0].lstrip("/").lower()
        args = tokens[1:]

        if cmd in {"exit", "quit"}:
            self.console.print(Panel("[green] ![/green]", border_style="green"))
            return False
        if cmd == "help":
            self._show_help()
            return True
        if cmd in {"show", "config"}:
            self._show_config()
            return True
        if cmd == "save":
            self._save_config_command()
            return True
        if cmd == "set":
            self._set_value(args)
            return True
        if cmd == "extract":
            self._run_extract(args)
            return True

        self.console.print(Panel(f"[red] :[/red] {cmd}", border_style="red"))
        return True

    def _render_banner(self) -> None:
        text = Text()
        text.append("Proxtract\n", style="bold green")
        text.append(" REPL    .\n", style="cyan")
        text.append(": extract, set, show, save, help, exit", style="white")
        self.console.print(Panel(text, border_style="cyan"))

    def _ensure_session(self) -> PromptSession:
        if self._session is not None:
            return self._session
        if not PROMPT_TOOLKIT_AVAILABLE or PromptSession is None:
            raise RuntimeError(
                "prompt_toolkit is required for the interactive REPL. "
                "Install it via 'pip install prompt_toolkit' or reinstall Proxtract with the new dependencies."
            )
        history_path = _history_path()
        try:
            history_path.parent.mkdir(parents=True, exist_ok=True)
            history = FileHistory(str(history_path))
        except Exception:
            history = InMemoryHistory()

        self._session = PromptSession(
            history=history,
            completer=self.completer,
            complete_while_typing=True,
        )
        return self._session

    def _show_help(self) -> None:
        table = Table(show_header=True, header_style="bold magenta")
        table.add_column("", style="cyan", no_wrap=True)
        table.add_column("", style="white")
        table.add_row("extract [src] [out]", " .  .")
        table.add_row("set <key> <value>", "  ( Tab  ).")
        table.add_row("show / config", "  .")
        table.add_row("save", "   settings.toml.")
        table.add_row("help", "  .")
        table.add_row("exit / quit", " .")
        self.console.print(table)

    def _show_config(self) -> None:
        table = Table(title=" ", header_style="bold blue")
        table.add_column("", style="cyan", no_wrap=True)
        table.add_column("", style="white")
        for key, value in self._iter_config():
            table.add_row(key, value)
        self.console.print(table)

    def _iter_config(self) -> Iterable[tuple[str, str]]:
        state = self.state
        yield "source_path", str(state.source_root)
        yield "output_path", str(state.output_path)
        yield "max_size_kb", str(state.max_size_kb)
        yield "compact_mode", "on" if state.compact_mode else "off"
        yield "skip_empty", "on" if state.skip_empty else "off"
        yield "use_gitignore", "on" if state.use_gitignore else "off"
        yield "force_include", "on" if state.force_include else "off"
        yield "include_patterns", ", ".join(state.include_patterns) or "-"
        yield "exclude_patterns", ", ".join(state.exclude_patterns) or "-"
        yield "count_tokens", "on" if state.enable_token_count else "off"
        yield "tokenizer_model", state.tokenizer_model or "-"
        yield "copy_clipboard", "on" if state.copy_to_clipboard else "off"

    def _set_value(self, args: Sequence[str]) -> None:
        if len(args) < 2:
            self.console.print(Panel("[red]: set <key> <value>[/red]", border_style="red"))
            return
        key = args[0].lower()
        value = " ".join(args[1:])
        handler = getattr(self, f"_set_{key}", None)
        if handler is None:
            self.console.print(Panel(f"[red] :[/red] {key}", border_style="red"))
            return
        try:
            handler(value)
        except ValueError as exc:
            self.console.print(Panel(f"[red]:[/red] {exc}", border_style="red"))
            return
        self.console.print(Panel(f"[green]{key} .[/green]", border_style="green"))

    def _parse_bool(self, value: str) -> bool:
        normalized = value.strip().lower()
        if normalized in {"on", "true", "1", "yes"}:
            return True
        if normalized in {"off", "false", "0", "no"}:
            return False
        raise ValueError(" 'on'  'off'")

    def _set_source_path(self, value: str) -> None:
        path = Path(value).expanduser()
        if not path.exists():
            raise ValueError("  ")
        self.state.set_source_root(path)

    def _set_output_path(self, value: str) -> None:
        path = Path(value).expanduser()
        self.state.set_output_path(path)

    def _set_max_size_kb(self, value: str) -> None:
        size = int(value)
        if size <= 0:
            raise ValueError("    ")
        self.state.max_size_kb = size

    def _set_compact_mode(self, value: str) -> None:
        self.state.compact_mode = self._parse_bool(value)

    def _set_skip_empty(self, value: str) -> None:
        self.state.skip_empty = self._parse_bool(value)

    def _set_use_gitignore(self, value: str) -> None:
        self.state.use_gitignore = self._parse_bool(value)

    def _set_force_include(self, value: str) -> None:
        self.state.force_include = self._parse_bool(value)

    def _set_include_patterns(self, value: str) -> None:
        self.state.include_patterns = self._parse_patterns(value)

    def _set_exclude_patterns(self, value: str) -> None:
        self.state.exclude_patterns = self._parse_patterns(value)

    def _set_count_tokens(self, value: str) -> None:
        self.state.enable_token_count = self._parse_bool(value)

    def _set_tokenizer_model(self, value: str) -> None:
        self.state.tokenizer_model = value.strip() or self.state.tokenizer_model

    def _set_copy_clipboard(self, value: str) -> None:
        self.state.copy_to_clipboard = self._parse_bool(value)

    def _parse_patterns(self, value: str) -> List[str]:
        if not value.strip():
            return []
        return [item.strip() for item in value.split(",") if item.strip()]

    def _run_extract(self, args: Sequence[str]) -> None:
        source = args[0] if args else None
        output = args[1] if len(args) > 1 else None
        if source:
            self.state.set_source_root(source)
        if output:
            self.state.set_output_path(output)

        root = self.state.source_root
        destination = self.state.output_path

        if not root.exists():
            self.console.print(Panel("[red]  source_path.[/red]", border_style="red"))
            return

        extractor = self.state.create_extractor()
        progress_columns = [
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            BarColumn(),
            TimeElapsedColumn(),
        ]
        with Progress(*progress_columns, refresh_per_second=10, console=self.console) as progress:
            task_id = progress.add_task("...", start=False)

            def _callback(advance: int = 1, description: str | None = None) -> None:
                desc = description or "..."
                if not progress.tasks[task_id].started:
                    progress.start_task(task_id)
                progress.update(task_id, advance=advance, description=desc)

            try:
                stats = extractor.extract(root, destination, progress_callback=_callback)
            except ExtractionError as exc:
                self.console.print(Panel(f"[red] :[/red] {exc}", border_style="red"))
                return
            except Exception as exc:  # pragma: no cover - defensive
                self.console.print(Panel(f"[red] :[/red] {exc}", border_style="red"))
                return

        self.state.last_stats = stats
        self.console.print(self._build_summary_panel(stats))
        if self.state.copy_to_clipboard:
            self._try_copy(stats)

    def _build_summary_panel(self, stats: ExtractionStats) -> Panel:
        table = Table.grid(padding=(0, 1))
        table.add_column(justify="right", style="bold")
        table.add_column()
        table.add_row("Root", str(stats.root))
        table.add_row("Output", str(stats.output))
        table.add_row("Files", str(stats.processed_files))
        table.add_row("Bytes", str(stats.total_bytes))
        if stats.token_count is not None:
            token_info = f"{stats.token_count}"
            if stats.token_model:
                token_info += f" ({stats.token_model})"
            table.add_row("Tokens", token_info)
        skipped_summary = ", ".join(f"{reason}: {count}" for reason, count in stats.skipped.items() if count)
        if skipped_summary:
            table.add_row("Skipped", skipped_summary)
        if stats.errors:
            table.add_row("Warnings", " | ".join(stats.errors))
        return Panel(table, title="[bold green][/bold green]", border_style="green")

    def _try_copy(self, stats: ExtractionStats) -> None:
        try:
            import pyperclip  # type: ignore

            contents = Path(stats.output).read_text(encoding="utf-8")
            pyperclip.copy(contents)
            self.console.print(Panel("[green]    .[/green]", border_style="green"))
        except Exception as exc:  # pragma: no cover - platform dependent
            self.console.print(Panel(f"[yellow]  :[/yellow] {exc}", border_style="yellow"))

    def _save_config_command(self) -> None:
        try:
            save_config(self.state)
        except Exception as exc:  # pragma: no cover - persistence is best effort
            self.console.print(Panel(f"[red]   :[/red] {exc}", border_style="red"))
            return
        self.console.print(Panel("[green] .[/green]", border_style="green"))


def run_interactive(console: Console | None = None) -> None:
    """Entry helper used by ``proxtract`` when launched without arguments."""

    InteractiveShell(console=console).run()


__all__ = ["run_interactive", "InteractiveShell", "ProxtractCompleter"]


--- src/proxtract/main.py ---
"""Entry point for launching the Proxtract CLI and interactive REPL."""

from __future__ import annotations

import argparse
import sys
from pathlib import Path
from typing import Optional, Sequence

from rich.console import Console

from .interactive import run_interactive
from .state import AppState
from .utils import create_console

try:  # Shell auto-completion support
    import argcomplete  # type: ignore
    from argcomplete.completers import FilesCompleter  # type: ignore
except Exception:  # pragma: no cover - degrade gracefully if unavailable
    argcomplete = None  # type: ignore[assignment]
    FilesCompleter = None  # type: ignore[assignment]

try:  # Config helpers are optional if tomllib/tomli missing
    from .config import apply_config, load_config, save_config as _save_config
except Exception:  # pragma: no cover - fallback when persistence unavailable
    apply_config = lambda state, data: state  # type: ignore
    load_config = lambda: {}  # type: ignore
    _save_config = None  # type: ignore
def _run_cli_extract(args: argparse.Namespace, console: Console) -> int:
    state = apply_config(AppState(), load_config())

    if args.output:
        state.set_output_path(args.output)
    if args.max_size is not None:
        state.max_size_kb = args.max_size
    if args.compact:
        state.compact_mode = True
    elif args.no_compact:
        state.compact_mode = False
    if args.skip_empty:
        state.skip_empty = True
    elif args.no_skip_empty:
        state.skip_empty = False
    if args.use_gitignore:
        state.use_gitignore = True
    elif args.no_gitignore:
        state.use_gitignore = False
    if args.include:
        state.include_patterns = [str(pattern) for pattern in args.include]
    if args.exclude:
        state.exclude_patterns = [str(pattern) for pattern in args.exclude]
    if args.force_include:
        state.force_include = True
    elif args.no_force_include:
        state.force_include = False
    if args.tokenizer_model:
        state.tokenizer_model = args.tokenizer_model
    if args.no_token_count:
        state.enable_token_count = False
    if args.copy:
        state.copy_to_clipboard = True

    extractor = state.create_extractor()
    root = Path(args.path).expanduser()
    output = state.output_path

    console.print(f"[bold]Extracting[/bold] from [cyan]{root}[/cyan] to [green]{output}[/green] ...")
    try:
        stats = extractor.extract(root, output)
    except Exception as exc:
        console.print(f"[red]Extraction failed:[/red] {exc}")
        return 2

    console.print(
        "[bold green]Done.[/bold green] "
        + f"Files: {stats.processed_files}, Size: {stats.total_bytes} bytes"
        + (f", Tokens: {stats.token_count}" if stats.token_count is not None else "")
    )
    if stats.errors:
        console.print(f"[yellow]Warnings ({len(stats.errors)}):[/yellow]")
        for warning in stats.errors:
            console.print(f"   {warning}")

    if state.copy_to_clipboard or args.copy:
        try:
            import pyperclip  # type: ignore

            try:
                contents = Path(stats.output).read_text(encoding="utf-8")
                pyperclip.copy(contents)
                console.print("[green]Copied extracted content to clipboard.[/green]")
            except Exception as exc:  # pragma: no cover - environment specific
                console.print(f"[yellow]Failed to copy to clipboard:[/yellow] {exc}")
        except Exception:
            console.print("[yellow]pyperclip not installed; cannot copy to clipboard.[/yellow]")

    if args.save_config and _save_config is not None:
        try:
            _save_config(state)
            console.print("[green]Settings saved.[/green]")
        except Exception as exc:  # pragma: no cover - persistence is best-effort
            console.print(f"[yellow]Failed to save settings:[/yellow] {exc}")

    return 0


def main(argv: Optional[Sequence[str]] = None) -> None:
    program_name = Path(sys.argv[0]).name or "proxtract"
    parser = argparse.ArgumentParser(prog=program_name, allow_abbrev=False)
    subparsers = parser.add_subparsers(dest="command")

    p_extract = subparsers.add_parser("extract", help="Run a one-off extraction", aliases=["e"])
    p_extract.set_defaults(command="extract")
    path_argument = p_extract.add_argument("path", help="Root directory to extract")
    output_argument = p_extract.add_argument("--output", "-o", help="Output file path")
    p_extract.add_argument("--max-size", type=int, help="Maximum file size in KB")
    group_compact = p_extract.add_mutually_exclusive_group()
    group_compact.add_argument("--compact", action="store_true", help="Enable compact formatting")
    group_compact.add_argument("--no-compact", action="store_true", help="Disable compact formatting")
    group_empty = p_extract.add_mutually_exclusive_group()
    group_empty.add_argument("--skip-empty", action="store_true", help="Skip empty files")
    group_empty.add_argument("--no-skip-empty", action="store_true", help="Do not skip empty files")
    group_gitignore = p_extract.add_mutually_exclusive_group()
    group_gitignore.add_argument("--use-gitignore", dest="use_gitignore", action="store_true", help="Respect .gitignore rules")
    group_gitignore.add_argument("--no-gitignore", dest="no_gitignore", action="store_true", help="Ignore .gitignore rules")
    p_extract.add_argument("--include", action="append", help="Include glob pattern (repeatable)")
    p_extract.add_argument("--exclude", action="append", help="Exclude glob pattern (repeatable)")
    group_force = p_extract.add_mutually_exclusive_group()
    group_force.add_argument(
        "--force-include",
        dest="force_include",
        action="store_true",
        help="Allow include patterns to bypass exclude rules and .gitignore",
    )
    group_force.add_argument(
        "--no-force-include",
        dest="no_force_include",
        action="store_true",
        help="Do not allow include patterns to bypass exclude rules",
    )
    tokenizer_argument = p_extract.add_argument("--tokenizer-model", help="Tokenizer model for token counting")
    p_extract.add_argument("--no-token-count", action="store_true", help="Disable token counting")
    p_extract.add_argument("--copy", action="store_true", help="Copy result to clipboard")
    p_extract.add_argument("--save-config", action="store_true", help="Persist current settings")

    args_list = list(sys.argv[1:] if argv is None else argv)

    if FilesCompleter is not None:  # pragma: no cover - requires argcomplete at runtime
        try:
            path_argument.completer = FilesCompleter(directories=True)  # type: ignore[attr-defined]
            output_argument.completer = FilesCompleter()  # type: ignore[attr-defined]
        except Exception:
            pass

    if argv is None and argcomplete is not None:  # pragma: no cover - requires argcomplete at runtime
        try:
            from argcomplete.completers import ChoicesCompleter  # type: ignore
        except Exception:
            ChoicesCompleter = None  # type: ignore[assignment]
        else:
            token_models = ["gpt-4o-mini", "gpt-4o", "gpt-3.5-turbo", "o200k_base"]
            tokenizer_argument.completer = ChoicesCompleter(token_models)  # type: ignore[attr-defined]

        argcomplete.autocomplete(parser)  # type: ignore[call-arg]

    shared_console = create_console()

    if not args_list:
        run_interactive(shared_console)
        return

    args = parser.parse_args(args_list)

    if args.command == "extract":
        raise SystemExit(_run_cli_extract(args, create_console()))

    run_interactive(shared_console)


if __name__ == "__main__":  # pragma: no cover
    main()


--- src/proxtract/state.py ---
"""Session state management for the Proxtract TUI and CLI."""

from __future__ import annotations

from dataclasses import dataclass, field
from pathlib import Path
from typing import Optional, Sequence

from .core import ExtractionStats, FileExtractor


@dataclass
class AppState:
    """Mutable configuration shared across TUI widgets and CLI commands."""

    source_root: Path = field(default_factory=lambda: Path.cwd())
    output_path: Path = field(default_factory=lambda: Path("extracted.txt"))
    max_size_kb: int = 500
    compact_mode: bool = True
    skip_empty: bool = True
    use_gitignore: bool = True
    include_patterns: list[str] = field(default_factory=list)
    exclude_patterns: list[str] = field(default_factory=list)
    force_include: bool = False
    # Filtering rules - configurable via settings.toml
    skip_extensions: Optional[set[str]] = None
    skip_patterns: Optional[set[str]] = None
    skip_files: Optional[set[str]] = None
    tokenizer_model: str = "gpt-4"
    enable_token_count: bool = True
    copy_to_clipboard: bool = False
    last_stats: Optional[ExtractionStats] = None

    def create_extractor(self) -> FileExtractor:
        """Instantiate a ``FileExtractor`` with the current settings."""

        return FileExtractor(
            max_file_size_kb=self.max_size_kb,
            skip_empty=self.skip_empty,
            compact_mode=self.compact_mode,
            use_gitignore=self.use_gitignore,
            include_patterns=self.include_patterns,
            exclude_patterns=self.exclude_patterns,
            force_include=self.force_include,
            tokenizer_model=self.tokenizer_model,
            count_tokens=self.enable_token_count,
            skip_extensions=None if self.skip_extensions is None else set(self.skip_extensions),
            skip_patterns=None if self.skip_patterns is None else set(self.skip_patterns),
            skip_files=None if self.skip_files is None else set(self.skip_files),
        )

    def set_output_path(self, path: str | Path) -> None:
        self.output_path = Path(path).expanduser()

    def set_source_root(self, path: str | Path) -> None:
        self.source_root = Path(path).expanduser()

    def set_patterns(
        self,
        *,
        include: Optional[Sequence[str]] = None,
        exclude: Optional[Sequence[str]] = None,
    ) -> None:
        if include is not None:
            self.include_patterns = [str(p) for p in include]
        if exclude is not None:
            self.exclude_patterns = [str(p) for p in exclude]


__all__ = ["AppState"]


--- src/proxtract/utils.py ---
"""Shared utility helpers for Proxtract."""

from __future__ import annotations

import os
import sys
from typing import Any, IO, Iterable

from rich.console import Console

_TRUE_WORDS = {"1", "true", "yes", "on", "y", "t"}
_FALSE_WORDS = {"0", "false", "no", "off", "n", "f"}

_ENV_TRUE = {"1", "true", "yes", "on", "enable"}
_ENV_FALSE = {"0", "false", "no", "off", ""}


def normalize_bool(value: Any, default: bool) -> bool:
    """Return a normalized boolean value from arbitrary input.

    Args:
        value: Incoming configuration value (string, number, bool, etc.).
        default: Fallback value when ``value`` cannot be interpreted.

    Returns:
        ``True`` or ``False`` based on ``value`` or ``default`` if parsing fails.
    """

    if isinstance(value, bool):
        return value

    if isinstance(value, (int, float)):
        if value == 0:
            return False
        if value == 1:
            return True
        return bool(value)

    if isinstance(value, str):
        normalized = value.strip().lower()
        if normalized in _TRUE_WORDS:
            return True
        if normalized in _FALSE_WORDS:
            return False

    return default


def _env_flag(name: str, truthy: Iterable[str] | None = None) -> bool:
    """Return True when env var ``name`` is set to a truthy value."""

    value = os.environ.get(name)
    if value is None:
        return False
    normalized = value.strip().lower()
    truthy_values = _ENV_TRUE if truthy is None else set(truthy)
    falsy_values = _ENV_FALSE
    if normalized in truthy_values:
        return True
    if normalized in falsy_values:
        return False
    return True


def supports_color(stream: IO[str] | None = None) -> bool:
    """Best-effort check for ANSI color support."""

    if _env_flag("PROXTRACT_FORCE_COLOR"):
        return True

    if _env_flag("PROXTRACT_NO_COLOR") or _env_flag("NO_COLOR"):
        return False

    if stream is None:
        stream = sys.stdout

    isatty = getattr(stream, "isatty", None)
    try:
        if isatty is None or not isatty():
            return False
    except Exception:
        return False

    if os.environ.get("PYCHARM_HOSTED") == "1":
        return False

    term = os.environ.get("TERM", "")
    if not term or term.lower() == "dumb":
        return False

    if sys.platform == "win32":
        return bool(
            os.environ.get("WT_SESSION")
            or os.environ.get("ANSICON")
            or os.environ.get("ConEmuANSI") == "ON"
            or os.environ.get("TERM_PROGRAM") == "vscode"
        )

    return True


def create_console(**kwargs) -> Console:
    """Return a Rich console tuned for the current environment."""

    stream = kwargs.get("file")
    color_enabled = supports_color(stream if stream is not None else None)
    options = dict(kwargs)
    options.setdefault("force_terminal", color_enabled)
    if not color_enabled:
        options.setdefault("no_color", True)
    return Console(**options)


__all__ = ["normalize_bool", "supports_color", "create_console"]


--- tests/conftest.py ---
import sys
from pathlib import Path
import tempfile
import pytest
from typing import Iterator, Dict, Any, List
from unittest.mock import patch

ROOT = Path(__file__).resolve().parent.parent
SRC = ROOT / "src"
if str(SRC) not in sys.path:
    sys.path.insert(0, str(SRC))

from proxtract.core import FileExtractor
from proxtract.state import AppState


@pytest.fixture
def temp_dir() -> Iterator[Path]:
    """Create a temporary directory for tests."""
    with tempfile.TemporaryDirectory() as tmpdir:
        yield Path(tmpdir)


@pytest.fixture
def sample_text_files(temp_dir: Path) -> Path:
    """Create a directory with sample text files for testing."""
    sample_dir = temp_dir / "samples"
    sample_dir.mkdir()
    
    # Create various text files
    (sample_dir / "python.py").write_text("print('hello world')", encoding="utf-8")
    (sample_dir / "javascript.js").write_text("console.log('hello');", encoding="utf-8")
    (sample_dir / "markdown.md").write_text("# Hello World\n\nThis is a test.", encoding="utf-8")
    (sample_dir / "text.txt").write_text("Just plain text content.", encoding="utf-8")
    (sample_dir / "empty.txt").write_text("", encoding="utf-8")
    (sample_dir / "unicode.txt").write_text("Hello ! Caf rsum nave.", encoding="utf-8")
    
    return sample_dir


@pytest.fixture
def binary_files(temp_dir: Path) -> Path:
    """Create a directory with binary files for testing."""
    binary_dir = temp_dir / "binary"
    binary_dir.mkdir()
    
    # Create various binary files using magic bytes
    # PNG file
    png_file = binary_dir / "image.png"
    png_content = b'\x89PNG\r\n\x1a\n' + b'PNG image data' * 10
    png_file.write_bytes(png_content)
    
    # PDF file
    pdf_file = binary_dir / "document.pdf"
    pdf_content = b'%PDF-1.4\n' + b'PDF document content' * 10
    pdf_file.write_bytes(pdf_content)
    
    # ZIP file
    zip_file = binary_dir / "archive.zip"
    zip_content = b'PK\x03\x04' + b'ZIP archive data' * 10
    zip_file.write_bytes(zip_content)
    
    # File with high null byte ratio
    null_file = binary_dir / "nulls.bin"
    null_content = b'\x00' * 50 + b'text' + b'\x00' * 50
    null_file.write_bytes(null_content)
    
    # JPEG file
    jpg_file = binary_dir / "photo.jpg"
    jpg_content = b'\xff\xd8\xff\xe0' + b'JPEG image data' * 10
    jpg_file.write_bytes(jpg_content)
    
    return binary_dir


@pytest.fixture
def mixed_files(temp_dir: Path) -> Path:
    """Create a directory with a mix of text and binary files."""
    mixed_dir = temp_dir / "mixed"
    mixed_dir.mkdir()
    
    # Text files
    (mixed_dir / "readme.md").write_text("# Project README\n\nWelcome!", encoding="utf-8")
    (mixed_dir / "main.py").write_text("def main():\n    print('Hello')\n", encoding="utf-8")
    (mixed_dir / "config.json").write_text('{"key": "value"}', encoding="utf-8")
    
    # Binary files
    (mixed_dir / "logo.png").write_bytes(b'\x89PNG\r\n\x1a\n' + b'logo data')
    (mixed_dir / "manual.pdf").write_bytes(b'%PDF-1.4\n' + b'pdf data')
    
    # Files that should be filtered by name/pattern
    (mixed_dir / "package.json").write_text('{"name": "test"}', encoding="utf-8")
    (mixed_dir / "requirements.txt").write_text("requests>=2.0.0", encoding="utf-8")
    (mixed_dir / "__pycache__").mkdir()
    (mixed_dir / "__pycache__" / "module.pyc").write_bytes(b'python bytecode')
    
    return mixed_dir


@pytest.fixture
def large_files(temp_dir: Path) -> Path:
    """Create files of various sizes for testing."""
    large_dir = temp_dir / "large"
    large_dir.mkdir()
    
    # Small file (under 1KB limit)
    small_file = large_dir / "small.txt"
    small_file.write_text("Small content", encoding="utf-8")
    
    # Medium file (under 5KB limit but over 1KB)
    medium_file = large_dir / "medium.txt"
    medium_file.write_text("Medium content. " * 100, encoding="utf-8")  # ~1.7KB
    
    # Large file (over 5KB limit)
    large_file = large_dir / "large.txt"
    large_file.write_text("Large content. " * 1000, encoding="utf-8")  # ~17KB
    
    # Very large file (over 1MB)
    very_large_file = large_dir / "very_large.txt"
    very_large_file.write_text("Very large content. " * 10000, encoding="utf-8")  # ~170KB
    
    return large_dir


@pytest.fixture
def nested_structure(temp_dir: Path) -> Path:
    """Create a nested directory structure for testing."""
    root = temp_dir / "project"
    root.mkdir()
    
    # Create nested structure
    (root / "src").mkdir()
    (root / "src" / "main.py").write_text("def main(): pass", encoding="utf-8")
    (root / "src" / "utils.py").write_text("def util(): pass", encoding="utf-8")
    
    (root / "docs").mkdir()
    (root / "docs" / "api.md").write_text("# API Documentation", encoding="utf-8")
    (root / "docs" / "readme.md").write_text("# README", encoding="utf-8")
    
    (root / "tests").mkdir()
    (root / "tests" / "test_main.py").write_text("def test_main(): pass", encoding="utf-8")
    
    (root / "config").mkdir()
    (root / "config" / "settings.toml").write_text('[settings]\ndebug = true', encoding="utf-8")
    
    # Files to be filtered
    (root / "package.json").write_text('{"name": "test"}', encoding="utf-8")
    (root / ".gitignore").write_text("*.log\nnode_modules/", encoding="utf-8")
    (root / "__pycache__").mkdir()
    (root / "__pycache__" / "cache.pyc").write_bytes(b'bytecode')
    
    return root


@pytest.fixture
def extractor_default() -> FileExtractor:
    """Create a FileExtractor with default settings."""
    return FileExtractor()


@pytest.fixture
def extractor_no_filters() -> FileExtractor:
    """Create a FileExtractor with all filtering disabled."""
    return FileExtractor(
        skip_extensions=set(),
        skip_patterns=set(),
        skip_files=set(),
        skip_empty=False,
        max_file_size_kb=10000,  # Very large limit
    )


@pytest.fixture
def extractor_strict_filters() -> FileExtractor:
    """Create a FileExtractor with strict filtering."""
    return FileExtractor(
        skip_extensions={".txt", ".md", ".json"},
        skip_patterns={"src", "tests"},
        skip_files={"config.json"},
        skip_empty=True,
        max_file_size_kb=1,  # Very small limit
    )


@pytest.fixture
def app_state_default() -> AppState:
    """Create an AppState with default settings."""
    return AppState()


@pytest.fixture
def app_state_custom() -> AppState:
    """Create an AppState with custom settings."""
    state = AppState()
    state.output_path = Path("test_output.txt")
    state.max_size_kb = 1000
    state.compact_mode = False
    state.skip_empty = False
    state.use_gitignore = False
    state.include_patterns = ["*.py", "src/*"]
    state.exclude_patterns = ["*.log", "test_*"]
    state.skip_extensions = {".pdf", ".png"}
    state.skip_patterns = {"__pycache__", ".git"}
    state.skip_files = {"package.json", "requirements.txt"}
    state.tokenizer_model = "gpt-3.5-turbo"
    state.enable_token_count = False
    state.copy_to_clipboard = True
    return state


@pytest.fixture
def mock_config_path(temp_dir: Path) -> Iterator[Path]:
    """Mock the config path to use a temporary location."""
    config_path = temp_dir / "settings.toml"
    with patch('proxtract.config._config_path') as mock_path:
        mock_path.return_value = config_path
        yield config_path


@pytest.fixture
def mock_toml_available():
    """Mock TOML library as available."""
    class MockTomllib:
        @staticmethod
        def loads(text):
            import tomli
            return tomli.loads(text)
    
    class MockTomliW:
        @staticmethod
        def dump(data, handle):
            import tomli_w
            return tomli_w.dump(data, handle)
    
    with patch('proxtract.config._tomllib', MockTomllib):
        with patch('proxtract.config._tomli_w', MockTomliW):
            yield


@pytest.fixture
def mock_toml_unavailable():
    """Mock TOML library as unavailable."""
    with patch('proxtract.config._tomllib', None):
        with patch('proxtract.config._tomli_w', None):
            yield


def create_test_file(directory: Path, filename: str, content: str | bytes, is_binary: bool = False) -> Path:
    """Helper function to create a test file."""
    file_path = directory / filename
    if is_binary or isinstance(content, bytes):
        file_path.write_bytes(content)
    else:
        file_path.write_text(content, encoding="utf-8")
    return file_path


def assert_file_processed(stats: 'ExtractionStats', filename: str) -> None:
    """Assert that a file was processed in extraction stats."""
    assert filename in stats.processed_paths


def assert_file_skipped(stats: 'ExtractionStats', filename: str, reason: str) -> None:
    """Assert that a file was skipped in extraction stats."""
    assert filename in stats.skipped_paths[reason]


def assert_extraction_success(stats: 'ExtractionStats', expected_files: int = None) -> None:
    """Assert that extraction was successful."""
    assert len(stats.errors) == 0, f"Extraction had errors: {stats.errors}"
    if expected_files is not None:
        assert stats.processed_files == expected_files


def create_gitignore_test_setup(temp_dir: Path) -> Path:
    """Create a test setup with .gitignore file."""
    root = temp_dir / "gitignore_test"
    root.mkdir()
    
    # Create .gitignore
    (root / ".gitignore").write_text(
        "*.log\n"
        "__pycache__/\n"
        "node_modules/\n"
        "*.tmp\n",
        encoding="utf-8"
    )
    
    # Create files that should be ignored
    (root / "debug.log").write_text("Log file", encoding="utf-8")
    (root / "temp.tmp").write_text("Temporary file", encoding="utf-8")
    
    # Create pycache directory
    cache_dir = root / "__pycache__"
    cache_dir.mkdir()
    (cache_dir / "module.pyc").write_bytes(b'bytecode')
    
    # Create node_modules directory
    node_modules = root / "node_modules"
    node_modules.mkdir()
    (node_modules / "package.json").write_text('{"name": "dep"}', encoding="utf-8")
    
    # Create files that should NOT be ignored
    (root / "main.py").write_text("print('main')", encoding="utf-8")
    (root / "README.md").write_text("# Project", encoding="utf-8")
    
    return root


--- tests/test_config.py ---
"""Unit tests for configuration loading and saving."""

from __future__ import annotations

import pytest
import tempfile
from pathlib import Path
from unittest.mock import patch, mock_open
import json

from proxtract.config import load_config, apply_config, save_config, _config_path
from proxtract.state import AppState


class TestConfigPath:
    """Test config path generation."""

    def test_config_path_default(self):
        """Test default config path generation."""
        config_path = _config_path()
        assert config_path.name == "settings.toml"
        assert "proxtract" in str(config_path)
        assert config_path.expanduser().exists() or str(config_path).startswith("~/")


class TestLoadConfig:
    """Test configuration loading."""

    def test_load_config_empty_when_file_not_exists(self):
        """Test loading config when file doesn't exist."""
        with tempfile.TemporaryDirectory() as tmpdir:
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = Path(tmpdir) / "nonexistent.toml"
                
                config = load_config()
                assert config == {}

    def test_load_config_empty_when_toml_not_available(self):
        """Test loading config when TOML library is not available."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_file = Path(tmpdir) / "settings.toml"
            config_file.write_text('key = "value"', encoding="utf-8")
            
            with patch('proxtract.config._tomllib', None):
                config = load_config()
                assert config == {}

    def test_load_config_invalid_toml(self):
        """Test loading config with invalid TOML content."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_file = Path(tmpdir) / "settings.toml"
            config_file.write_text('invalid toml content [}', encoding="utf-8")
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_file
                
                config = load_config()
                assert config == {}

    def test_load_config_valid_toml(self):
        """Test loading config with valid TOML content."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_file = Path(tmpdir) / "settings.toml"
            toml_content = '''
output_path = "test.txt"
max_size_kb = 1000
compact_mode = false
skip_empty = false
use_gitignore = false
include_patterns = ["*.py", "src/*"]
exclude_patterns = ["*.log", "test_*"]
skip_extensions = [".pdf", ".png"]
skip_patterns = ["__pycache__", ".git"]
skip_files = ["package.json", "requirements.txt"]
tokenizer_model = "gpt-3.5-turbo"
enable_token_count = false
copy_to_clipboard = true
force_include = true
'''
            config_file.write_text(toml_content, encoding="utf-8")
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_file
                
                config = load_config()
                
                assert config["output_path"] == "test.txt"
                assert config["max_size_kb"] == 1000
                assert config["compact_mode"] is False
                assert config["skip_empty"] is False
                assert config["use_gitignore"] is False
                assert config["include_patterns"] == ["*.py", "src/*"]
                assert config["exclude_patterns"] == ["*.log", "test_*"]
                assert config["skip_extensions"] == [".pdf", ".png"]
                assert config["skip_patterns"] == ["__pycache__", ".git"]
                assert config["skip_files"] == ["package.json", "requirements.txt"]
                assert config["tokenizer_model"] == "gpt-3.5-turbo"
                assert config["enable_token_count"] is False
                assert config["copy_to_clipboard"] is True
                assert config["force_include"] is True

    def test_load_config_partial_config(self):
        """Test loading config with only some settings."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_file = Path(tmpdir) / "settings.toml"
            toml_content = '''
output_path = "custom.txt"
max_size_kb = 2000
compact_mode = true
'''
            config_file.write_text(toml_content, encoding="utf-8")
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_file
                
                config = load_config()
                
                assert config["output_path"] == "custom.txt"
                assert config["max_size_kb"] == 2000
                assert config["compact_mode"] is True
                # Other settings should not be present
                assert "skip_empty" not in config


class TestApplyConfig:
    """Test configuration application to AppState."""

    def test_apply_config_empty_data(self):
        """Test applying empty config data."""
        state = AppState()
        original_output = state.output_path
        original_max_size = state.max_size_kb
        
        result = apply_config(state, {})
        
        assert result is state
        assert state.output_path == original_output
        assert state.max_size_kb == original_max_size

    def test_apply_config_basic_settings(self):
        """Test applying basic configuration settings."""
        state = AppState()
        
        config_data = {
            "output_path": "custom_output.txt",
            "max_size_kb": 1500,
            "compact_mode": False,
            "skip_empty": False,
            "use_gitignore": False,
            "force_include": True,
        }
        
        result = apply_config(state, config_data)
        
        assert result is state
        assert state.output_path == Path("custom_output.txt").expanduser()
        assert state.max_size_kb == 1500
        assert state.compact_mode is False
        assert state.skip_empty is False
        assert state.use_gitignore is False
        assert state.force_include is True

    def test_apply_config_boolean_strings(self):
        """Test applying boolean settings from string values."""
        state = AppState()

        config_data = {
            "compact_mode": "false",
            "skip_empty": "no",
            "use_gitignore": "0",
            "enable_token_count": "False",
            "copy_to_clipboard": "yes",
            "force_include": "1",
        }

        apply_config(state, config_data)

        assert state.compact_mode is False
        assert state.skip_empty is False
        assert state.use_gitignore is False
        assert state.enable_token_count is False
        assert state.copy_to_clipboard is True
        assert state.force_include is True

    def test_apply_config_include_patterns(self):
        """Test applying include patterns configuration."""
        state = AppState()
        
        config_data = {
            "include_patterns": ["*.py", "src/*", "docs/*.md"],
            "exclude_patterns": ["*.log", "test_*", "node_modules/*"],
        }
        
        apply_config(state, config_data)
        
        assert state.include_patterns == ["*.py", "src/*", "docs/*.md"]
        assert state.exclude_patterns == ["*.log", "test_*", "node_modules/*"]

    def test_apply_config_filtering_rules(self):
        """Test applying filtering rules configuration."""
        state = AppState()
        
        config_data = {
            "skip_extensions": [".pdf", ".png", ".jpg"],
            "skip_patterns": ["__pycache__", ".git", "test_*"],
            "skip_files": ["package.json", "requirements.txt", "Dockerfile"],
        }
        
        apply_config(state, config_data)
        
        assert state.skip_extensions == {".pdf", ".png", ".jpg"}
        assert state.skip_patterns == {"__pycache__", ".git", "test_*"}
        assert state.skip_files == {"package.json", "requirements.txt", "Dockerfile"}

    def test_apply_config_disable_filters(self):
        """Empty collections should disable custom filters."""
        state = AppState()

        config_data = {
            "skip_extensions": [],
            "skip_patterns": [],
            "skip_files": [],
        }

        apply_config(state, config_data)

        assert state.skip_extensions == set()
        assert state.skip_patterns == set()
        assert state.skip_files == set()

    def test_apply_config_tokenizer_settings(self):
        """Test applying tokenizer configuration."""
        state = AppState()
        
        config_data = {
            "tokenizer_model": "gpt-3.5-turbo",
            "enable_token_count": False,
            "copy_to_clipboard": True,
        }
        
        apply_config(state, config_data)
        
        assert state.tokenizer_model == "gpt-3.5-turbo"
        assert state.enable_token_count is False
        assert state.copy_to_clipboard is True

    def test_apply_config_path_expansion(self):
        """Test that output paths are properly expanded."""
        state = AppState()
        
        config_data = {
            "output_path": "~/documents/output.txt",
        }
        
        apply_config(state, config_data)
        
        # Should expand user home directory
        assert str(state.output_path).startswith(str(Path.home()))

    def test_apply_config_invalid_data_types(self):
        """Test handling of invalid data types in config."""
        state = AppState()
        
        config_data = {
            "max_size_kb": "invalid",  # Should be int
            "compact_mode": "not_bool",  # Should be bool
            "include_patterns": "not_list",  # Should be list
        }
        
        # Should handle gracefully without crashing
        apply_config(state, config_data)
        
        # Invalid values should fall back to defaults
        assert state.max_size_kb == 500  # Default
        assert state.compact_mode is True  # Default
        assert state.include_patterns == []  # Default


class TestSaveConfig:
    """Test configuration saving."""

    def test_save_config_create_directory(self):
        """Test that save_config creates necessary directories."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "nested" / "config" / "settings.toml"
            
            state = AppState()
            state.output_path = "test.txt"
            state.max_size_kb = 1000
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                
                save_config(state)
                
                assert config_path.parent.exists()

    def test_save_config_with_tomli_w(self):
        """Test saving config with tomli_w library."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "settings.toml"
            
            state = AppState()
            state.output_path = "test.txt"
            state.max_size_kb = 1000
            state.compact_mode = False
            state.skip_extensions = {".pdf", ".png"}
            state.skip_patterns = {"__pycache__"}
            state.skip_files = {"package.json"}
            state.force_include = True
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                # Mock tomli_w being available
                with patch('proxtract.config._tomli_w') as mock_tomli_w:
                    mock_tomli_w.dump = lambda data, handle: handle.write(b"mocked toml")
                    
                    save_config(state)
                    
                    # Should have created the file
                    assert config_path.exists()

    def test_save_config_fallback_manual(self):
        """Test saving config with manual construction fallback."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "settings.toml"
            
            state = AppState()
            state.output_path = "test.txt"
            state.max_size_kb = 1000
            state.compact_mode = False
            state.skip_empty = True
            state.use_gitignore = True
            state.include_patterns = ["*.py"]
            state.exclude_patterns = ["*.log"]
            state.skip_extensions = {".pdf"}
            state.skip_patterns = {"__pycache__"}
            state.skip_files = {"package.json"}
            state.tokenizer_model = "gpt-4"
            state.enable_token_count = True
            state.copy_to_clipboard = False
            state.force_include = True
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                # Mock tomli_w being unavailable
                with patch('proxtract.config._tomli_w', None):
                    save_config(state)
                    
                    # Should have created the file with manual construction
                    assert config_path.exists()
                    content = config_path.read_text(encoding="utf-8")
                    
                    # Check that all values are present
                    assert 'output_path = "test.txt"' in content
                    assert 'max_size_kb = 1000' in content
                    assert 'compact_mode = false' in content
                    assert 'skip_empty = true' in content
                    assert 'use_gitignore = true' in content
                    assert 'include_patterns = ["*.py"]' in content
                    assert 'exclude_patterns = ["*.log"]' in content
                    assert 'skip_extensions = [".pdf"]' in content
                    assert 'skip_patterns = ["__pycache__"]' in content
                    assert 'skip_files = ["package.json"]' in content
                    assert 'tokenizer_model = "gpt-4"' in content
                    assert 'enable_token_count = true' in content
                    assert 'copy_to_clipboard = false' in content
                    assert 'force_include = true' in content

    def test_save_config_string_escaping(self):
        """Test proper escaping of strings in manual construction."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "settings.toml"
            
            state = AppState()
            state.output_path = 'test"with"quotes.txt'
            state.tokenizer_model = 'model\\with\\backslashes'
            state.include_patterns = ['pattern"with"quotes', 'path\\with\\backslashes']
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                with patch('proxtract.config._tomli_w', None):
                    save_config(state)
                    
                    content = config_path.read_text(encoding="utf-8")
                    
                    # Check proper escaping
                    assert 'test\\"with\\"quotes.txt' in content
                    assert 'model\\\\with\\\\backslashes' in content
                    assert 'pattern\\"with\\"quotes' in content
                    assert 'path\\\\with\\\\backslashes' in content

    def test_save_config_missing_attributes(self):
        """Test saving config when state doesn't have all attributes."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "settings.toml"
            
            # Create a minimal state without filtering attributes
            class MinimalState:
                def __init__(self):
                    self.output_path = Path("test.txt")
                    self.max_size_kb = 500
                    self.compact_mode = True
                    self.skip_empty = True
                    self.use_gitignore = True
                    self.force_include = False
                    self.include_patterns = []
                    self.exclude_patterns = []
                    self.tokenizer_model = "gpt-4"
                    self.enable_token_count = True
                    self.copy_to_clipboard = False
            
            state = MinimalState()
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                with patch('proxtract.config._tomli_w', None):
                    # Should not crash on missing attributes
                    save_config(state)
                    
                    assert config_path.exists()

    def test_save_config_with_none_values(self):
        """Test saving config with None values."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "settings.toml"
            
            state = AppState()
            # Set some values to None-like states
            state.include_patterns = []
            state.exclude_patterns = []
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                with patch('proxtract.config._tomli_w', None):
                    save_config(state)
                    
                    content = config_path.read_text(encoding="utf-8")
                    
                    # Should handle empty lists properly
                    assert 'include_patterns = []' in content
                    assert 'exclude_patterns = []' in content


class TestConfigRoundTrip:
    """Test complete config load/save round trip."""

    def test_save_and_load_round_trip(self):
        """Test saving config and loading it back."""
        with tempfile.TemporaryDirectory() as tmpdir:
            config_path = Path(tmpdir) / "settings.toml"
            
            # Create initial state
            original_state = AppState()
            original_state.output_path = Path(tmpdir) / "test_output.txt"
            original_state.max_size_kb = 1500
            original_state.compact_mode = False
            original_state.skip_empty = False
            original_state.use_gitignore = False
            original_state.include_patterns = ["*.py", "src/*"]
            original_state.exclude_patterns = ["*.log", "test_*"]
            original_state.skip_extensions = {".pdf", ".png"}
            original_state.skip_patterns = {"__pycache__", ".git"}
            original_state.skip_files = {"package.json", "requirements.txt"}
            original_state.tokenizer_model = "gpt-3.5-turbo"
            original_state.enable_token_count = False
            original_state.copy_to_clipboard = True
            original_state.force_include = True
            original_state.force_include = True
            
            with patch('proxtract.config._config_path') as mock_path:
                mock_path.return_value = config_path
                
                # Save config
                save_config(original_state)
                
                # Load config back
                config_data = load_config()
                
                # Create new state and apply loaded config
                new_state = AppState()
                apply_config(new_state, config_data)
                
                # Verify all values match
                assert new_state.output_path == original_state.output_path
                assert new_state.max_size_kb == original_state.max_size_kb
                assert new_state.compact_mode == original_state.compact_mode
                assert new_state.skip_empty == original_state.skip_empty
                assert new_state.use_gitignore == original_state.use_gitignore
                assert new_state.include_patterns == original_state.include_patterns
                assert new_state.exclude_patterns == original_state.exclude_patterns
                assert new_state.skip_extensions == original_state.skip_extensions
                assert new_state.skip_patterns == original_state.skip_patterns
                assert new_state.skip_files == original_state.skip_files
                assert new_state.tokenizer_model == original_state.tokenizer_model
                assert new_state.enable_token_count == original_state.enable_token_count
                assert new_state.copy_to_clipboard == original_state.copy_to_clipboard
                assert new_state.force_include == original_state.force_include
                assert new_state.force_include == original_state.force_include


if __name__ == "__main__":
    pytest.main([__file__])


--- tests/test_core.py ---
"""Unit tests for core filtering and extraction logic."""

from __future__ import annotations

import pytest
import tempfile
from pathlib import Path
from unittest.mock import patch, MagicMock
from proxtract.core import FileExtractor, ExtractionStats, ExtractionError


class TestFileFiltering:
    """Test file filtering logic."""

    def test_default_extension_filtering(self):
        """Test that default extensions are properly filtered."""
        extractor = FileExtractor()
        
        # Test with default extensions
        assert ".pdf" in extractor.skip_extensions
        assert ".png" in extractor.skip_extensions
        assert ".jpg" in extractor.skip_extensions
        assert ".txt" not in extractor.skip_extensions
        assert ".py" not in extractor.skip_extensions

    def test_custom_skip_extensions(self):
        """Test custom extension filtering rules."""
        extractor = FileExtractor(skip_extensions={".py", ".js"})
        
        assert ".py" in extractor.skip_extensions
        assert ".js" in extractor.skip_extensions
        assert ".pdf" not in extractor.skip_extensions
        assert ".png" not in extractor.skip_extensions

    def test_custom_skip_patterns(self):
        """Test custom pattern filtering rules."""
        extractor = FileExtractor(skip_patterns={"__pycache__", "test_*"})
        
        assert extractor.skip_patterns == {"__pycache__", "test_*"}

    def test_custom_skip_files(self):
        """Test custom file name filtering rules."""
        extractor = FileExtractor(skip_files={"package.json", "requirements.txt"})
        
        assert "package.json" in extractor.skip_files
        assert "requirements.txt" in extractor.skip_files

    def test_match_any_function(self):
        """Test the _match_any function."""
        patterns = ["*.py", "test_*", "config.*"]
        
        # Test matching patterns
        assert FileExtractor._match_any(patterns, "main.py")
        assert FileExtractor._match_any(patterns, "test_module.py")
        assert FileExtractor._match_any(patterns, "config.json")
        
        # Test non-matching patterns
        assert not FileExtractor._match_any(patterns, "app.js")
        assert not FileExtractor._match_any(patterns, "README.md")

    def test_should_skip_extension_filter(self):
        """Test file skipping due to extension filtering."""
        extractor = FileExtractor(skip_extensions={".pdf", ".png"})
        
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root
            
            pdf_file = root / "document.pdf"
            pdf_file.write_text("PDF content", encoding="utf-8")
            
            should_skip, reason = extractor._should_skip(pdf_file, include_override=False)
            assert should_skip
            assert reason == "excluded_ext"

    def test_should_skip_file_name_filter(self):
        """Test file skipping due to file name filtering."""
        extractor = FileExtractor(skip_files={"package.json", "requirements.txt"})
        
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root
            
            pkg_file = root / "package.json"
            pkg_file.write_text('{"name": "test"}', encoding="utf-8")
            
            should_skip, reason = extractor._should_skip(pkg_file, include_override=False)
            assert should_skip
            assert reason == "excluded_name"

    def test_should_skip_pattern_filter(self):
        """Test file skipping due to pattern filtering."""
        extractor = FileExtractor(skip_patterns={"__pycache__", "test_*"})
        
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root
            
            # Test __pycache__ directory
            cache_dir = root / "__pycache__"
            cache_dir.mkdir()
            test_file = cache_dir / "module.txt"
            test_file.write_text("bytecode", encoding="utf-8")
            
            should_skip, reason = extractor._should_skip(test_file, include_override=False)
            assert should_skip
            assert reason == "excluded_path"

    def test_should_skip_empty_files(self):
        """Test empty file handling."""
        extractor = FileExtractor(skip_empty=True)
        
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root
            
            empty_file = root / "empty.txt"
            empty_file.write_text("", encoding="utf-8")
            
            should_skip, reason = extractor._should_skip(empty_file, include_override=False)
            assert should_skip
            assert reason == "empty"

    def test_should_skip_large_files(self):
        """Test large file handling."""
        extractor = FileExtractor(max_file_size_kb=1)  # 1KB limit
        
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root
            
            large_file = root / "large.txt"
            large_file.write_text("x" * (2 * 1024), encoding="utf-8")  # 2KB
            
            should_skip, reason = extractor._should_skip(large_file, include_override=False)
            assert should_skip
            assert reason == "too_large"

    def test_include_pattern_override(self):
        """Test include pattern override functionality."""
        extractor = FileExtractor(include_patterns=["src/*"])
        
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root
            
            # Create files
            src_file = root / "src" / "main.py"
            src_file.parent.mkdir(parents=True, exist_ok=True)
            src_file.write_text("print('src')", encoding="utf-8")
            
            other_file = root / "other.py"
            other_file.write_text("print('other')", encoding="utf-8")
            
            # With include override, included files should not be filtered
            should_skip, reason = extractor._should_skip(src_file, include_override=True)
            assert not should_skip
            
            # Without include override, non-included files should be filtered
            should_skip, reason = extractor._should_skip(other_file, include_override=False)
            assert should_skip
            assert reason == "not_included"

    def test_skip_extensions_disabled_with_empty_set(self):
        """Empty skip_extensions should disable extension filtering."""
        extractor = FileExtractor(skip_extensions=set())

        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            extractor._root_path = root

            png_file = root / "image.png"
            png_file.write_text("fake image", encoding="utf-8")

            should_skip, _ = extractor._should_skip(png_file, include_override=False)
            assert should_skip is False

    def test_force_include_bypasses_excludes(self, tmp_path):
        """Include patterns should override excludes when force_include is enabled."""
        root = tmp_path
        target = root / "secret.env"
        target.write_text("token", encoding="utf-8")
        (root / ".gitignore").write_text("*.env\n", encoding="utf-8")

        extractor = FileExtractor(
            include_patterns=["secret.env"],
            exclude_patterns=["*.env"],
            use_gitignore=True,
            force_include=True,
        )
        output = root / "out.txt"
        stats = extractor.extract(root, output)

        assert "secret.env" in stats.processed_paths
        assert stats.skipped["gitignore"] == 0
        assert stats.skipped["excluded_pattern"] == 0

    def test_force_include_respects_excludes_when_disabled(self, tmp_path):
        """Without force include, exclude/gitignore still win."""
        root = tmp_path
        target = root / "secret.env"
        target.write_text("token", encoding="utf-8")
        (root / ".gitignore").write_text("*.env\n", encoding="utf-8")

        extractor = FileExtractor(
            include_patterns=["secret.env"],
            exclude_patterns=["*.env"],
            use_gitignore=True,
            force_include=False,
        )
        output = root / "out.txt"
        stats = extractor.extract(root, output)

        assert "secret.env" not in stats.processed_paths
        assert stats.skipped["excluded_pattern"] == 1
        assert stats.skipped["gitignore"] == 0


class TestBinaryDetection:
    """Test binary file detection logic."""

    def test_is_text_file_utf8(self):
        """Test text file detection with UTF-8 content."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            text_file = root / "text.txt"
            text_file.write_text("Hello, world! This is a UTF-8 text file.", encoding="utf-8")
            
            assert FileExtractor._is_text_file(text_file)

    def test_is_text_file_empty(self):
        """Test that empty files are considered text files."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            empty_file = root / "empty.txt"
            empty_file.write_text("", encoding="utf-8")
            
            assert FileExtractor._is_text_file(empty_file)

    def test_is_text_file_binary_signature(self):
        """Test binary file detection with magic bytes."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Test PNG file
            png_file = root / "image.png"
            png_content = b'\x89PNG\r\n\x1a\n' + b'text content'
            png_file.write_bytes(png_content)
            assert not FileExtractor._is_text_file(png_file)
            
            # Test PDF file
            pdf_file = root / "document.pdf"
            pdf_content = b'%PDF-1.4\n' + b'pdf content'
            pdf_file.write_bytes(pdf_content)
            assert not FileExtractor._is_text_file(pdf_file)
            
            # Test ZIP file
            zip_file = root / "archive.zip"
            zip_content = b'PK\x03\x04' + b'zip content'
            zip_file.write_bytes(zip_content)
            assert not FileExtractor._is_text_file(zip_file)

    def test_is_text_file_null_bytes(self):
        """Test binary file detection with null bytes."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # File with high null byte ratio
            null_file = root / "binary.bin"
            null_content = b'\x00' * 20 + b'text' + b'\x00' * 20  # > 50% null bytes
            null_file.write_bytes(null_content)
            assert not FileExtractor._is_text_file(null_file)
            
            # File with low null byte ratio (should be treated as text)
            text_with_nulls = root / "text_with_nulls.txt"
            text_content = b'text content\x00with some nulls'
            text_with_nulls.write_bytes(text_content)
            assert FileExtractor._is_text_file(text_with_nulls)

    def test_is_text_file_encoding_detection(self):
        """Test text file detection with different encodings."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Test Latin-1 encoded file
            latin1_file = root / "latin1.txt"
            latin1_content = "Caf rsum nave".encode('latin-1')
            latin1_file.write_bytes(latin1_content)
            assert FileExtractor._is_text_file(latin1_file)
            
            # Test UTF-8 BOM file
            bom_file = root / "bom.txt"
            bom_content = b'\xef\xbb\xbf' + b'UTF-8 with BOM'
            bom_file.write_bytes(bom_content)
            assert FileExtractor._is_text_file(bom_file)

    def test_is_text_file_control_characters(self):
        """Test text file detection with high control character ratio."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # File with too many control characters
            control_file = root / "control.txt"
            control_content = b'text\x01\x02\x03\x04\x05' * 10  # Many control chars
            control_file.write_bytes(control_content)
            assert not FileExtractor._is_text_file(control_file)


class TestExtractionStats:
    """Test ExtractionStats class."""

    def test_processed_files_property(self):
        """Test processed_files property."""
        stats = ExtractionStats(
            root=Path("/tmp"),
            output=Path("/tmp/output.txt"),
            processed_paths=["file1.txt", "file2.py", "file3.js"],
            total_bytes=1024,
            skipped_paths={},
            errors=[],
        )
        
        assert stats.processed_files == 3

    def test_skipped_property(self):
        """Test skipped property aggregation."""
        stats = ExtractionStats(
            root=Path("/tmp"),
            output=Path("/tmp/output.txt"),
            processed_paths=[],
            total_bytes=0,
            skipped_paths={
                "excluded_ext": ["file1.pdf", "file2.png"],
                "empty": ["file3.txt"],
                "too_large": ["file4.bin"],
                "custom_reason": ["file5.custom"],
            },
            errors=[],
        )
        
        skipped = stats.skipped
        assert skipped["excluded_ext"] == 2
        assert skipped["empty"] == 1
        assert skipped["too_large"] == 1
        assert skipped["other"] == 1  # custom_reason should be aggregated to "other"

    def test_as_dict_method(self):
        """Test as_dict method."""
        stats = ExtractionStats(
            root=Path("/tmp"),
            output=Path("/tmp/output.txt"),
            processed_paths=["file1.txt"],
            total_bytes=512,
            skipped_paths={"excluded_ext": ["file.pdf"]},
            errors=[],
            token_count=100,
            token_model="gpt-4",
        )
        
        result = stats.as_dict()
        assert isinstance(result, dict)
        assert result["processed_files"] == 1
        assert result["total_bytes"] == 512
        assert result["skipped"]["excluded_ext"] == 1
        assert result["token_count"] == 100


class TestExtractionWorkflow:
    """Test complete extraction workflow."""

    def test_extract_basic_workflow(self):
        """Test basic extraction workflow."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Create test files
            (root / "file1.txt").write_text("Content 1", encoding="utf-8")
            (root / "file2.py").write_text("print('hello')", encoding="utf-8")
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor()
            
            stats = extractor.extract(root, output_file)
            
            # Check stats
            assert stats.processed_files == 2
            assert stats.total_bytes > 0
            assert len(stats.skipped) == 0
            
            # Check output file
            content = output_file.read_text(encoding="utf-8")
            assert "Content 1" in content
            assert "print('hello')" in content

    def test_extract_with_filtering(self):
        """Test extraction with various filters."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Create test files with different types
            (root / "src.py").write_text("print('python')", encoding="utf-8")
            (root / "image.png").write_text("fake png", encoding="utf-8")
            (root / "empty.txt").write_text("", encoding="utf-8")
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor(skip_extensions={".png"})
            
            stats = extractor.extract(root, output_file)
            
            assert stats.processed_files == 1  # Only .py file
            assert stats.skipped["excluded_ext"] == 1  # .png file
            assert stats.skipped["empty"] == 1  # empty file
            
            content = output_file.read_text(encoding="utf-8")
            assert "src.py" in content
            assert "image.png" not in content

    def test_extract_binary_files(self):
        """Test that binary files are properly detected and skipped."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Create text file
            text_file = root / "text.txt"
            text_file.write_text("This is text", encoding="utf-8")
            
            # Create binary file
            binary_file = root / "image.png"
            binary_file.write_bytes(b'\x89PNG\r\n\x1a\n' + b'binary data')
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor(skip_extensions=set())
            
            stats = extractor.extract(root, output_file)
            
            assert stats.processed_files == 1  # Only text file
            assert stats.skipped["binary"] == 1  # Binary file skipped
            
            content = output_file.read_text(encoding="utf-8")
            assert "text.txt" in content
            assert "image.png" not in content

    def test_extract_gitignore_support(self):
        """Test .gitignore support (if pathspec is available)."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Create .gitignore file
            (root / ".gitignore").write_text("*.log\n", encoding="utf-8")
            
            # Create test files
            (root / "main.py").write_text("print('main')", encoding="utf-8")
            (root / "debug.log").write_text("debug output", encoding="utf-8")
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor(use_gitignore=True)
            
            stats = extractor.extract(root, output_file)
            
            # Should skip .log file due to gitignore
            assert stats.processed_files == 1
            content = output_file.read_text(encoding="utf-8")
            assert "main.py" in content
            assert "debug.log" not in content

    def test_extract_include_patterns(self):
        """Test extraction with include patterns."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
        
            # Create nested files
            src_file = root / "src" / "main.py"
            src_file.parent.mkdir(parents=True, exist_ok=True)
            src_file.write_text("print('main')", encoding="utf-8")

            docs_file = root / "docs" / "readme.md"
            docs_file.parent.mkdir(parents=True, exist_ok=True)
            docs_file.write_text("# README", encoding="utf-8")

            tests_file = root / "tests" / "test.py"
            tests_file.parent.mkdir(parents=True, exist_ok=True)
            tests_file.write_text("def test(): pass", encoding="utf-8")
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor(include_patterns=["src/*", "*.md"])
            
            stats = extractor.extract(root, output_file)
            
            assert stats.processed_files == 2  # src/main.py and docs/readme.md
            
            content = output_file.read_text(encoding="utf-8")
            assert "src/main.py" in content
            assert "docs/readme.md" in content
            assert "tests/test.py" not in content

    def test_extract_nonexistent_directory_raises_error(self):
        """Test that extraction fails on nonexistent directory."""
        extractor = FileExtractor()
        
        with pytest.raises(ExtractionError):
            extractor.extract("/nonexistent", "/tmp/output.txt")

    def test_extract_file_reading_fallback(self):
        """Test file reading with encoding fallback."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            # Create a file with mixed encoding that will fail UTF-8 but succeed with cp1251
            mixed_file = root / "mixed.txt"
            mixed_content = " ".encode('cp1251') + b'\xff'  # Test fallback
            mixed_file.write_bytes(mixed_content)
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor()
            
            # Should not raise an error due to fallback encoding
            stats = extractor.extract(root, output_file)
            assert stats.processed_files == 1

    def test_extract_progress_callback(self):
        """Test progress callback functionality."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            
            (root / "file1.txt").write_text("Content 1", encoding="utf-8")
            (root / "file2.txt").write_text("Content 2", encoding="utf-8")
            
            output_file = root / "extracted.txt"
            extractor = FileExtractor()
            
            # Mock progress callback
            progress_calls = []
            def progress_callback(*, advance, description):
                progress_calls.append((advance, description))
            
            stats = extractor.extract(root, output_file, progress_callback=progress_callback)
            
            assert len(progress_calls) == 2
            assert all(call[0] == 1 for call in progress_calls)  # Each call advances by 1

    def test_extract_progress_counts_skipped_files(self):
        """Progress callback should advance for skipped files."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            (root / "keep.txt").write_text("include", encoding="utf-8")
            (root / "ignore.png").write_text("fake", encoding="utf-8")

            output_file = root / "bundle.txt"
            extractor = FileExtractor(skip_extensions={".png"})

            progress_calls = []

            extractor.extract(
                root,
                output_file,
                progress_callback=lambda *, advance, description=None: progress_calls.append((advance, description)),
            )

            # Two files scanned even though only text processed
            assert len(progress_calls) == 2
            assert sum(call[0] for call in progress_calls) == 2

    def test_extract_creates_missing_output_directory(self):
        """Output directories should be created automatically."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            (root / "file.txt").write_text("content", encoding="utf-8")

            output_file = Path(tmpdir) / "nested" / "dir" / "result.txt"
            extractor = FileExtractor()

            stats = extractor.extract(root, output_file)
            assert stats.output == output_file.resolve()
            assert output_file.exists()

    def test_extract_removes_temp_file_on_failure(self):
        """Temporary files should be cleaned up when extraction fails."""
        with tempfile.TemporaryDirectory() as tmpdir:
            root = Path(tmpdir)
            (root / "file.txt").write_text("content", encoding="utf-8")

            output_file = Path(tmpdir) / "out" / "bundle.txt"
            extractor = FileExtractor()

            def boom(*args, **kwargs):
                raise RuntimeError("boom")

            with patch.object(FileExtractor, "_read_file_content", side_effect=boom):
                with pytest.raises(RuntimeError):
                    extractor.extract(root, output_file)

            assert not output_file.exists()
            tmp_files = list(output_file.parent.glob(f"{output_file.name}.*.tmp"))
            assert tmp_files == []


if __name__ == "__main__":
    pytest.main([__file__])


--- tests/test_interactive.py ---
"""Unit tests for the Rich REPL implementation."""

from __future__ import annotations

import sys
from pathlib import Path

import pytest
from rich.console import Console

from proxtract.core import ExtractionStats
from proxtract.interactive import (
    PROMPT_TOOLKIT_AVAILABLE,
    Document,
    InteractiveShell,
    ProxtractCompleter,
    _tokenize,
)
from proxtract.state import AppState


def _make_shell(tmp_path) -> tuple[InteractiveShell, Console, AppState]:
    console = Console(record=True)
    state = AppState()
    state.set_source_root(tmp_path)
    state.set_output_path(tmp_path / "result.txt")
    shell = InteractiveShell(console=console, state=state)
    return shell, console, state


def test_set_command_updates_state(tmp_path):
    shell, console, state = _make_shell(tmp_path)

    shell.handle_command(f"set source_path {tmp_path}")
    assert state.source_root == tmp_path
    assert "source_path " in console.export_text()


def test_show_command_renders_table(tmp_path):
    shell, console, _ = _make_shell(tmp_path)

    shell.handle_command("show")
    rendered = console.export_text()
    assert "source_path" in rendered


def test_extract_command_invokes_extractor(monkeypatch, tmp_path):
    shell, console, state = _make_shell(tmp_path)
    output_path = shell.state.output_path

    stats = ExtractionStats(
        root=tmp_path,
        output=output_path,
        processed_paths=["file.py"],
        total_bytes=128,
        skipped_paths={},
        errors=[],
    )

    class FakeExtractor:
        def __init__(self) -> None:
            self.calls: list[tuple[Path, Path]] = []

        def extract(self, root: Path, output: Path, progress_callback=None):
            self.calls.append((Path(root), Path(output)))
            if progress_callback:
                progress_callback(description="file.py")
            return stats

    fake = FakeExtractor()
    monkeypatch.setattr(state, "create_extractor", lambda: fake)

    shell.handle_command("extract")

    assert fake.calls and fake.calls[0][0] == tmp_path
    assert state.last_stats == stats
    assert "" in console.export_text()


def test_extract_with_missing_root(tmp_path):
    tmp_dir = tmp_path / "missing"
    console = Console(record=True)
    state = AppState()
    state.set_source_root(tmp_dir)
    shell = InteractiveShell(console=console, state=state)

    shell.handle_command("extract")
    assert "  source_path" in console.export_text()


def test_save_command_invokes_config(monkeypatch, tmp_path):
    shell, console, state = _make_shell(tmp_path)
    called = {}

    def fake_save(arg):
        called["state"] = arg

    monkeypatch.setattr("proxtract.interactive.save_config", fake_save)
    shell.handle_command("save")
    assert called.get("state") is state
    assert " " in console.export_text()


def test_unknown_set_key(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    shell.handle_command("set not_a_key 1")
    assert " " in console.export_text()


def test_set_boolean_and_validation(tmp_path):
    shell, console, state = _make_shell(tmp_path)
    shell.handle_command("set compact_mode off")
    assert state.compact_mode is False
    shell.handle_command("set compact_mode on")
    assert state.compact_mode is True
    shell.handle_command("set compact_mode maybe")
    assert "" in console.export_text()


def test_help_command_lists_entries(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    shell.handle_command("help")
    text = console.export_text()
    assert "extract" in text
    assert "set <key> <value>" in text


def test_config_alias(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    shell.handle_command("config")
    assert " " in console.export_text()


def test_unknown_command(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    shell.handle_command("foobar")
    assert " " in console.export_text()


def test_slash_prefixed_commands(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    shell.handle_command("/help")
    assert "" in console.export_text()
    shell.handle_command("/show")
    assert "source_path" in console.export_text()


@pytest.mark.skipif(PROMPT_TOOLKIT_AVAILABLE, reason="Prompt toolkit present")
def test_run_without_prompt_toolkit(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    shell.run()
    assert "prompt_toolkit is required" in console.export_text()


def test_completer_suggests_commands():
    completer = ProxtractCompleter()
    doc = Document(text="", cursor_position=0)
    suggestions = [c.text for c in completer.get_completions(doc, None)]
    assert "extract" in suggestions

    doc_set = Document(text="set ", cursor_position=4)
    next_suggestions = [c.text for c in completer.get_completions(doc_set, None)]
    assert "source_path" in next_suggestions

    doc_bool = Document(text="set compact_mode o", cursor_position=len("set compact_mode o"))
    bool_suggestions = [c.text for c in completer.get_completions(doc_bool, None)]
    assert "on" in bool_suggestions

    doc_slash = Document(text="/e", cursor_position=2)
    slash_suggestions = [c.text for c in completer.get_completions(doc_slash, None)]
    assert "/extract" in slash_suggestions


def test_tokenize_handles_trailing_space():
    tokens = _tokenize("set foo ")
    assert tokens[-1] == ""


def test_try_copy_reads_file(monkeypatch, tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    output_file = tmp_path / "result.txt"
    output_file.write_text("payload", encoding="utf-8")
    stats = ExtractionStats(
        root=tmp_path,
        output=output_file,
        processed_paths=[],
        total_bytes=0,
        skipped_paths={},
        errors=[],
    )

    class DummyClipboard:
        def __init__(self) -> None:
            self.value = None

        def copy(self, text: str) -> None:
            self.value = text

    clipboard = DummyClipboard()
    monkeypatch.setitem(sys.modules, "pyperclip", clipboard)

    shell._try_copy(stats)
    assert clipboard.value == "payload"
    assert " " in console.export_text()


def test_build_summary_panel_includes_optional_data(tmp_path):
    shell, console, _ = _make_shell(tmp_path)
    stats = ExtractionStats(
        root=tmp_path,
        output=tmp_path / "out.txt",
        processed_paths=["a.py"],
        total_bytes=42,
        skipped_paths={"binary": ["b.dat"]},
        errors=["warning"],
        token_count=10,
        token_model="gpt-4",
    )
    panel = shell._build_summary_panel(stats)
    console.print(panel)
    text = console.export_text()
    assert "Tokens" in text
    assert "Skipped" in text
    assert "Warnings" in text


--- tests/test_main.py ---
"""Tests for proxtract.main CLI helpers."""

from __future__ import annotations

import argparse
from pathlib import Path
from types import SimpleNamespace

import pytest
from rich.console import Console

from proxtract import main as prox_main


def _make_args(**overrides) -> argparse.Namespace:
    defaults = {
        "path": ".",
        "output": None,
        "max_size": None,
        "compact": False,
        "no_compact": False,
        "skip_empty": False,
        "no_skip_empty": False,
        "use_gitignore": False,
        "no_gitignore": False,
        "include": None,
        "exclude": None,
        "force_include": False,
        "no_force_include": False,
        "tokenizer_model": None,
        "no_token_count": False,
        "copy": False,
        "save_config": False,
    }
    defaults.update(overrides)
    return argparse.Namespace(**defaults)


class DummyExtractor:
    def __init__(self, result):
        self._result = result
        self.calls: list[tuple[Path, Path]] = []

    def extract(self, root: Path, output: Path):
        self.calls.append((root, output))
        if isinstance(self._result, Exception):
            raise self._result
        return self._result


def test_run_cli_extract_success(tmp_path, monkeypatch):
    """_run_cli_extract should configure state and run extractor."""

    stats = SimpleNamespace(
        processed_files=3,
        total_bytes=4096,
        token_count=500,
        errors=["token warning"],
        output=tmp_path / "bundle.txt",
    )
    extractor = DummyExtractor(stats)
    monkeypatch.setattr(prox_main.AppState, "create_extractor", lambda self: extractor)

    args = _make_args(
        path=str(tmp_path),
        output=str(tmp_path / "result.txt"),
        max_size=256,
        compact=True,
        skip_empty=False,
        no_skip_empty=True,
        use_gitignore=True,
        include=["*.py"],
        exclude=["*.log"],
        force_include=True,
        tokenizer_model="gpt-4o-mini",
    )
    console = Console(record=True)

    exit_code = prox_main._run_cli_extract(args, console)

    assert exit_code == 0
    assert extractor.calls and extractor.calls[0][0] == tmp_path
    output_text = console.export_text()
    assert "Done." in output_text
    assert "token warning" in output_text


def test_run_cli_extract_failure(tmp_path, monkeypatch):
    """Errors from extractor should be reported and return code 2."""

    extractor = DummyExtractor(RuntimeError("boom"))
    monkeypatch.setattr(prox_main.AppState, "create_extractor", lambda self: extractor)

    args = _make_args(path=str(tmp_path))
    console = Console(record=True)

    exit_code = prox_main._run_cli_extract(args, console)

    assert exit_code == 2
    assert "Extraction failed" in console.export_text()


def test_main_launches_repl_when_no_args(monkeypatch):
    """main() should launch the REPL when no arguments are provided."""

    called = {}

    def fake_launch(console):
        called["ran"] = True

    monkeypatch.setattr(prox_main, "run_interactive", fake_launch)
    prox_main.main([])
    assert called.get("ran") is True


def test_main_dispatches_extract(monkeypatch):
    """main() should dispatch extract subcommand and exit with its return code."""

    calls: dict[str, argparse.Namespace] = {}

    def fake_run(args, _console):
        calls["args"] = args
        return 0

    monkeypatch.setattr(prox_main, "_run_cli_extract", fake_run)

    with pytest.raises(SystemExit) as exc:
        prox_main.main(["extract", "."])

    assert exc.value.code == 0
    assert isinstance(calls["args"], argparse.Namespace)


--- tests/test_utils.py ---
"""Tests for proxtract.utils helpers."""

from __future__ import annotations

import io

from proxtract import utils
from proxtract.utils import normalize_bool


def test_normalize_bool_from_strings():
    assert normalize_bool("true", False) is True
    assert normalize_bool("FALSE", True) is False
    assert normalize_bool("no", True) is False
    assert normalize_bool("1", False) is True
    assert normalize_bool("0", True) is False


def test_normalize_bool_from_numbers_and_defaults():
    assert normalize_bool(1, False) is True
    assert normalize_bool(0, True) is False
    assert normalize_bool(3, False) is True
    assert normalize_bool(-1, False) is True
    assert normalize_bool(object(), True) is True


def test_supports_color_env_overrides(monkeypatch):
    class DummyStream(io.StringIO):
        def isatty(self) -> bool:  # type: ignore[override]
            return True

    stream = DummyStream()
    monkeypatch.setenv("TERM", "xterm-256color")
    monkeypatch.delenv("PYCHARM_HOSTED", raising=False)
    monkeypatch.delenv("PROXTRACT_NO_COLOR", raising=False)
    monkeypatch.delenv("NO_COLOR", raising=False)
    monkeypatch.delenv("PROXTRACT_FORCE_COLOR", raising=False)

    assert utils.supports_color(stream) is True

    monkeypatch.setenv("PYCHARM_HOSTED", "1")
    assert utils.supports_color(stream) is False

    monkeypatch.setenv("PROXTRACT_FORCE_COLOR", "1")
    assert utils.supports_color(stream) is True


def test_create_console_respects_support_detection(monkeypatch):
    monkeypatch.setattr(utils, "supports_color", lambda stream=None: False)
    console = utils.create_console()
    assert console.no_color is True

    monkeypatch.setattr(utils, "supports_color", lambda stream=None: True)
    console_colored = utils.create_console()
    assert console_colored.no_color is False


============================================================
# Total files processed: 35
# Total size: 808KB
# Total tokens: 252023
